UNITS{(mA)=(milliamp)(mV)=(millivolt)(S)=(siemens)}NEURON{SUFFIXhhTRUSEIONnaREADenaWRITEinaUSEIONkREADekWRITEikNONSPECIFIC_CURRENTilRANGEgnabar,gkbar,gl,el,NNa,NK,sigmana,sigmak,se}PARAMETER{se=-1gnabar=.12(S/cm2)<0,1e9>gkbar=.036(S/cm2)<0,1e9>gl=.0003(S/cm2)<0,1e9>el=-54.3(mV)NNa=5000NK=1500sigmak=0.5sigmana=0.4}ASSIGNED{v(mV)celsius(degC)ena(mV)ek(mV)dt(ms)ina(mA/cm2)ik(mA/cm2)il(mA/cm2)am(/ms)ah(/ms)an(/ms)bm(/ms)bh(/ms)bn(/ms)stsumMNHR[14](/ms)em[8]en[5]}STATE{mh0mh1mh2mh3mh4mh5mh6mh7n0n1n2n3n4}BREAKPOINT{SOLVEstatesMETHODeulerina=gnabar*mh7*(v-ena)ik=gkbar*n4*(v-ek)il=gl*(v-el)}INITIAL{rates(v)if(se>0){set_seed(se)}M=am/bmH=ah/bhN=an/bnstsum=(1+H)*(1+M)^3mh0=1/stsummh1=3*M/stsummh2=3*M^2/stsummh3=M^3/stsummh4=H/stsummh5=H*3*M/stsummh6=H*3*M^2/stsummh7=H*M^3/stsumstsum=(1+N)^4n0=1/stsumn1=4*N/stsumn2=6*N^2/stsumn3=4*N^3/stsumn4=N^4/stsumFROMk=0TO7{em[k]=0}FROMk=0TO4{en[k]=0}}DERIVATIVEstates{rates(v)mh0'=(-3*am-ah)*mh0+bm*mh1+bh*mh4+R[0]+R[3]+em[0]/dtmh1'=(-2*am-bm-ah)*mh1+3*am*mh0+2*bm*mh2+bh*mh5-R[0]+R[1]+R[4]+em[1]/dtmh2'=(-am-2*bm-ah)*mh2+2*am*mh1+3*bm*mh3+bh*mh6-R[1]+R[2]+R[5]+em[2]/dtmh3'=(-3*bm-ah)*mh3+am*mh2+bh*mh7-R[2]+R[6]+em[3]/dtmh4'=(-3*am-bh)*mh4+bm*mh5+ah*mh0+R[7]-R[3]+em[4]/dtmh5'=(-2*am-bm-bh)*mh5+3*am*mh4+2*bm*mh6+ah*mh1-R[7]+R[8]-R[4]+em[5]/dtmh6'=(-am-2*bm-bh)*mh6+2*am*mh5+3*bm*mh7+ah*mh2-R[8]+R[9]-R[5]+em[6]/dtmh7'=(-3*bm-bh)*mh7+am*mh6+ah*mh3-R[9]-R[6]+em[7]/dtn0'=-4*an*n0+bn*n1+R[10]+en[0]/dtn1'=(-3*an-bn)*n1+4*an*n0+2*bn*n2-R[10]+R[11]+en[1]/dtn2'=(-2*an-2*bn)*n2+3*an*n1+3*bn*n3-R[11]+R[12]+en[2]/dtn3'=(-an-3*bn)*n3+2*an*n2+4*bn*n4-R[12]+R[13]+en[3]/dtn4'=-4*bn*n4+an*n3-R[13]+en[4]/dtmtrunca()ntrunca()}LOCALq10PROCEDUREmtrunca(){LOCALMH[8],i,j,k,l,msum,msumN,ps,aux,aux2,pos,pos2[8],em_aux[8]UNITSOFFmsum=mh0+mh1+mh2+mh3+mh4+mh5+mh6+mh7MH[0]=mh0/msumMH[1]=mh1/msumMH[2]=mh2/msumMH[3]=mh3/msumMH[4]=mh4/msumMH[5]=mh5/msumMH[6]=mh6/msumMH[7]=mh7/msummsumN=1aux=0aux2=0l=0FROMi=0TO7{if(MH[i]>1){aux=1pos=iVERBATIMbreak;ENDVERBATIM}if(MH[i]<0){aux=2pos2[l]=il=l+1}}if(aux==0){FROMl=0TO7{em[l]=0}}if(aux==1){aux2=MH[pos]FROMj=0TO7{em[j]=MH[j]MH[j]=0}em[pos]=aux2-1MH[pos]=1}if(aux==2){FROMn=0TO(l-1){ps=pos2[n]em_aux[n]=MH[ps]aux2=aux2+MH[ps]}FROMk=0TO7{em[k]=MH[k]*(1-1/(msumN-aux2))MH[k]=MH[k]/(msumN-aux2)}FROMn=0TO(l-1){ps=pos2[n]em[ps]=em_aux[n]MH[ps]=0}}mh0=MH[0]mh1=MH[1]mh2=MH[2]mh3=MH[3]mh4=MH[4]mh5=MH[5]mh6=MH[6]mh7=MH[7]UNITSON}PROCEDUREntrunca(){LOCALN[5],i,j,k,l,nsum,nsumN,ps,aux,aux2,pos,pos2[5],en_aux[5]UNITSOFFnsum=n0+n1+n2+n3+n4N[0]=n0/nsumN[1]=n1/nsumN[2]=n2/nsumN[3]=n3/nsumN[4]=n4/nsumnsumN=1aux=0aux2=0l=0FROMi=0TO4{if(N[i]>1){aux=1pos=iVERBATIMbreak;ENDVERBATIM}if(N[i]<0){aux=2pos2[l]=il=l+1}}if(aux==0){FROMl=0TO4{en[l]=0}}if(aux==1){aux2=N[pos]FROMj=0TO4{en[j]=N[j]N[j]=0}en[pos]=aux2-1N[pos]=1}if(aux==2){FROMn=0TO(l-1){ps=pos2[n]en_aux[n]=N[ps]aux2=aux2+N[ps]}FROMk=0TO4{en[k]=N[k]*(1-1/(nsumN-aux2))N[k]=N[k]/(nsumN-aux2)}FROMn=0TO(l-1){ps=pos2[n]en[ps]=en_aux[n]N[ps]=0}}n0=N[0]n1=N[1]n2=N[2]n3=N[3]n4=N[4]UNITSON}PROCEDURErates(v(mV)){LOCALq10UNITSOFFq10=3^((celsius-6.3)/10)am=q10*0.1*(v+40)/(1-exp(-(v+40)/10))bm=q10*4*exp(-(v+65)/18)ah=q10*0.07*exp(-(v+65)/20)bh=q10/(1+exp(-(v+35)/10))an=q10*0.01*(v+55)/(1-exp(-(v+55)/10))bn=q10*0.125*exp(-(v+65)/80)FROMii=0TO9{R[ii]=normrand(0,1/sqrt(NNa*dt))}FROMii=10TO13{R[ii]=normrand(0,1/sqrt(NK*dt))}R[0]=R[0]*sqrt(3*am*mh0+bm*mh1)R[1]=R[1]*sqrt(2*am*mh1+2*bm*mh2)R[2]=R[2]*sqrt(am*mh2+3*bm*mh3)R[3]=R[3]*sqrt(ah*mh0+bh*mh4)R[4]=R[4]*sqrt(ah*mh1+bh*mh5)R[5]=R[5]*sqrt(ah*mh2+bh*mh6)R[6]=R[6]*sqrt(ah*mh3+bh*mh7)R[7]=R[7]*sqrt(3*am*mh4+bm*mh5)R[8]=R[8]*sqrt(2*am*mh5+2*bm*mh6)R[9]=R[9]*sqrt(am*mh6+3*bm*mh7)R[10]=R[10]*sqrt(4*an*n0+bn*n1)R[11]=R[11]*sqrt(3*an*n1+2*bn*n2)R[12]=R[12]*sqrt(2*an*n2+3*bn*n3)R[13]=R[13]*sqrt(an*n3+4*bn*n4)UNITSON}