NEURON{POINT_PROCESSAMPARANGEgbar,tau_r,tau_d,scale,spkcnt,countflag,i,t1,ca_ratio,ical,itmp,qfact,gNONSPECIFIC_CURRENTiUSEIONcalWRITEicalVALENCE2}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(umho)=(micromho)}PARAMETER{gbar=8.5e-4(umho)tau_r=2.2(ms)tau_d=11.5(ms)Erev=0(mV)saturate=1.2qfact=2ca_ratio=0.005g_factor}ASSIGNED{g(umho)v(mV)itmp(nA)i(nA)ical(nA)t1(ms)y1_add(/ms)y1_loc(/ms)countflagspkcntscale}STATE{y1(/ms)y2}INITIAL{y1_add=0scale=0spkcnt=0countflag=0t1=0y1_loc=0g_factor=1}BREAKPOINT{SOLVEbetadynMETHODcnexpg=gbar*g_factor*y2itmp=scale*g*(v-Erev)i=(1-ca_ratio)*itmpical=ca_ratio*itmp}DERIVATIVEbetadyn{y1'=-y1/(tau_d/qfact)y2'=y1-y2/(tau_r/qfact)}NET_RECEIVE(weight,y1_loc(/ms)){y1_loc=y1_loc*exp(-(t-t1)/(tau_d/qfact))y1_add=(1-y1_loc/saturate)y1_loc=y1_loc+y1_addy1=y1+y1_addt1=tspkcnt=spkcnt+1scale=weight}