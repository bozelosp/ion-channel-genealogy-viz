NEURON{POINT_PROCESSGrC_Glures23RANGEglu,rPSD,rabs,nu,gluspill,gludir,alpha,RmfRANGEtaurec,taufacil,tauin,u0,usr,Deff,c0cleft,meandist,rabs,alpha,nuaRANGEtm1,td1,ts1RANGEinclugludir,inclugluspill,Popeak,alpha,Podir,PospillRANGEE1,u1,R1,P1,Nvesicles,PrP,inclugludir1spike,inclugluspill1spike}UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(nA)=(nanoamp)}CONSTANT{PI=3.1415927}PARAMETER{Deff=0.052(um2/ms)nu=1.72(1/um2)rabs=3.6(um)c0cleft=5.167(mM)rPSD=0.11(um)taurec=5000(ms)tauin=3(ms)taufacil=0(ms)usr=0.3u0=0<0,1>meandist=0.24(um)alpha=5h=0.02(um)Rmf=2.5(um)Popeak=0.655inclugludir=1inclugluspill=1inclugludir1spike=1inclugluspill1spike=1Nvesicles=2tm1=0td1=0ts1=0}VERBATIMstaticinti,n,ii,includir[50],incluspill[50];staticdoublel[200000],t0[50],nuac[50],add;externfloatbessj1(float);ENDVERBATIMASSIGNED{Nsptx1(ms)gludir(mM)gluspill(mM)vsprglu(mM)sum[50](um)sum0[50](um)sum02[50]sum2[50]sum1[50](um2)sum01[50](um2)nua(/um2)R1u1E1P1PrP}INITIAL{tx1=10000000glu=0gludir=0gluspill=0PrP=0nua=0R1=1E1=0u1=0Nsp=0}BREAKPOINT{at_time(tx1)if(t<=tx1){glu=0gludir=0gluspill=0}if(t>tx1){VERBATIMl[0]=0;l[1]=2.4048;l[2]=5.5201;l[3]=8.65;gluspill=0;gludir=0;for(ii=1;ii<=n;ii++){includir[ii]=0;incluspill[ii]=0;includir[1]=inclugludir1spike;includir[2]=inclugludir;incluspill[1]=inclugluspill1spike;incluspill[2]=inclugluspill;sum[ii]=0;i=1;do{if(i>=4)l[i]=PI*(4*i-1)/4;sum0[ii]=sum[ii];add=(l[i]/rabs)*(l[i]/rabs)*Deff*(t0[ii]-t);if(add<-20.0)add=-20.0;sum[ii]=sum[ii]+bessj1((l[i]/rabs)*rPSD)/((l[i]/rabs)*bessj1(l[i])*bessj1(l[i]))*exp(add);i++;}while(fabs(sum[ii]-sum0[ii])>=0.01);sum2[ii]=0;i=0;do{sum02[ii]=sum2[ii];sum2[ii]=sum2[ii]+(4/((2*i+1)*PI))*sin((2*i+1)*PI*h/(2*(rabs-Rmf)))*exp(Deff*(2*i+1)*(2*i+1)*PI*PI*(t0[ii]-t)/(4*(rabs-Rmf)*(rabs-Rmf)));i++;}while(fabs(sum2[ii]-sum02[ii])>=0.001);gludir=gludir+includir[ii]*2*c0cleft*rPSD*sum[ii]*sqrt(alpha*sum2[ii])/(rabs*rabs);if(gludir>c0cleft)gludir=c0cleft;sum1[ii]=0;i=1;do{if(i>=4)l[i]=PI*(4*i-1)/4;sum01[ii]=sum1[ii];sum1[ii]=sum1[ii]+(Rmf*bessj1((l[i]/rabs)*Rmf)-meandist*bessj1((l[i]/rabs)*meandist))/((l[i]/rabs)*bessj1(l[i])*bessj1(l[i]))*exp((l[i]/rabs)*(l[i]/rabs)*Deff*(t0[ii]-t));i++;}while(fabs(sum1[ii]-sum01[ii])>=0.0001);gluspill=gluspill+incluspill[ii]*2*PI*nuac[ii]*c0cleft*rPSD*rPSD*sum1[ii]*sqrt(sum2[ii]*alpha)/(rabs*rabs);}ENDVERBATIMglu=gludir+gluspill}}NET_RECEIVE(weight,Eav,R,u,P,nspike,tsyn(ms)){INITIAL{R=1Eav=0u=u0tsyn=tnspike=0}nspike=nspike+1vspr=((1-R-Eav)/taurec+(R-1)/tauin)/(1/tauin-1/taurec)R=1+exp((tsyn-t)/taurec)*vspr+exp((tsyn-t)/tauin)*(R-1-vspr)Eav=Eav*exp((tsyn-t)/tauin)if(taufacil>0){u=u*exp((tsyn-t)/taufacil)}else{u=usr}if(taufacil>0){state_discontinuity(u,u+usr*(1-u))}if(Nvesicles==1){P=u}if(Nvesicles==2){P=(1-(1-u)^2)}nua=0if(nspike==1||Nvesicles==1){state_discontinuity(Eav,Eav+P*R)state_discontinuity(nua,nua+nu*P*R)}if(nspike==2&&Nvesicles==2){state_discontinuity(Eav,Eav+u*PrP+P*R)state_discontinuity(nua,nua+nu*(u*PrP+P*R))}{state_discontinuity(R,R-P*R)}PrP=Ptsyn=ttx1=tE1=EavR1=Ru1=uP1=PNsp=nspikeVERBATIMn=Nsp;t0[n]=tx1;nuac[n]=nua;ENDVERBATIM}