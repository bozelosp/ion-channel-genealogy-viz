NEURON{ARTIFICIAL_CELLSGateRANGEperiod,number,start,phaseRANGEdepth,gid,randiTHREADSAFEPOINTERdonotuse}UNITS{PI=(pi)(1)}PARAMETER{period=100(ms)<1e-9,1e9>number=1<0,1e9>start=50(ms)depth=0<0,1>phase=0(ms)gid=0randi=0}ASSIGNED{on(1)donotusenumtogo(1)r(1)}INITIAL{if(period<0){period=1e9}if(number<0){number=0}if(start<0){start=0}if(phase<0){phase=0}if(depth<0){depth=0}if(depth>1){depth=1}on=0if(number>0){numtogo=numbernet_send(start,1)}}PROCEDUREseed(x){set_seed(x)}VERBATIM#ifndefNRN_VERSION_GTEQ_8_2_0doublenrn_random_pick(void*);void*nrn_random_arg(intargpos);#defineRANDCAST#else#defineRANDCAST(Rand*)#endifENDVERBATIMFUNCTIONerand(){VERBATIMif(_p_donotuse){_lerand=nrn_random_pick(RANDCAST_p_donotuse);}else{if(_nt!=nrn_threads){hoc_execerror("multithreadrandominNetStim","onlyviahocRandom");}ENDVERBATIMerand=scop_random()VERBATIM}ENDVERBATIM}PROCEDUREnoiseFromRandom(){VERBATIM{void**pv=(void**)(&_p_donotuse);if(ifarg(1)){*pv=nrn_random_arg(1);}else{*pv=(void*)0;}}ENDVERBATIM}FUNCTIONp(t(ms)){p=0if(on==1){p=1+depth*(cos(2*PI*(t-phase)/period)-1)/2}}NET_RECEIVE(w){if(flag==0){if(on==1){r=erand()if(r<p(t)){net_event(t)}}}elseif(flag==1){if(numtogo>0){on=1numtogo=numtogo-1net_send(period,1)}else{on=0}}}