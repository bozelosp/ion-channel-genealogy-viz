NEURON{POINT_PROCESSGRANULE_Nmda_stoch_viPOINTERyNONSPECIFIC_CURRENTiRANGEQ10_diff,Q10_channelRANGEg,icRANGECdur,Erev,T,TmaxRANGERb,Ru,Rd,Rr,Ro,Rc,rb,gmax,RdRateRANGEPRERANGEUsedRANGEMgBlock,v0_block,k_blockRANGEdiffuse,Trelease,lamd,Diff,M,Rd,nd,syntype,gmax_factorRANGET_factor}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(umho)=(micromho)(mM)=(milli/liter)(pS)=(picosiemens)(nS)=(nanosiemens)(um)=(micrometer)PI=(pi)(1)}PARAMETER{syntypegmax_factor=1gmax=18800(pS)Q10_diff=1.5Q10_channel=2.4M=21.515Rd=1.03(um)Diff=0.223(um2/ms)Tmax=1(mM)T_factor=0.5Cdur=0.3(ms)Rb=5(/ms/mM)Ru=0.1(/ms)RdRate=12e-3(/ms)Rr=9e-3(/ms)Ro=3e-2(/ms)Rc=0.966(/ms)Erev=-3.7(mV)v0_block=-20(mV)k_block=13(mV)nd=1diffuse=1lamd=20(nm)celsius(degC)}ASSIGNED{v(mV)i(nA)ic(nA)g(pS)rb(/ms)T(mM)xTrelease(mM)tspike[100](ms)PRE[100]Mres(mM)MgBlocknumpulsestzerogbar_Q10(mho/cm2)Q10(1)y}STATE{C0C1C2DO}INITIAL{rates(v)C0=1C1=0C2=0D=0O=0T=0numpulses=0gbar_Q10=Q10_diff^((celsius-30)/10)Q10=Q10_channel^((celsius-30)/10)Mres=1e3*(1e3*1e15/6.022e23*M)FROMi=1TO100{PRE[i-1]=0tspike[i-1]=0}tspike[0]=1e12(ms)}FUNCTIONimax(a,b){if(a>b){imax=a}else{imax=b}}FUNCTIONdiffusione(){LOCALDifWave,i,cntc,fiDifWave=0cntc=imax(numpulses-100,0)FROMi=cntcTOnumpulses{fi=fmod(i,100)tzero=tspike[fi]if(t>tzero){DifWave=DifWave+PRE[fi]*Mres*exp(-Rd*Rd/(4*Diff*(t-tzero)))/((4*PI*Diff*(1e-3)*lamd)*(t-tzero))^nd}}diffusione=DifWave}BREAKPOINT{rates(v)SOLVEkstatesMETHODsparseg=gmax*gbar_Q10*O*gmax_factori=(1e-6)*g*(v-Erev)*MgBlockic=i}KINETICkstates{Trelease=diffusione()rb=Rb*Trelease~C0<->C1(rb*Q10,Ru*Q10)~C1<->C2(rb*Q10,Ru*Q10)~C2<->D(RdRate*Q10,Rr*Q10)~C2<->O(Ro*Q10,Rc*Q10)CONSERVEC0+C1+C2+D+O=1}PROCEDURErates(v(mV)){TABLEMgBlockDEPENDv0_block,k_blockFROM-120TO30WITH150MgBlock=1/(1+exp(-(v-v0_block)/k_block))}NET_RECEIVE(weight,on,nspike,tzero(ms)){LOCALfiINITIAL{nspike=1}if(flag==0){nspike=nspike+1if(!on){tzero=ton=1T=Tmax*T_factorfi=fmod(numpulses,100)PRE[fi]=T_factortspike[fi]=tnumpulses=numpulses+1}net_send(Cdur,nspike)}if(flag==nspike){tzero=tT=0on=0}}