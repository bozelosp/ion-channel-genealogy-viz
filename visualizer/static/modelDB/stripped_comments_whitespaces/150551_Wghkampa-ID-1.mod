NEURON{POINT_PROCESSWghkampaUSEIONnaWRITEinaUSEIONkWRITEikUSEIONcaREADcaiRANGEtaur,taudRANGEiampa,winitRANGEP,Pmax,lr}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)(molar)=(1/liter)(mM)=(millimolar)FARADAY=(faraday)(coulomb)R=(k-mole)(joule/degC)(um)=(micron)PI=(pi)(1)}PARAMETER{taur=2(ms)<1e-9,1e9>taud=10(ms)<1e-9,1e9>nai=18(mM)nao=140(mM)ki=140(mM)ko=5(mM)celsius(degC)Pmax=1e-6(cm/s)alpha1=0.35beta1=80alpha2=0.55beta2=80winit=1(1)}ASSIGNED{ina(mA/cm2)ik(mA/cm2)v(mV)P(cm/s)factoriampa(mA/cm2)lrcai(mM)Area(cm2)diam(um)}STATE{A(cm/s)B(cm/s)w(1)}INITIAL{LOCALtpif(taur/taud>.9999){taur=.9999*taud}A=0B=0tp=(taur*taud)/(taud-taur)*log(taud/taur)factor=-exp(-tp/taur)+exp(-tp/taud)factor=1/factorArea=PI*diam*1e-2w=winit}BREAKPOINT{SOLVEstateMETHODcnexpP=B-Aina=P*w*ghk(v,nai,nao,1)/Areaik=P*w*ghk(v,ki,ko,1)/Areaiampa=ik+ina}DERIVATIVEstate{lr=eta(cai)w'=lr*(Omega(cai)-w)A'=-A/taurB'=-B/taud}FUNCTIONghk(v(mV),ci(mM),co(mM),z)(0.001coul/cm3){LOCALarg,eci,ecoarg=(0.001)*z*FARADAY*v/(R*(celsius+273.15))eco=co*efun(arg)eci=ci*efun(-arg)ghk=(0.001)*z*FARADAY*(eci-eco)}FUNCTIONefun(z){if(fabs(z)<1e-4){efun=1-z/2}else{efun=z/(exp(z)-1)}}FUNCTIONeta(ci(mM)){LOCALinv,P1,P2,P3,P4P1=100P2=P1*1e-4P4=1e3P3=3ci=(ci-1e-4)*1e3inv=P4+P1/(P2+ci*ci*ci)eta=1/inv}FUNCTIONOmega(ci(mM)){ci=(ci-1e-4)*1e3Omega=0.25+1/(1+exp(-(ci-alpha2)*beta2))-0.25/(1+exp(-(ci-alpha1)*beta1))}NET_RECEIVE(weight(uS)){state_discontinuity(A,A+Pmax*factor)state_discontinuity(B,B+Pmax*factor)}