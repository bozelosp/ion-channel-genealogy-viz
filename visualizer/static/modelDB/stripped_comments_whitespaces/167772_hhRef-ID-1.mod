UNITS{(mA)=(milliamp)(mV)=(millivolt)(S)=(siemens)}NEURON{SUFFIXhhRefUSEIONnaREADenaWRITEinaUSEIONkREADekWRITEikNONSPECIFIC_CURRENTilRANGEgnabar,gkbar,gl,el,NNa,NK,contm,contn,se}PARAMETER{se=-1gnabar=.12(S/cm2)<0,1e9>gkbar=.036(S/cm2)<0,1e9>gl=.0003(S/cm2)<0,1e9>el=-54.3(mV)NNa=5000NK=1500}ASSIGNED{v(mV)celsius(degC)ena(mV)ek(mV)dt(ms)ina(mA/cm2)ik(mA/cm2)il(mA/cm2)am(/ms)ah(/ms)an(/ms)bm(/ms)bh(/ms)bn(/ms)stsumMNHR[14](/ms)contmcontn}STATE{mh0mh1mh2mh3mh4mh5mh6mh7n0n1n2n3n4}BREAKPOINT{SOLVEstatesMETHODcnexpina=gnabar*mh7*(v-ena)ik=gkbar*n4*(v-ek)il=gl*(v-el)}INITIAL{rates(v)if(se>0){set_seed(se)}M=am/bmH=ah/bhN=an/bnstsum=(1+H)*(1+M)^3mh0=1/stsummh1=3*M/stsummh2=3*M^2/stsummh3=M^3/stsummh4=H/stsummh5=H*3*M/stsummh6=H*3*M^2/stsummh7=H*M^3/stsumstsum=(1+N)^4n0=1/stsumn1=4*N/stsumn2=6*N^2/stsumn3=4*N^3/stsumn4=N^4/stsumcontm=0contn=0rates(v)}DERIVATIVEstates{rates(v)mh0'=(-3*am-ah)*mh0+bm*mh1+bh*mh4+R[0]+R[3]mh1'=(-2*am-bm-ah)*mh1+3*am*mh0+2*bm*mh2+bh*mh5-R[0]+R[1]+R[4]mh2'=(-am-2*bm-ah)*mh2+2*am*mh1+3*bm*mh3+bh*mh6-R[1]+R[2]+R[5]mh3'=(-3*bm-ah)*mh3+am*mh2+bh*mh7-R[2]+R[6]mh4'=(-3*am-bh)*mh4+bm*mh5+ah*mh0+R[7]-R[3]mh5'=(-2*am-bm-bh)*mh5+3*am*mh4+2*bm*mh6+ah*mh1-R[7]+R[8]-R[4]mh6'=(-am-2*bm-bh)*mh6+2*am*mh5+3*bm*mh7+ah*mh2-R[8]+R[9]-R[5]mh7'=(-3*bm-bh)*mh7+am*mh6+ah*mh3-R[9]-R[6]n0'=-4*an*n0+bn*n1+R[10]n1'=(-3*an-bn)*n1+4*an*n0+2*bn*n2-R[10]+R[11]n2'=(-2*an-2*bn)*n2+3*an*n1+3*bn*n3-R[11]+R[12]n3'=(-an-3*bn)*n3+2*an*n2+4*bn*n4-R[12]+R[13]n4'=-4*bn*n4+an*n3-R[13]projection()}LOCALq10PROCEDUREprojection(){LOCALsummh,sumn,im,jm,flagm,flagn,w,k,tem,ii,jj,tmax,tsum,kk,bget,MH[8],N[5],Maux[8],Naux[5]UNITSOFFMH[0]=mh0MH[1]=mh1MH[2]=mh2MH[3]=mh3MH[4]=mh4MH[5]=mh5MH[6]=mh6MH[7]=mh7N[0]=n0N[1]=n1N[2]=n2N[3]=n3N[4]=n4summh=0flagm=0FROMim=0TO7{summh=summh+MH[im]if(MH[im]<0||MH[im]>1){flagm=flagm+1}Maux[im]=MH[im]}w=0if(summh!=1||flagm!=0){while(w!=(8-1)){w=0FROMk=0TO(8-2){if(MH[k]>=MH[k+1]){w=w+1}else{tem=MH[k]MH[k]=MH[k+1]MH[k+1]=tem}}}bget=0tsum=0FROMii=0TO6{tsum=tsum+MH[ii]tmax=(tsum-1)/(ii+1)if(tmax>MH[ii+1]){bget=1VERBATIMbreak;ENDVERBATIM}}if(bget==0){tmax=(tsum+MH[7]-1)/8}FROMkk=0TO7{if(Maux[kk]>tmax){MH[kk]=Maux[kk]-tmax}else{MH[kk]=0}}contm=contm+1}sumn=0flagn=0FROMjm=0TO4{sumn=sumn+N[jm]if(N[jm]<0||N[jm]>1){flagn=flagn+1}Naux[jm]=N[jm]}w=0if(sumn!=1||flagn!=0){while(w!=(5-1)){w=0FROMk=0TO(5-2){if(N[k]>=N[k+1]){w=w+1}else{tem=N[k]N[k]=N[k+1]N[k+1]=tem}}}bget=0tsum=0FROMjj=0TO3{tsum=tsum+N[jj]tmax=(tsum-1)/(jj+1)if(tmax>N[jj+1]){bget=1VERBATIMbreak;ENDVERBATIM}}if(bget==0){tmax=(tsum+N[4]-1)/5}FROMkk=0TO4{if(Naux[kk]>tmax){N[kk]=Naux[kk]-tmax}else{N[kk]=0}}contn=contn+1}mh0=MH[0]mh1=MH[1]mh2=MH[2]mh3=MH[3]mh4=MH[4]mh5=MH[5]mh6=MH[6]mh7=MH[7]n0=N[0]n1=N[1]n2=N[2]n3=N[3]n4=N[4]UNITSON}PROCEDURErates(v(mV)){LOCALq10UNITSOFFq10=3^((celsius-6.3)/10)am=q10*0.1*(v+40)/(1-exp(-(v+40)/10))bm=q10*4*exp(-(v+65)/18)ah=q10*0.07*exp(-(v+65)/20)bh=q10/(1+exp(-(v+35)/10))an=q10*0.01*(v+55)/(1-exp(-(v+55)/10))bn=q10*0.125*exp(-(v+65)/80)FROMii=0TO9{R[ii]=normrand(0,1/sqrt(NNa*dt))}FROMii=10TO13{R[ii]=normrand(0,1/sqrt(NK*dt))}R[0]=R[0]*sqrt(3*am*mh0+bm*mh1)R[1]=R[1]*sqrt(2*am*mh1+2*bm*mh2)R[2]=R[2]*sqrt(am*mh2+3*bm*mh3)R[3]=R[3]*sqrt(ah*mh0+bh*mh4)R[4]=R[4]*sqrt(ah*mh1+bh*mh5)R[5]=R[5]*sqrt(ah*mh2+bh*mh6)R[6]=R[6]*sqrt(ah*mh3+bh*mh7)R[7]=R[7]*sqrt(3*am*mh4+bm*mh5)R[8]=R[8]*sqrt(2*am*mh5+2*bm*mh6)R[9]=R[9]*sqrt(am*mh6+3*bm*mh7)R[10]=R[10]*sqrt(4*an*n0+bn*n1)R[11]=R[11]*sqrt(3*an*n1+2*bn*n2)R[12]=R[12]*sqrt(2*an*n2+3*bn*n3)R[13]=R[13]*sqrt(an*n3+4*bn*n4)UNITSON}