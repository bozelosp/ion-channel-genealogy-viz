NEURON{POINT_PROCESSglutamateRANGEtau1_ampa,tau2_ampa,tau1_nmda,tau2_nmdaRANGEerev,g,iRANGEi_ampa,i_nmda,g_ampa,g_nmda,ratio,I,G,mg,q,block,alpha,betaRANGEampa_scale_factor,nmda_scale_factorRANGEdamod,maxModNMDA,max2NMDA,maxModAMPA,max2AMPA,l1NMDA,l2NMDA,l1AMPA,l2AMPANONSPECIFIC_CURRENTiUSEIONcalWRITEicalVALENCE2}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)}PARAMETER{erev=0.0(mV)tau1_ampa=1.9(ms)tau2_ampa=4.8(ms)tau1_nmda=5.52(ms)tau2_nmda=231(ms)ratio=1(1)mg=1(mM)alpha=0.062beta=3.57q=2nmda_scale_factor=1ampa_scale_factor=1ca_ratio_ampa=0.005ca_ratio_nmda=0.1maxModNMDA=1max2NMDA=1maxModAMPA=1max2AMPA=1damod=0l1NMDA=0l2NMDA=0l1AMPA=0l2AMPA=0}ASSIGNED{v(mV)i(nA)g(uS)factor_nmdafactor_ampai_ampai_nmdag_ampag_nmdablockIGical(nA)}STATE{A(uS)B(uS)C(uS)D(uS)}INITIAL{LOCALtpif(tau1_nmda/tau2_nmda>.9999){tau1_nmda=.9999*tau2_nmda}if(tau1_ampa/tau2_ampa>.9999){tau1_ampa=.9999*tau2_ampa}A=0B=0tp=(tau1_nmda*tau2_nmda)/(tau2_nmda-tau1_nmda)*log(tau2_nmda/tau1_nmda)factor_nmda=-exp(-tp/tau1_nmda)+exp(-tp/tau2_nmda)factor_nmda=1/factor_nmdaC=0D=0tp=(tau1_ampa*tau2_ampa)/(tau2_ampa-tau1_ampa)*log(tau2_ampa/tau1_ampa)factor_ampa=-exp(-tp/tau1_ampa)+exp(-tp/tau2_ampa)factor_ampa=1/factor_ampa}BREAKPOINT{SOLVEstateMETHODcnexpg_nmda=(B-A)*modulation(maxModNMDA,max2NMDA,l1NMDA,l2NMDA)block=MgBlock()i_nmda=g_nmda*(v-erev)*block*nmda_scale_factorg_ampa=(D-C)*modulation(maxModAMPA,max2AMPA,l1AMPA,l2AMPA)i_ampa=g_ampa*(v-erev)*ampa_scale_factorG=g_ampa+g_nmdaI=i_ampa+i_nmdaical=i_ampa*ca_ratio_ampa+i_nmda*ca_ratio_nmdai=i_ampa*(1-ca_ratio_ampa)+i_nmda*(1-ca_ratio_nmda)}DERIVATIVEstate{A'=-A/tau1_nmda*qB'=-B/tau2_nmda*qC'=-C/tau1_ampa*qD'=-D/tau2_ampa*q}NET_RECEIVE(weight(uS)){A=A+weight*factor_nmdaB=B+weight*factor_nmdaC=C+weight*factor_ampa*ratioD=D+weight*factor_ampa*ratio}FUNCTIONMgBlock(){MgBlock=1/(1+mg*exp(-alpha*v)/beta)}FUNCTIONmodulation(m1,m2,l1,l2){modulation=1+damod*((m1-1)*l1+(m2-1)*l2)if(modulation<0){modulation=0}}