NEURON{SUFFIXip3difUSEIONip3READip3iWRITEip3iVALENCE1GLOBALvol,DIP3,ip3i0,kdegrRANGEip3iTHREADSAFE}DEFINENANN12UNITS{(molar)=(1/liter)(mM)=(millimolar)(uM)=(micromolar)(um)=(micron)(mA)=(milliamp)FARADAY=(faraday)(coulomb)PI=(pi)(1)}PARAMETER{kdegr=0.14e-3(/ms)DIP3=0.283(um2/ms)ip3i0=0.16e-3(mM)}ASSIGNED{diam(um)ip3i(mM)vol[NANN]}STATE{ip3[NANN](mM)<1e-6>}LOCALfactors_doneBREAKPOINT{SOLVEstateMETHODsparse}INITIAL{if(factors_done==0){factors_done=1factors()}ip3i=ip3i0FROMi=0TONANN-1{ip3[i]=ip3i}}LOCALfrat[NANN]PROCEDUREfactors(){LOCALr,dr2r=1/2dr2=r/(NANN-1)/2vol[0]=0frat[0]=2*rFROMi=0TONANN-2{vol[i]=vol[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vol[i+1]=PI*(r+dr2/2)*2*dr2}}LOCALdsq,dsqvolKINETICstate{COMPARTMENTi,diam*diam*vol[i]*0.81{ip3ip3i0}dsq=diam*diamFROMi=0TONANN-2{~ip3[i]<->ip3[i+1](DIP3*frat[i+1],DIP3*frat[i+1])}FROMi=0TONANN-1{dsqvol=dsq*vol[i]*0.81~ip3[i]<->ip3i0(kdegr*dsqvol,kdegr*dsqvol)}ip3i=ip3[0]}