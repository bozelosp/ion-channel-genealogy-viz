NEURON{SUFFIXcdpUSEIONcaREADcao,cai,icaWRITEcai,icaRANGEica_pmpGLOBALvrat,TotalBuffer,TotalPumpGLOBALTotalIndicator}DEFINENannuli4UNITS{(mol)=(1)(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)}PARAMETER{DCa=0.6(um2/ms)k1buf=100(/mM-ms)k2buf=0.1(/ms)TotalBuffer=0.003(mM)Dogb=0.3(um2/ms)k1ind=430(/mM-ms)k2ind=0.14(/ms)TotalIndicator=0.05(mM)k1=1(/mM-ms)k2=0.005(/ms)k3=1(/ms)k4=0.005(/mM-ms)TotalPump=1e-11(mol/cm2)}ASSIGNED{diam(um)ica(mA/cm2)ica_pmp(mA/cm2)ica_pmp_last(mA/cm2)parea(um)cai(mM)cao(mM)vrat[Nannuli](1)Kd(/mM)B0(mM)Kd_ind(/mM)B0_ind(mM)}CONSTANT{volo=1e10(um2)}STATE{ca[Nannuli](mM)<1e-7>CaBuffer[Nannuli](mM)<1e-5>Buffer[Nannuli](mM)<1e-5>CaIndicator[Nannuli](mM)<1e-5>Indicator[Nannuli](mM)<1e-5>pump(mol/cm2)<1e-15>pumpca(mol/cm2)<1e-15>}BREAKPOINT{SOLVEstateMETHODsparseica_pmp_last=ica_pmpica=ica_pmp}LOCALfactors_doneINITIAL{if(factors_done==0){factors_done=1factors()}Kd=k1buf/k2bufB0=TotalBuffer/(1+Kd*cai)Kd_ind=k1ind/k2indB0_ind=TotalIndicator/(1+Kd_ind*cai)FROMi=0TONannuli-1{ca[i]=caiBuffer[i]=B0CaBuffer[i]=TotalBuffer-B0Indicator[i]=B0_indCaIndicator[i]=TotalIndicator-B0_ind}parea=PI*diampump=TotalPump/(1+(cai*k1/k2))pumpca=TotalPump-pumpica=0ica_pmp=0ica_pmp_last=0SOLVEstateSTEADYSTATEsparse}LOCALfrat[Nannuli]PROCEDUREfactors(){LOCALr,dr2r=1/2dr2=r/(Nannuli-1)/2vrat[0]=0frat[0]=2*rFROMi=0TONannuli-2{vrat[i]=vrat[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vrat[i+1]=PI*(r+dr2/2)*2*dr2}}LOCALdsq,dsqvolKINETICstate{COMPARTMENTi,diam*diam*vrat[i]{caCaBufferBufferCaIndicatorIndicator}COMPARTMENT(1e10)*parea{pumppumpca}COMPARTMENTvolo{cao}LONGITUDINAL_DIFFUSIONi,DCa*diam*diam*vrat[i]{ca}LONGITUDINAL_DIFFUSIONi,Dogb*diam*diam*vrat[i]{CaIndicatorIndicator}~ca[0]+pump<->pumpca(k1*parea*(1e10),k2*parea*(1e10))~pumpca<->pump+cao(k3*parea*(1e10),k4*parea*(1e10))CONSERVEpump+pumpca=TotalPump*parea*(1e10)ica_pmp=2*FARADAY*(f_flux-b_flux)/parea~ca[0]<<(-(ica-ica_pmp_last)*PI*diam/(2*FARADAY))FROMi=0TONannuli-2{~ca[i]<->ca[i+1](DCa*frat[i+1],DCa*frat[i+1])~Indicator[i]<->Indicator[i+1](Dogb*frat[i+1],Dogb*frat[i+1])~CaIndicator[i]<->CaIndicator[i+1](Dogb*frat[i+1],Dogb*frat[i+1])}dsq=diam*diamFROMi=0TONannuli-1{dsqvol=dsq*vrat[i]~ca[i]+Buffer[i]<->CaBuffer[i](k1buf*dsqvol,k2buf*dsqvol)~ca[i]+Indicator[i]<->CaIndicator[i](k1ind*dsqvol,k2ind*dsqvol)}cai=ca[0]}