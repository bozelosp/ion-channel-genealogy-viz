NEURON{THREADSAFESUFFIXkafUSEIONkREADekWRITEikRANGEgbar,gk,ikRANGEdamod,maxMod,level,max2,lev2,modShift}UNITS{(S)=(siemens)(mV)=(millivolt)(mA)=(milliamp)}PARAMETER{gbar=0.0(S/cm2)q=2damod=0maxMod=1level=0max2=1lev2=0modShift=0}ASSIGNED{v(mV)ek(mV)ik(mA/cm2)gk(S/cm2)minfmtau(ms)hinfhtau(ms)}STATE{mh}BREAKPOINT{SOLVEstatesMETHODcnexpgk=gbar*m*m*h*modulation()ik=gk*(v-ek)}DERIVATIVEstates{rates()m'=(minf-m)/mtau*qh'=(hinf-h)/htau*q}INITIAL{rates()m=minfh=hinf}PROCEDURErates(){LOCALalpha,beta,sumUNITSOFFalpha=1.5/(1+exp((v-4+modShift)/(-17)))beta=0.6/(1+exp((v-10+modShift)/9))sum=alpha+betaminf=alpha/summtau=1/sumalpha=0.105/(1+exp((v-(-121)+modShift)/22))beta=0.065/(1+exp((v-(-55)+modShift)/(-11)))sum=alpha+betahinf=alpha/sumhtau=1/sumUNITSON}FUNCTIONmodulation(){modulation=1+damod*((maxMod-1)*level+(max2-1)*lev2)if(modulation<0){modulation=0}}