NEURON{POINT_PROCESSbipNMDARANGEVpre,Vdel,Vdur,Vamp,Vbase,locx,locy,local_v,i,g,release,numvesRANGEgAMPA,gNMDA,s_inf,t1,A,B,VinfGLOBALmaxves,newves,gAMPAsingle,gNMDAsingle,Vtau,Voff,Vset,VampKGLOBALicaconst,gama,n,e,tauAMPA,tau1NMDA,tau2NMDANONSPECIFIC_CURRENTiAMPA,iNMDA}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(nS)=(nanomho)}PARAMETER{maxves=10newves=0.01Vdel=50(ms)Vdur=100(ms)Vamp=10(mV)Vbase=0(mV)VampK=2Vtau=30(/ms)gAMPAsingle=0.2(nS)gNMDAsingle=0.2(nS)tau1NMDA=50(ms)tau2NMDA=2(ms)tauAMPA=2(ms)n=0.25(/mM)gama=0.08(/mV)e=0(mV)locx=0locy=0icaconst=0.1Voff=0Vset=-60}ASSIGNED{Vinf(mV)s_inft1numvesreleasev(mV)i(nA)g(nS)iNMDA(nA)iAMPA(nA)gNMDA(nS)local_v(mV)}STATE{ABgAMPA(nS)Vpre(mV)}BREAKPOINT{SOLVEstateMETHODeulerif(t>t1){releasefunc(Vpre)t1=t1+1}local_v=v*(1-Voff)+Vset*VoffgNMDA=(A-B)/(1+n*exp(-gama*local_v))iAMPA=(1e-3)*gAMPA*(v-e)iNMDA=(1e-3)*gNMDA*(v-e)i=iAMPA+iNMDAg=gNMDA+gAMPA}INITIAL{s_inf=0release=0numves=maxvest1=0Vinf=0Vpre=VinfgAMPA=0gNMDA=0A=0B=0}FUNCTIONreleasefunc(vpre){LOCALrand,addvess_inf=vpre/100release=0FROMrand=0TOnumves-1{if(scop_random()<s_inf){release=release+1}}if(release>0){numves=numves-releaseif(numves<0){numves=0}state_discontinuity(gAMPA,gAMPA+release*gAMPAsingle)state_discontinuity(A,A+release*gNMDAsingle)state_discontinuity(B,B+release*gNMDAsingle)}addves=0FROMrand=0TOmaxves-numves-1{if(scop_random()<newves){addves=addves+1}}numves=numves+addves}DERIVATIVEstate{A'=-A/tau1NMDAB'=-B/tau2NMDAgAMPA'=-gAMPA/tauAMPAVpre'=(-Vpre+Vinf)/Vtau}