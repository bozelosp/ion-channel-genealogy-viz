NEURON{THREADSAFEPOINT_PROCESSProbGABAAB_EMSRANGEtau_r_GABAA,tau_d_GABAA,tau_r_GABAB,tau_d_GABABRANGEUse,u,Dep,Fac,u0,tsynRANGEunoccupied,occupied,NrrpRANGEi,i_GABAA,i_GABAB,g_GABAA,g_GABAB,g,e_GABAA,e_GABAB,GABAB_ratioRANGEA_GABAA_step,B_GABAA_step,A_GABAB_step,B_GABAB_stepNONSPECIFIC_CURRENTiBBCOREPOINTERrngRANGEsynapseID,selected_for_report,verboseLevel}PARAMETER{tau_r_GABAA=0.2(ms)tau_d_GABAA=8(ms)tau_r_GABAB=3.5(ms)tau_d_GABAB=260.9(ms)Use=1.0(1)Dep=100(ms)Fac=10(ms)e_GABAA=-80(mV)e_GABAB=-97(mV)gmax=.001(uS)u0=0Nrrp=1(1)synapseID=0verboseLevel=0selected_for_report=0GABAB_ratio=0(1)}VERBATIM#include<stdlib.h>#include<stdio.h>#include<math.h>#include"nrnran123.h"doublenrn_random_pick(void*r);void*nrn_random_arg(intargpos);ENDVERBATIMASSIGNED{v(mV)i(nA)i_GABAA(nA)i_GABAB(nA)g_GABAA(uS)g_GABAB(uS)A_GABAA_stepB_GABAA_stepA_GABAB_stepB_GABAB_stepg(uS)factor_GABAAfactor_GABABrngusingR123unoccupied(1)occupied(1)tsyn(ms)u(1)}STATE{A_GABAAB_GABAAA_GABABB_GABAB}INITIAL{LOCALtp_GABAA,tp_GABABtsyn=0u=u0unoccupied=0occupied=NrrpA_GABAA=0B_GABAA=0A_GABAB=0B_GABAB=0tp_GABAA=(tau_r_GABAA*tau_d_GABAA)/(tau_d_GABAA-tau_r_GABAA)*log(tau_d_GABAA/tau_r_GABAA)tp_GABAB=(tau_r_GABAB*tau_d_GABAB)/(tau_d_GABAB-tau_r_GABAB)*log(tau_d_GABAB/tau_r_GABAB)factor_GABAA=-exp(-tp_GABAA/tau_r_GABAA)+exp(-tp_GABAA/tau_d_GABAA)factor_GABAA=1/factor_GABAAfactor_GABAB=-exp(-tp_GABAB/tau_r_GABAB)+exp(-tp_GABAB/tau_d_GABAB)factor_GABAB=1/factor_GABABA_GABAA_step=exp(dt*((-1.0)/tau_r_GABAA))B_GABAA_step=exp(dt*((-1.0)/tau_d_GABAA))A_GABAB_step=exp(dt*((-1.0)/tau_r_GABAB))B_GABAB_step=exp(dt*((-1.0)/tau_d_GABAB))VERBATIMif(usingR123){nrnran123_setseq((nrnran123_State*)_p_rng,0,0);}ENDVERBATIM}BREAKPOINT{SOLVEstateg_GABAA=gmax*(B_GABAA-A_GABAA)g_GABAB=gmax*(B_GABAB-A_GABAB)g=g_GABAA+g_GABABi_GABAA=g_GABAA*(v-e_GABAA)i_GABAB=g_GABAB*(v-e_GABAB)i=i_GABAA+i_GABAB}PROCEDUREstate(){A_GABAA=A_GABAA*A_GABAA_stepB_GABAA=B_GABAA*B_GABAA_stepA_GABAB=A_GABAB*A_GABAB_stepB_GABAB=B_GABAB*B_GABAB_step}NET_RECEIVE(weight,weight_GABAA,weight_GABAB,Psurv){LOCALresult,ves,occuweight_GABAA=weightweight_GABAB=weight*GABAB_ratioINITIAL{}if(weight<=0||t<0){VERBATIMreturn;ENDVERBATIM}if(Fac>0){u=u*exp(-(t-tsyn)/Fac)}else{u=Use}if(Fac>0){u=u+Use*(1-u)}FROMcounter=0TO(unoccupied-1){Psurv=exp(-(t-tsyn)/Dep)result=urand()if(result>Psurv){occupied=occupied+1if(verboseLevel>0){UNITSOFFprintf("Recovered!%fattime%gUNITSON}}}ves=0occu=occupied-1FROMcounter=0TOoccu{result=urand()if(result<u){occupied=occupied-1ves=ves+1}}unoccupied=Nrrp-occupiedtsyn=tif(ves>0){A_GABAA=A_GABAA+ves/Nrrp*weight_GABAA*factor_GABAAB_GABAA=B_GABAA+ves/Nrrp*weight_GABAA*factor_GABAAA_GABAB=A_GABAB+ves/Nrrp*weight_GABAB*factor_GABABB_GABAB=B_GABAB+ves/Nrrp*weight_GABAB*factor_GABABif(verboseLevel>0){UNITSOFFprintf("Release!%fattime%gUNITSON}}else{if(verboseLevel>0){UNITSOFFprintf("Failure!%fattime%gUNITSON}}}PROCEDUREsetRNG(){VERBATIM#ifndefCORENEURON_BUILDusingR123=0;if(ifarg(1)&&hoc_is_double_arg(1)){nrnran123_State**pv=(nrnran123_State**)(&_p_rng);uint32_ta2=0;uint32_ta3=0;if(*pv){nrnran123_deletestream(*pv);*pv=(nrnran123_State*)0;}if(ifarg(2)){a2=(uint32_t)*getarg(2);}if(ifarg(3)){a3=(uint32_t)*getarg(3);}*pv=nrnran123_newstream3((uint32_t)*getarg(1),a2,a3);usingR123=1;}elseif(ifarg(1)){void**pv=(void**)(&_p_rng);*pv=nrn_random_arg(1);}else{void**pv=(void**)(&_p_rng);*pv=(void*)0;}#endifENDVERBATIM}FUNCTIONurand(){VERBATIMdoublevalue=0.0;if(usingR123){value=nrnran123_dblpick((nrnran123_State*)_p_rng);}elseif(_p_rng){#ifndefCORENEURON_BUILDvalue=nrn_random_pick(_p_rng);#endif}else{value=0.0;}_lurand=value;ENDVERBATIM}FUNCTIONbbsavestate(){bbsavestate=0VERBATIM#ifndefCORENEURON_BUILDdouble*xdir,*xval,*hoc_pgetarg();longnrn_get_random_sequence(void*r);voidnrn_set_random_sequence(void*r,intval);xdir=hoc_pgetarg(1);xval=hoc_pgetarg(2);if(_p_rng){if(*xdir==-1){if(usingR123){*xdir=2.0;}else{*xdir=1.0;}return0.0;}elseif(*xdir==0){if(usingR123){uint32_tseq;charwhich;nrnran123_getseq((nrnran123_State*)_p_rng,&seq,&which);xval[0]=(double)seq;xval[1]=(double)which;}else{xval[0]=(double)nrn_get_random_sequence(_p_rng);}}else{if(usingR123){nrnran123_setseq((nrnran123_State*)_p_rng,(uint32_t)xval[0],(char)xval[1]);}else{nrn_set_random_sequence(_p_rng,(long)(xval[0]));}}}#endifENDVERBATIM}FUNCTIONtoggleVerbose(){verboseLevel=1-verboseLevel}VERBATIMstaticvoidbbcore_write(double*x,int*d,int*xx,int*offset,_threadargsproto_){if(d){uint32_t*di=((uint32_t*)d)+*offset;nrnran123_State**pv=(nrnran123_State**)(&_p_rng);nrnran123_getids3(*pv,di,di+1,di+2);charwhich;nrnran123_getseq(*pv,di+3,&which);di[4]=(int)which;}*offset+=5;}staticvoidbbcore_read(double*x,int*d,int*xx,int*offset,_threadargsproto_){assert(!_p_rng);uint32_t*di=((uint32_t*)d)+*offset;if(di[0]!=0||di[1]!=0||di[2]!=0){nrnran123_State**pv=(nrnran123_State**)(&_p_rng);*pv=nrnran123_newstream3(di[0],di[1],di[2]);unsignedcharwhich=(unsignedchar)di[4];nrnran123_setseq(*pv,di[3],which);}*offset+=5;}ENDVERBATIM