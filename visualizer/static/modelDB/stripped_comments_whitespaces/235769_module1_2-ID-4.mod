UNITS{}NEURON{SUFFIXCaSPRANGEk1,k2,k3,k4,k5,k6,k,k5i,k6iRANGEUmax,Rmax,t1,t2,R,vthRANGEphi0,phi1,phi2,phi3,phi4RANGEc1,c2,c3,c4,c5RANGEAMinf,AMtau,SF_AMRANGEacm,alpha,alpha1,alpha2,alpha3,beta,gammaRANGEspk_index,t_axonUSEIONmgWRITEmgiVALENCE2USEIONclREADcli}PARAMETER{k1=3000k2=3k3=400k4=1k5i=4e5k6i=150k=850SF_AM=5Rmax=10Umax=2000t1=3t2=25phi1=0.03phi2=1.23phi3=0.01phi4=1.08CS0=0.03B0=0.00043T0=0.00007c1=0.128c2=0.093c3=61.206c4=-13.116c5=5.095alpha=2alpha1=4.77alpha2=400alpha3=160beta=0.47gamma=0.001vth=-40spk_index=0t_axon=0.01}STATE{CaSRCaSRCSCaCaBCaTAMmgi}ASSIGNED{v(mV)Rt_shiftR_OnSpike_Onk5k6AMinfAMtauclispk[1000]xm[2]vmacm}BREAKPOINT{LOCALi,temp_RSPK_DETECT(v,t)CaR(CaSR,t)SOLVEstateMETHODcnexpxm[0]=xm[1]xm[1]=clivm=(xm[1]-xm[0])/(dt*10^-3)mgi=AM^alpha}DERIVATIVEstate{rate(cli,CaT,AM,t)CaSR'=-k1*CS0*CaSR+(k1*CaSR+k2)*CaSRCS-R+U(Ca)CaSRCS'=k1*CS0*CaSR-(k1*CaSR+k2)*CaSRCSCa'=-k5*T0*Ca+(k5*Ca+k6)*CaT-k3*B0*Ca+(k3*Ca+k4)*CaB+R-U(Ca)CaB'=k3*B0*Ca-(k3*Ca+k4)*CaBCaT'=k5*T0*Ca-(k5*Ca+k6)*CaTAM'=(AMinf-AM)/AMtaumgi'=0}PROCEDURESPK_DETECT(v(mv),t(ms)){if(Spike_On==0&&v>vth){Spike_On=1spk[spk_index]=t+t_axonspk_index=spk_index+1R_On=1}elseif(v<vth){Spike_On=0}}FUNCTIONU(x){if(x>=0){U=Umax*(x^2*k^2/(1+x*k+x^2*k^2))^2}else{U=0}}FUNCTIONphi(x){if(x<=-8){phi=phi1*x+phi2}else{phi=phi3*x+phi4}}PROCEDURECaR(CaSR(M),t(ms)){LOCALi,temp_Rif(R_On==1){FROMi=0TOspk_index-1{temp_R=temp_R+CaSR*Rmax*(1-exp(-(t-spk[i])/t1))*exp(-(t-spk[i])/t2)}R=temp_Rtemp_R=0}else{R=0}}PROCEDURErate(cli(M),CaT(M),AM(M),t(ms)){k5=phi(cli)*k5ik6=k6i/(1+SF_AM*AM)AMinf=0.5*(1+tanh(((CaT/T0)-c1)/c2))AMtau=c3/(cosh(((CaT/T0)-c4)/(2*c5)))}INITIAL{LOCALiCaSR=0.0025CaSRCS=0Ca=1e-10CaB=0CaT=0AM=0mgi=0FROMi=0TO999{spk[i]=0}FROMi=0TO1{xm[i]=0}spk_index=0R_On=0}