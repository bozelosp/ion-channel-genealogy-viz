NEURON{POINT_PROCESScalciumRANGEk1,k2,k3,k4,k5,k6,k,k5i,k6iRANGEUmax,Rmax,tau1,tau2,RRANGEphi0,phi1,phi2,phi3,phi4RANGEc1,c2,c3,c4,c5RANGEAMinf,AMtau,SF_AMRANGEacm,alpha,alpha1,alpha2,alpha3,beta,gammaRANGEtotalSpikes,axonDelay}PARAMETER{k1=3000k2=3k3=400k4=1k5i=4e5k6i=150k=850SF_AM=5Rmax=10Umax=2000tau1=3tau2=25phi1=0.03phi2=1.23phi3=0.01phi4=1.08CS0=0.03B0=0.00043T0=0.00007c1=0.128c2=0.093c3=61.206c4=-13.116c5=5.095alpha=2alpha1=4.77alpha2=400alpha3=160beta=0.47gamma=0.001totalSpikes=0axonDelay=0.01}STATE{CaSRCaSRCSCaCaBCaTAMAxm}ASSIGNED{Rk5k6AMinfAMtauspike[1000]xmArray[2]vmacmdt}BREAKPOINT{CaR(CaSR,t)A=AM^alphaSOLVEstateMETHODderivimplicitxmArray[0]=xmArray[1]xmArray[1]=xmvm=(xmArray[1]-xmArray[0])/(dt*10^-3)A=AM^alpha}DERIVATIVEstate{rate(CaT,AM,t)CaSR'=-k1*CS0*CaSR+(k1*CaSR+k2)*CaSRCS-R+U(Ca)CaSRCS'=k1*CS0*CaSR-(k1*CaSR+k2)*CaSRCSCa'=-k5*T0*Ca+(k5*Ca+k6)*CaT-k3*B0*Ca+(k3*Ca+k4)*CaB+R-U(Ca)CaB'=k3*B0*Ca-(k3*Ca+k4)*CaBCaT'=k5*T0*Ca-(k5*Ca+k6)*CaTAM'=(AMinf-AM)/AMtauA'=0}FUNCTIONU(x){if(x>=0){U=Umax*(x^2*k^2/(1+x*k+x^2*k^2))^2}else{U=0}}FUNCTIONphi(x){if(x<=-8){phi=phi1*x+phi2}else{phi=phi3*x+phi4}}PROCEDURECaR(CaSR(M),t(ms)){LOCALiR=0FROMi=0TOtotalSpikes-1{R=R+CaSR*Rmax*(1-exp(-(t-spike[i])/tau1))*exp(-(t-spike[i])/tau2)}}PROCEDURErate(CaT(M),AM(M),t(ms)){k5=phi(-8)*k5ik6=k6i/(1+SF_AM*AM)AMinf=0.5*(1+tanh(((CaT/T0)-c1)/c2))AMtau=c3/(cosh(((CaT/T0)-c4)/(2*c5)))}INITIAL{LOCALiCaSR=0.0025CaSRCS=0Ca=1e-10CaB=0CaT=0AM=0A=0xm=-8R=0FROMi=0TO999{spike[i]=0}FROMi=0TO1{xmArray[i]=0}totalSpikes=0}NET_RECEIVE(weight){spike[totalSpikes]=t+axonDelaytotalSpikes=totalSpikes+1}