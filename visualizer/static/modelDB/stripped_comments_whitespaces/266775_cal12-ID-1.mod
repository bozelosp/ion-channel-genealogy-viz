UNITS{(mV)=(millivolt)(mA)=(milliamp)(S)=(siemens)(molar)=(1/liter)(mM)=(millimolar)FARADAY=(faraday)(coulomb)R=(k-mole)(joule/degC)}NEURON{THREADSAFESUFFIXcal12USEIONcalREADcali,caloWRITEicalVALENCE2RANGEpbar,icalRANGEdamod,maxMod,level,max2,lev2}PARAMETER{pbar=0.0(cm/s)a=0.17q=2damod=0maxMod=1level=0max2=1lev2=0}ASSIGNED{v(mV)ical(mA/cm2)ecal(mV)celsius(degC)cali(mM)calo(mM)minfmtau(ms)hinfhtau(ms)}STATE{mh}BREAKPOINT{SOLVEstatesMETHODcnexpical=pbar*m*(h*a+1-a)*ghk(v,cali,calo)*modulation()}INITIAL{rates()m=minfh=hinf}DERIVATIVEstates{rates()m'=(minf-m)/mtau*qh'=(hinf-h)/htau*q}PROCEDURErates(){UNITSOFFminf=1/(1+exp((v-(-8.9))/(-6.7)))mtau=0.06+1/(exp((v-10)/20)+exp((v-(-17))/-48))hinf=1/(1+exp((v-(-13.4))/11.9))htau=44.3UNITSON}FUNCTIONghk(v(mV),ci(mM),co(mM))(.001coul/cm3){LOCALz,eci,ecoz=(1e-3)*2*FARADAY*v/(R*(celsius+273.15))if(z==0){z=z+1e-6}eco=co*(z)/(exp(z)-1)eci=ci*(-z)/(exp(-z)-1)ghk=(1e-3)*2*FARADAY*(eci-eco)}FUNCTIONmodulation(){modulation=1+damod*((maxMod-1)*level+(max2-1)*lev2)if(modulation<0){modulation=0}}