NEURON{SUFFIXnothingGLOBALSTATS_INSTALLED}PARAMETER{STATS_INSTALLED=0}ASSIGNED{}VERBATIM#include<stdlib.h>#include<math.h>#include<sys/time.h>externdoubleBVBASE;externdouble*hoc_pgetarg();externdoublehoc_call_func(Symbol*,intnarg);externFILE*hoc_obj_file_arg(intnarg);externObject**hoc_objgetarg();externvoidvector_resize();externintvector_instance_px();externvoid*vector_arg();externdouble*vector_vec();externdoublehoc_epsilon;externvoidset_seed();externintivoc_list_count(Object*);externObject*ivoc_list_item(Object*,int);staticvoidhxe(){hoc_execerror("",0);}typedefstructBVEC{intsize;intbufsize;short*x;Object*o;}bvec;ENDVERBATIMVERBATIMstaticdoubleslope(void*vv){inti,n;double*x,*y;doubletimestep,sigxy,sigx,sigy,sigx2;n=vector_instance_px(vv,&y);if(ifarg(1)){timestep=*getarg(1);}else{printf("Youmustsupplyatimestep\n");return0;}sigxy=sigx=sigy=sigx2=0;x=(double*)malloc(sizeof(double)*n);for(i=0;i<n;i++){x[i]=timestep*i;sigxy+=x[i]*y[i];sigx+=x[i];sigy+=y[i];sigx2+=x[i]*x[i];}return(n*sigxy-sigx*sigy)/(n*sigx2-sigx*sigx);}ENDVERBATIMVERBATIMstaticdoublevslope(void*vv){inti,n;double*x,*y;doubletimestep,sigxy,sigx,sigy,sigx2;n=vector_instance_px(vv,&y);if(ifarg(1)){if(vector_arg_px(1,&x)!=n){hoc_execerror("Vectorsizedoesn'tmatch.",0);}sigxy=sigx=sigy=sigx2=0;for(i=0;i<n;i++){sigxy+=x[i]*y[i];sigx+=x[i];sigy+=y[i];sigx2+=x[i]*x[i];}}return(n*sigxy-sigx*sigy)/(n*sigx2-sigx*sigx);}ENDVERBATIMVERBATIMstaticdoublestats(void*vv){inti,n;double*x,*y;doubletimestep,sigxy,sigx,sigy,sigx2,sigy2;doubler,m,b;n=vector_instance_px(vv,&y);if(ifarg(1)){timestep=*getarg(1);}else{printf("Youmustsupplyatimestep\n");return0;}sigxy=sigx=sigy=sigx2=sigy2=0;x=(double*)malloc(sizeof(double)*n);for(i=0;i<n;i++){x[i]=timestep*i;sigxy+=x[i]*y[i];sigx+=x[i];sigy+=y[i];sigx2+=x[i]*x[i];sigy2+=y[i]*y[i];}m=(n*sigxy-sigx*sigy)/(n*sigx2-sigx*sigx);b=(sigy*sigx2-sigx*sigxy)/(n*sigx2-sigx*sigx);r=(n*sigxy-sigx*sigy)/(sqrt(n*sigx2-sigx*sigx)*sqrt(n*sigy2-sigy*sigy));printf("Examined%ddatapoints\n",n);printf("slope=%f\n",m);printf("intercept=%f\n",b);printf("R=%f\n",r);printf("R-squared=%f\n",r*r);return1;}ENDVERBATIMVERBATIMstaticdoublevstats(void*vv){inti,n;double*x,*y;doubletimestep,sigxy,sigx,sigy,sigx2,sigy2;doubler,m,b;n=vector_instance_px(vv,&y);if(ifarg(1)){if(vector_arg_px(1,&x)!=n){hoc_execerror("Vectorsizedoesn'tmatch.",0);}sigxy=sigx=sigy=sigx2=sigy2=0;for(i=0;i<n;i++){sigxy+=x[i]*y[i];sigx+=x[i];sigy+=y[i];sigx2+=x[i]*x[i];sigy2+=y[i]*y[i];}m=(n*sigxy-sigx*sigy)/(n*sigx2-sigx*sigx);b=(sigy*sigx2-sigx*sigxy)/(n*sigx2-sigx*sigx);r=(n*sigxy-sigx*sigy)/(sqrt(n*sigx2-sigx*sigx)*sqrt(n*sigy2-sigy*sigy));printf("Examined%ddatapoints\n",n);printf("slope=%f\n",m);printf("intercept=%f\n",b);printf("R=%f\n",r);printf("R-squared=%f\n",r*r);return1;}else{printf("Youmustsupplyanxvector!\n");return0;}}ENDVERBATIMVERBATIMstaticdoublerandwd(void*vv){inti,ii,jj,nx,ny,flip,flag;double*x,*y;nx=vector_instance_px(vv,&x);flip=(int)*getarg(1);if(ifarg(2)){flag=1;ny=vector_arg_px(2,&y);if(ny!=flip){hoc_execerror("Optvectormustbesizefor#offlips",0);}}else{flag=0;}if(flip>=nx){hoc_execerror("#offlipsexceeds(or==)vectorsize",0);}for(i=0;i<nx;i++){x[i]=BVBASE;}for(i=0,jj=0;i<flip;i++){ii=(int)((nx+1)*drand48());if(x[ii]==BVBASE){x[ii]=1.;if(flag){y[jj]=ii;jj++;}}else{i--;}}returnflip;}ENDVERBATIMVERBATIMstaticdoublehamming(void*vv){inti,nx,ny,nz,prflag;double*x,*y,*z,sum;sum=0.;nx=vector_instance_px(vv,&x);ny=vector_arg_px(1,&y);if(ifarg(2)){prflag=1;nz=vector_arg_px(2,&z);}else{prflag=0;}if(nx!=ny||(prflag&&nx!=nz)){hoc_execerror("Vectorsmustbesamesize",0);}for(i=0;i<nx;++i){if(x[i]!=y[i]){sum++;if(prflag){z[i]=1.;}}elseif(prflag){z[i]=0.;}}returnsum;}ENDVERBATIMVERBATIMstaticdoubleflipbits(void*vv){inti,nx,ny,flip,ii;double*x,*y;nx=vector_instance_px(vv,&x);ny=vector_arg_px(1,&y);flip=(int)*getarg(2);if(nx!=ny){hoc_execerror("Scratchvectormustbesamesize",0);}for(i=0;i<nx;i++){y[i]=x[i];}for(i=0;i<flip;i++){ii=(int)((nx+1)*drand48());if(x[ii]==y[ii]){x[ii]=((x[ii]==1.)?BVBASE:1.);}else{i--;}}returnflip;}ENDVERBATIMVERBATIMstaticdoubleflipbalbits(void*vv){inti,nx,ny,flip,ii,next;double*x,*y;nx=vector_instance_px(vv,&x);ny=vector_arg_px(1,&y);flip=(int)*getarg(2);if(nx!=ny){hoc_execerror("Scratchvectormustbesamesize",0);}for(i=0;i<nx;i++){y[i]=x[i];}next=1;for(i=0;i<flip;){ii=(int)((nx+1)*drand48());if(x[ii]==y[ii]&&y[ii]==next){next=x[ii]=((x[ii]==1.)?BVBASE:1.);i++;}}returnflip;}ENDVERBATIMVERBATIMstaticdoublevpr(void*vv){inti,nx;double*x;FILE*f;nx=vector_instance_px(vv,&x);if(ifarg(1)){f=hoc_obj_file_arg(1);for(i=0;i<nx;i++){if(x[i]>BVBASE){fprintf(f,"%d",1);}else{fprintf(f,"%d",0);}}fprintf(f,"\n");}else{for(i=0;i<nx;i++){if(x[i]>BVBASE){printf("%d",1);}else{printf("%d",0);}}printf("\n");}return1.;}ENDVERBATIMVERBATIMstaticdoublebin(void*vv){inti,j,nx,ny,next,maxsz;double*x,*y,invl,loc;nx=vector_instance_px(vv,&x);ny=vector_arg_px(1,&y);invl=(int)*getarg(2);vv=vector_arg(1);maxsz=vector_buffer_size(vv);vector_resize(vv,maxsz);if(x[nx-1]/invl>(double)(maxsz-1)){printf("Needsize%dintargetvector(%d)\n",(int)(x[nx-1]/invl+1),maxsz);hoc_execerror("",0);}for(j=0;j<maxsz;j++)y[j]=0.;for(i=0,j=0,loc=invl;i<nx&&j<maxsz;i++){if(x[i]<loc)y[j]++;else{while(x[i]>loc){loc+=invl;j++;}y[j]++;}}vector_resize(vv,j);return(double)j;}ENDVERBATIMPROCEDUREinstall_stats(){STATS_INSTALLED=1VERBATIMinstall_vector_method("slope",slope);install_vector_method("vslope",vslope);install_vector_method("stats",stats);install_vector_method("vstats",vstats);install_vector_method("randwd",randwd);install_vector_method("hamming",hamming);install_vector_method("flipbits",flipbits);install_vector_method("flipbalbits",flipbalbits);install_vector_method("vpr",vpr);install_vector_method("bin",bin);ENDVERBATIM}FUNCTIONfac(n){VERBATIM{staticintntop=4;staticdoublea[101]={1.,1.,2.,6.,24.};staticdoublecof[6]={76.18009173,-86.50532033,24.01409822,-1.231739516,0.120858003e-2,-0.536382e-5};intj,n;n=(int)_ln;if(n<0){hoc_execerror("Nonegativenumbers",0);}if(n>100){doublex,tmp,ser;x=_ln;tmp=x+5.5;tmp-=(x+0.5)*log(tmp);ser=1.0;for(j=0;j<=5;j++){x+=1.0;ser+=cof[j]/x;}returnexp(-tmp+log(2.50662827465*ser));}else{while(ntop<n){j=ntop++;a[ntop]=a[j]*ntop;}returna[n];}}ENDVERBATIM}FUNCTIONlogfac(n){VERBATIM{staticintntop=4;staticdoublea[101]={1.,1.,2.,6.,24.};staticdoublecof[6]={76.18009173,-86.50532033,24.01409822,-1.231739516,0.120858003e-2,-0.536382e-5};intj,n;n=(int)_ln;if(n<0){hoc_execerror("Nonegativenumbers",0);}if(n>100){doublex,tmp,ser;x=_ln;tmp=x+5.5;tmp-=(x+0.5)*log(tmp);ser=1.0;for(j=0;j<=5;j++){x+=1.0;ser+=cof[j]/x;}return(-tmp+log(2.50662827465*ser));}else{while(ntop<n){j=ntop++;a[ntop]=a[j]*ntop;}returnlog(a[n]);}}ENDVERBATIM}FUNCTIONvseed(){VERBATIM#ifdefWIN32doubleseed;if(ifarg(1))seed=*getarg(1);else{printf("TIMEACCESSNOTPRESENTINWINDOWS\n");hxe();}srand48((unsigned)seed);set_seed(seed);returnseed;#elsestructtimevaltp;structtimezonetzp;doubleseed;if(ifarg(1))seed=*getarg(1);else{gettimeofday(&tp,&tzp);seed=tp.tv_usec;}srand48((unsigned)seed);set_seed(seed);srandom(seed);returnseed;#endifENDVERBATIM}FUNCTIONgammln(xx){VERBATIM{doublex,tmp,ser;staticdoublecof[6]={76.18009173,-86.50532033,24.01409822,-1.231739516,0.120858003e-2,-0.536382e-5};intj;x=_lxx-1.0;tmp=x+5.5;tmp-=(x+0.5)*log(tmp);ser=1.0;for(j=0;j<=5;j++){x+=1.0;ser+=cof[j]/x;}return-tmp+log(2.50662827465*ser);}ENDVERBATIM}FUNCTIONbetai(a,b,x){VERBATIM{doublebt;if(_lx<0.0||_lx>1.0){printf("BadxinroutineBETAI\n");hxe();}if(_lx==0.0||_lx==1.0)bt=0.0;elsebt=exp(gammln(_la+_lb)-gammln(_la)-gammln(_lb)+_la*log(_lx)+_lb*log(1.0-_lx));if(_lx<(_la+1.0)/(_la+_lb+2.0))returnbt*betacf(_la,_lb,_lx)/_la;elsereturn1.0-bt*betacf(_lb,_la,1.0-_lx)/_lb;}ENDVERBATIM}VERBATIM#defineITMAX100#defineEPS3.0e-7ENDVERBATIMFUNCTIONbetacf(a,b,x){VERBATIM{doubleqap,qam,qab,em,tem,d;doublebz,bm=1.0,bp,bpp;doubleaz=1.0,am=1.0,ap,app,aold;intm;voidnrerror();qab=_la+_lb;qap=_la+1.0;qam=_la-1.0;bz=1.0-qab*_lx/qap;for(m=1;m<=ITMAX;m++){em=(double)m;tem=em+em;d=em*(_lb-em)*_lx/((qam+tem)*(_la+tem));ap=az+d*am;bp=bz+d*bm;d=-(_la+em)*(qab+em)*_lx/((qap+tem)*(_la+tem));app=ap+d*az;bpp=bp+d*bz;aold=az;am=ap/bpp;bm=bp/bpp;az=app/bpp;bz=1.0;if(fabs(az-aold)<(EPS*fabs(az)))returnaz;}printf("aorbtoobig,orITMAXtoosmallinBETACF");return-1.;}ENDVERBATIM}