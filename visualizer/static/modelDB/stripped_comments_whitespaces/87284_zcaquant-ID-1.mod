NEURON{SUFFIXcaquantUSEIONcaREADica,caiGLOBALmodeRANGEiinit,imax,timaxRANGEihalf,t0i,t1i,hwiRANGEcinit,cmax,tcmaxRANGEsvrRANGEqapprox,cmaxpRANGEvinit,vmax,tvmaxRANGEvhalf,t0v,t1v,hwvRANGEvxt}UNITS{(mA)=(milliamp)(mV)=(millivolt)(mM)=(milli/liter)F=(faraday)(coulombs)}PARAMETER{mode=1(1)}ASSIGNED{ica(mA/cm2)iinit(mA/cm2)imax(mA/cm2)timax(ms)ihalf(mA/cm2)t0i(ms)t1i(ms)hwi(ms)findwhichi(1)cai(mM)cinit(mM)cmax(mM)tcmax(ms)svr(/micron)area(micron2)qapprox(picocoulomb)cmaxp(mM)v(mV)vinit(mV)vmax(mV)tvmax(ms)vhalf(mV)t0v(ms)t1v(ms)hwv(ms)findwhichv(1)vxt(msmV)}INITIAL{if(mode==1){iinit=icaimax=icatimax=tihalf=icat0i=-1(ms)t1i=-1(ms)hwi=-1(ms)cinit=caicmax=caitcmax=tvinit=vvmax=vtvmax=tvhalf=vt0v=-1(ms)t1v=-1(ms)hwv=-1(ms)}elseif(mode==2){ihalf=(iinit+imax)/2findwhichi=0vhalf=(vinit+vmax)/2findwhichv=0}}PROCEDUREfindix(){if(findwhichi==0){if(ica<ihalf){t0i=tfindwhichi=1}}elseif(findwhichi==1){if(ica>ihalf){t1i=thwi=t1i-t0ifindwhichi=2}}}PROCEDUREfindvx(){if(findwhichv==0){if(v>vhalf){t0v=tfindwhichv=1}}elseif(findwhichv==1){if(v<vhalf){t1v=thwv=t1v-t0vfindwhichv=2}}}BREAKPOINT{}BEFORESTEP{if(mode==1){if(ica<imax){imax=icatimax=t}if(cai>cmax){cmax=caitcmax=t}if(v>vmax){vmax=vtvmax=t}}elseif(mode==2){findix()qapprox=-(0.01)*area*(imax-iinit)*hwicmaxp=cinit-(10000)*svr*(imax-iinit)*hwi/2/Ffindvx()vxt=(vmax-vinit)*hwv}}