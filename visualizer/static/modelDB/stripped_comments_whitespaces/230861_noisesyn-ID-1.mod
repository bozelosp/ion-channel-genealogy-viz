NEURON{POINT_PROCESSnoisesynRANGEtau1,tau2,e,iNONSPECIFIC_CURRENTiPOINTERptrRANGEg,start,spikedur,spikefreq,weight,nospike_tau,spike_tau,normalmean,normalstd,poisson_mean,gid,syn_index}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)}PARAMETER{tau1=.05(ms)<1e-9,1e9>tau2=5.3(ms)<1e-9,1e9>e=0(mV)start=10(ms)nospike_tau=3.3333(ms)spike_tau=0.6667(ms)spikedur=150(ms)spikefreq=2(hz)normalmean=0(ms)normalstd=4.4721(ms)weight=0.00053407075(uS)poisson_mean=0.8gid=0syn_index=0}ASSIGNED{v(mV)i(nA)g(uS)factort_master(ms)interspike_int(ms)t_out(ms)temp_time(ms)ptrcachedNormalhaveCachedNormal}STATE{A(uS)B(uS)}INITIAL{LOCALtpprintf("weight=%g\n",weight)if(tau1/tau2>.9999){tau1=.9999*tau2}A=0B=0tp=(tau1*tau2)/(tau2-tau1)*log(tau2/tau1)factor=-exp(-tp/tau1)+exp(-tp/tau2)factor=1/factorsetrand(gid,syn_index)cachedNormal=0haveCachedNormal=0t_master=startinterspike_int=1000/spikefreq-spikedurnet_send(t_master+normal(normalmean,normalstd),1)}BREAKPOINT{SOLVEstateMETHODcnexpg=B-Ai=g*(v-e)}DERIVATIVEstate{A'=-A/tau1B'=-B/tau2}NET_RECEIVE(dummy(uS)){if(flag==1){chweight(my_poisson(poisson_mean)*weight*factor)t_master=t_master+spikedurt_out=t_master+normal(normalmean,normalstd)net_send(negexp(spike_tau),3)}elseif(flag==2){printf("t=%8.1f,t_master=%8.1f,t_out=%8.1finState2\n",t,t_master,t_out)t_master=t_master+interspike_intt_out=t_master+normal(normalmean,normalstd)temp_time=negexp(nospike_tau)if(t+temp_time<t_out){net_send(temp_time,4)}else{net_send(t_out-t,1)}}elseif(flag==3){if(t>=t_out){net_send(0,2)}else{chweight(my_poisson(poisson_mean)*weight*factor)net_send(negexp(spike_tau),3)}}elseif(flag==4){chweight(my_poisson(poisson_mean)*weight*factor)temp_time=negexp(nospike_tau)if(t+temp_time<t_out){net_send(temp_time,4)}else{net_send(t_out-t,1)}}}VERBATIM#defineVOIDCASTvoid**vp=(void**)(&(_p_ptr))externvoid*nrnran123_newstream(int,int);externvoidnrnran123_deletestream(void*);externdoublenrnran123_dblpick(void*);ENDVERBATIMPROCEDUREsetrand(id1,id2){VERBATIMVOIDCAST;if(*vp){nrnran123_deletestream(*vp);}*vp=nrnran123_newstream((int)_lid1,(int)_lid2);ENDVERBATIM}FUNCTIONpick(){VERBATIMVOIDCAST;_lpick=nrnran123_dblpick(*vp);ENDVERBATIM}PROCEDUREchweight(delta){printf("Weightchange=%g\n",delta)A=A+deltaB=B+delta}FUNCTIONnormal(pMean,pStdDev){VERBATIMif(haveCachedNormal==1){haveCachedNormal=0;_lnormal=cachedNormal*_lpStdDev+_lpMean;}else{for(;;){doubleu1=pick();doubleu2=pick();doublev1=2*u1-1;doublev2=2*u2-1;doublew=(v1*v1)+(v2*v2);if(w<=1){doubley=sqrt((-2*log(w))/w);doublex1=v1*y;doublex2=v2*y;haveCachedNormal=1;cachedNormal=x2;_lnormal=x1*_lpStdDev+_lpMean;return_lnormal;}}}ENDVERBATIM}FUNCTIONnegexp(mean){negexp=-mean*log(pick())}FUNCTIONmy_poisson(mean){LOCALbound,count,productbound=exp(-1.0*mean)count=0product=1while(product>=bound){product=product*pick()count=count+1}my_poisson=count-1}