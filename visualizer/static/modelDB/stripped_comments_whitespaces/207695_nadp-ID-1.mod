NEURON{THREADSAFESUFFIXnadpUSEIONnaREADnao,nai,inaWRITEnai,ina,enaNONSPECIFIC_CURRENTik_pumpRANGEina_pmp,TotalPump,ik_ratio,na,pump,pumpnaGLOBALvrat,DNa,k1,k2,k3,k4}DEFINENannuli4UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)(mV)=(millivolt)FARADAY=(faraday)(10000coulomb)R=(k-mole)(joule/degC)PI=(pi)(1)(mol)=(1)}PARAMETER{DNa=0.6(um2/ms)k1=1.0(/mM3-ms)k2=0.001(/ms)k3=0.3(/ms)TotalPump=1e-14(mol/cm2)ik_ratio=-0.66666666(1)}ASSIGNED{diam(um)L(um)ina(mA/cm2)nai(mM)vrat[Nannuli]k4(/mM3-ms)nao(mM)ena(mV)ina_pmp(mA/cm2)parea(um)ik_pump(mA/cm2)celsius}CONSTANT{volo=1e10(um2)}STATE{na[Nannuli](mM)<1e-3>pump(mol/cm2)pumpna(mol/cm2)}BREAKPOINT{SOLVEstateMETHODsparseina=ina_pmpik_pump=ik_ratio*ina_pmp}LOCALfactors_doneINITIAL{MUTEXLOCKk4=(((nai/nao)^3)*k1*k3)/k2parea=PI*diampump=TotalPump/(1+(nai*k1/k2))pumpna=TotalPump-pumpif(factors_done==0){factors_done=1factors()}FROMi=0TONannuli-1{na[i]=nai}MUTEXUNLOCK}LOCALfrat[Nannuli]PROCEDUREfactors(){LOCALr,dr2r=1/2dr2=r/(Nannuli-1)/2vrat[0]=0frat[0]=2*rFROMi=0TONannuli-2{vrat[i]=vrat[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vrat[i+1]=PI*(r+dr2/2)*2*dr2}}KINETICstate{COMPARTMENTi,diam*diam*vrat[i]{na}COMPARTMENT(1e10)*parea{pumppumpna}COMPARTMENTvolo{nao}LONGITUDINAL_DIFFUSIONi,DNa*diam*diam*vrat[i]{na}~3na[0]+pump<->pumpna(k1*parea*(1e10),k2*parea*(1e10))~pumpna<->pump+3nao(k3*parea*(1e10),k4*parea*(1e10))CONSERVEpump+pumpna=TotalPump*parea*(1e10)ina_pmp=FARADAY*(f_flux-b_flux)/parea~na[0]<<(-(ina-ina_pmp)*PI*diam/(FARADAY))FROMi=0TONannuli-2{~na[i]<->na[i+1](DNa*frat[i+1],DNa*frat[i+1])}nai=na[0]ena=((R*(273.15+celsius))/(FARADAY*10))*log(nao/nai)}