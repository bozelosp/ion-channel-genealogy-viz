NEURON{SUFFIXnadifusUSEIONnaREADnao,nai,inaWRITEnaiRANGEinabarGLOBALvol}DEFINENANN4UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)}PARAMETER{DFree=.6(um2/ms)diam(um)nao(mM)ina(mA/cm2)k1buf(/mM-ms)k2buf(/ms)inabar(mA/cm2)nai0=12(mM)}ASSIGNED{nai(mM)vol[NANN](1)}STATE{na[NANN](mM)NaBuffer[NANN](mM)Buffer[NANN](mM)}BREAKPOINT{SOLVEstateMETHODsparseina=inabar}LOCALcoord_doneINITIAL{if(coord_done==0){coord_done=1coord()}FROMi=0TONANN-1{na[i]=nai0}}LOCALfrat[NANN]PROCEDUREcoord(){LOCALr,dr2r=1/2dr2=r/(NANN-1)/2vol[0]=0frat[0]=2*rFROMi=0TONANN-2{vol[i]=vol[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vol[i+1]=PI*(r+dr2/2)*2*dr2}}LOCALdsq,dsqvolKINETICstate{COMPARTMENTi,diam*diam*vol[i]{naNaBufferBuffer}LONGITUDINAL_DIFFUSIONj,DFree*diam*diam*vol[j]{na}~na[0]<<(-ina*PI*diam*frat[0]/(FARADAY))FROMi=0TONANN-2{~na[i]<->na[i+1](DFree*frat[i+1],DFree*frat[i+1])}dsq=diam*diamFROMi=0TONANN-1{dsqvol=dsq*vol[i]~na[i]+Buffer[i]<->NaBuffer[i](k1buf*dsqvol,k2buf*dsqvol)}nai=(na[0]+na[1]+na[2]+na[3])/4}