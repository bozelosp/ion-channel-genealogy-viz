NEURON{SUFFIXip3cumUSEIONip3READip3i,iip3WRITEip3iVALENCE1GLOBALvrat}DEFINENannuli4UNITS{(molar)=(1/liter)(mM)=(millimolar)(uM)=(micromolar)(um)=(micron)(mA)=(milliamp)FARADAY=(faraday)(coulomb)PI=(pi)(1)}PARAMETER{DIP3=0.283(um2/ms)kdegr=0.14e-3(/ms)}CONSTANT{ip3i0=0.16e-3(mM)}ASSIGNED{diam(um)iip3(mA/cm2)ip3i(mM)vrat[Nannuli]}STATE{ip3[Nannuli](mM)<1e-6>}BREAKPOINT{SOLVEstateMETHODsparse}LOCALfactors_doneINITIAL{if(factors_done==0){factors_done=1factors()}ip3i=ip3i0FROMi=0TONannuli-1{ip3[i]=ip3i}}LOCALfrat[Nannuli]PROCEDUREfactors(){LOCALr,dr2r=1/2dr2=r/(Nannuli-1)/2vrat[0]=0frat[0]=2*rFROMi=0TONannuli-2{vrat[i]=vrat[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vrat[i+1]=PI*(r+dr2/2)*2*dr2}}LOCALdsq,dsqvolKINETICstate{COMPARTMENTi,diam*diam*vrat[i]{ip3ip3i0}LONGITUDINAL_DIFFUSIONi,DIP3*diam*diam*vrat[i]{ip3}~ip3[0]<<(-iip3*PI*diam*(1e4)/FARADAY)FROMi=0TONannuli-2{~ip3[i]<->ip3[i+1](DIP3*frat[i+1],DIP3*frat[i+1])}dsq=diam*diamFROMi=0TONannuli-1{dsqvol=dsq*vrat[i]~ip3[i]<->ip3i0(kdegr*dsqvol,kdegr*dsqvol)}ip3i=ip3[0]}