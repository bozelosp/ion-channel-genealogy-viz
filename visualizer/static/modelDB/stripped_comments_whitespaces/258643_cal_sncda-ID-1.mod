NEURON{SUFFIXcalUSEIONcaREADeca,cai,caoWRITEicaRANGEgbar,ica,gRANGEm,h,fEXTERNALapc_metap,fpc_metapGLOBALkf,taufGLOBALvhm,km,Ctm,tm0,vhtm,atmGLOBALvhh,kh,th0GLOBALq10,tadjRANGEminf,taum,hinf,tauh,finfGLOBALVhalf,taumod}UNITS{(mA)=(milliamp)(mV)=(millivolt)F=9.6485e4(coul)R=8.3145(joule/degC)(S)=(siemens)(mM)=(milli/liter)}PARAMETER{v(mV)celsius(degC)gbar=.003(cm/s)cai(mM)cao(mM)kf=.001(mM)tauf=30(ms)vhm=-35(mV)km=5.5(mV)Ctm=0.2(ms)atm=12(mV)vhtm=-35(mV)tm0=0.2(ms)vhh=-55(mV)kh=-8(mV)th0=300(ms)Vhalf=-35(mV)taumod=1temp=30q10=2tadj=1}STATE{mhf}ASSIGNED{vf(mV)ica(mA/cm2)g(cm/s)eca(mV)minftaum(ms)hinftauh(ms)a(1/ms)T(degC)E(volts)z}BREAKPOINT{SOLVEstatesMETHODcnexpg=gbar*m*m*h*fica=g*ghk(v,cai,cao)}INITIAL{setVhalf(Vhalf)setTauMod(taumod)m=minf_cal(v)h=hinf_cal(v)f=finf_cal(cai)tadj=tadj_ca_l()}FUNCTIONfca(cai(mM)){fca=kf/(kf+cai)}FUNCTIONghk(v(mV),ci(mM),co(mM))(mV){LOCALnu,ff=KTF(celsius)/2nu=v/fghk=-f*(1.-(ci/co)*exp(nu))*efun(nu)}FUNCTIONKTF(celsius(degC))(mV){KTF=((25.26(mV)/293.15(degC))*(celsius+273.15(degC)))}FUNCTIONefun(z){if(fabs(z)<1e-4){efun=1-z/2}else{efun=z/(exp(z)-1)}}DERIVATIVEstates{m'=(minf_cal(v)-m)/(tadj*taum_cal(v))h'=(hinf_cal(v)-h)/(tadj*tauh_cal(v))f'=(finf_cal(cai)-f)/(tadj*tauf)}FUNCTIONboltz(x,y,z){boltz=1/(1+exp(-(x-y)/z))}FUNCTIONfinf_cal(cai(mM))(1){finf_cal=1/(1+(cai/kf))}FUNCTIONminf_cal(v(mV))(1){minf_cal=boltz(v,vhm,km)}FUNCTIONtaum_cal(v(mV))(1/ms){taum_cal=tm0+Ctm/(1+exp((v-vhtm)/atm))}FUNCTIONhinf_cal(v(mV))(1){hinf_cal=0.2+(0.8*boltz(v,vhh,kh))}FUNCTIONtauh_cal(v(mV))(1/ms){tauh_cal=th0}FUNCTIONtadj_ca_l(){tadj_ca_l=1/(q10^((celsius-temp)/10))}PROCEDUREsetVhalf(Vhalf(mV)){vhm=Vhalfvhh=Vhalf-21vhtm=vhm}PROCEDUREsetTauMod(taumod){tm0=0.2*taumodCtm=0.2*taumodth0=300*taumodtauf=30*taumod}