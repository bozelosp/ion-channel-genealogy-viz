NEURON{POINT_PROCESSghknmdaUSEIONnaWRITEinaUSEIONkWRITEikUSEIONcaREADcai,caoWRITEicaRANGEtaur,taudRANGEinmdaRANGEP,mg,PmaxGLOBALmgb}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)(molar)=(1/liter)(mM)=(millimolar)FARADAY=(faraday)(coulomb)R=(k-mole)(joule/degC)}PARAMETER{taur=5(ms)<1e-9,1e9>taud=50(ms)<1e-9,1e9>cai=100e-6(mM)cao=2(mM)nai=18(mM)nao=140(mM)ki=140(mM)ko=5(mM)celsius(degC)mg=2(mM)Pmax=1e-6(cm/s)}ASSIGNED{ina(nA)ik(nA)ica(nA)v(mV)P(cm/s)factormgb(1)inmda(nA)Area(cm2)}STATE{A(cm/s)B(cm/s)}INITIAL{LOCALtpif(taur/taud>.9999){taur=.9999*taud}A=0B=0tp=(taur*taud)/(taud-taur)*log(taud/taur)factor=-exp(-tp/taur)+exp(-tp/taud)factor=1/factorArea=1}BREAKPOINT{SOLVEstateMETHODcnexpP=B-Amgb=mgblock(v)ina=P*mgb*ghk(v,nai,nao,1)*Areaica=P*10.6*mgb*ghk(v,cai,cao,2)*Areaik=P*mgb*ghk(v,ki,ko,1)*Areainmda=ica+ik+ina}DERIVATIVEstate{A'=-A/taurB'=-B/taud}FUNCTIONghk(v(mV),ci(mM),co(mM),z)(0.001coul/cm3){LOCALarg,eci,ecoarg=(0.001)*z*FARADAY*v/(R*(celsius+273.15))eco=co*efun(arg)eci=ci*efun(-arg)ghk=(0.001)*z*FARADAY*(eci-eco)}FUNCTIONefun(z){if(fabs(z)<1e-4){efun=1-z/2}else{efun=z/(exp(z)-1)}}FUNCTIONmgblock(v(mV))(1){TABLEDEPENDmgFROM-140TO80WITH1000mgblock=1/(1+exp(0.062(/mV)*-v)*(mg/3.57(mM)))}NET_RECEIVE(weight(uS)){state_discontinuity(A,A+Pmax*factor)state_discontinuity(B,B+Pmax*factor)}