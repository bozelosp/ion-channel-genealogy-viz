NEURON{SUFFIXsomacarPOINTERstim_iUSEIONcaREADecaWRITEicaRANGEflag,curr,gcabar,m,h,sh,count,delta2,vrun2RANGEflag,inf,fac,tau,flag,eca2}UNITS{(mA)=(milliamp)(mV)=(millivolt)}PARAMETER{currsh=0(mV)eca=140(mV)gcabar=0(mho/cm2)celsius=34(degC)count=1vrun(mV)delta=0vinit=-76.2alpha=1.1sh2alphash1=0.15vvrun=0timestep=1000vrun2v0dv0ddvflag=0FCa=2PCa=1BCa=2CCa=50stim_moltCa=1eca2=140(mV)}ASSIGNED{v(mV)ica(mA/cm2)ecar(mV)inf[2]fac[2]tau[2]stim_i}STATE{mh}INITIAL{m=0h=1vrun=0vvrun=vrunrates(v)ica=gcabar*m*m*m*h*(v-eca)}BREAKPOINT{SOLVEstatesMETHODcnexpeca2=eca+vvrun*alphaica=gcabar*m*m*m*h*(v-eca)}DERIVATIVEstates{rates(v)m'=(inf[0]-m)/tau[0]h'=(inf[1]-h)/tau[1]}BEFORESTEP{LOCALiif(stim_i==0&&flag==0){vrun=0vvrun=0}else{flag=1delta=v-vinitif(count<timestep+1){vrun=(delta-vrun)*(FCa/(count+1))+vrunvrun2=vrun}else{vrun2=(delta)*(FCa/(timestep+1))+vrun2*pow((1-FCa/(timestep+1)),PCa)}vvrun=(BCa*vrun2/(1+vrun2/CCa))count=count+1}sh2=sh+alphash1*vvrun}PROCEDURErates(v(mV)){LOCALica,iFROMi=0TO1{tau[i]=vartau(i)inf[i]=varss(v-sh2,i)}}FUNCTIONvarss(v(mV),i){if(i==0){varss=1/(1+exp((v+60)/(-3)))}elseif(i==1){varss=1/(1+exp((v+62)/(1)))}}FUNCTIONvartau(i){if(i==0){vartau=100}elseif(i==1){vartau=5}}