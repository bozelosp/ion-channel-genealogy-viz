UNITS{}NEURON{SUFFIXCaSPRANGEK1,K2,K3,K4,K5i,K6i,KRANGERmax,Umax,t1,t2RANGEphi1,phi2,phi3,phi4RANGEC1i,C1n1,C1n2,C1n3,C1n4RANGEC2i,C2n1,C2n2,C2n3,C2n4RANGEC3,C4,C5,alphaUSEIONmgWRITEmgiVALENCE2USEIONclREADcli}PARAMETER{K1=3000K2=3K3=400K4=1K5i=4e5K6i=150K=850SF_AM=5Rmax=10Umax=2000t1=1t2=13CS0=0.03B0=0.00043T0=0.00007phi1=0.004phi2=0.98phi3=0.0002phi4=0.999C1i=0.154C1n1=0.01C1n2=0.15C1n3=0.01C1n4=85C2i=0.11C2n1=-0.0315C2n2=0.27C2n3=0.015C2n4=70C3=54.717C4=-18.847C5=3.905alpha=1.65vth=-55spK_index=0}STATE{CaSRCaSRCSCaCaPCaTAMC1C2mgi}ASSIGNED{v(mV)Rt_shiftR_OnSpiKe_OnK5K6AMinfAMtauC1infC1tauC2infC2tauclispK[100]xm[2]vmphi0}BREAKPOINT{LOCALi,temp_RSPK_DETECT(v,t)CaR(CaSR,t)SOLVEstateMETHODcnexpmgi=AM^alphaxm[0]=xm[1]xm[1]=clivm=(xm[1]-xm[0])/(dt*10^-3)}DERIVATIVEstate{rate(cli,CaT,AM,t)CaSR'=-K1*CS0*CaSR+(K1*CaSR+K2)*CaSRCS-R+U(Ca)CaSRCS'=K1*CS0*CaSR-(K1*CaSR+K2)*CaSRCSCa'=-K5*T0*Ca+(K5*Ca+K6)*CaT-K3*B0*Ca+(K3*Ca+K4)*CaP+R-U(Ca)CaP'=K3*B0*Ca-(K3*Ca+K4)*CaPCaT'=K5*T0*Ca-(K5*Ca+K6)*CaTAM'=(AMinf-AM)/AMtauC1'=(C1inf-C1)/C1tauC2'=(C2inf-C2)/C2taumgi'=0}PROCEDURESPK_DETECT(v(mv),t(ms)){if(SpiKe_On==0&&v>vth){SpiKe_On=1spK[spK_index]=tspK_index=spK_index+1R_On=1}elseif(v<vth){SpiKe_On=0}}FUNCTIONU(x){if(x>=0){U=Umax*(x^2*K^2/(1+x*K+x^2*K^2))^2}else{U=0}}FUNCTIONphi(x){if(x<=5){phi=phi1*x+phi2phi0=phi}else{phi=phi3*x+phi4phi0=phi}}PROCEDURECaR(CaSR(M),t(ms)){LOCALi,temp_Rif(R_On==1){FROMi=0TOspK_index-1{temp_R=temp_R+CaSR*Rmax*(1-exp(-(t-spK[i])/t1))*exp(-(t-spK[i])/t2)}R=temp_Rtemp_R=0}else{R=0}}PROCEDURErate(cli(M),CaT(M),AM(M),t(ms)){K5=phi(cli)*K5iK6=K6i/(1+SF_AM*AM)AMinf=0.5*(1+tanh(((CaT/T0)-C1)/C2))AMtau=C3/(cosh(((CaT/T0)-C4)/(2*C5)))C1inf=C1n1*(1+tanh(((CaT/T0)-C1n2)/C1n3))+C1iC1tau=C1n4C2inf=C2n1*(1+tanh(((CaT/T0)-C2n2)/C2n3))+C2iC2tau=C2n4}INITIAL{LOCALiCaSR=0.0025CaSRCS=0Ca=1e-10CaP=0CaT=0AM=0C1=C1iC2=C2imgi=0FROMi=0TO99{spK[i]=0}spK_index=0R_On=0phi0=0}