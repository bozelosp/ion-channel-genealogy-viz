NEURON{SUFFIXFRAPUSEIONfrapionREADfrapiono,frapioniWRITEfrapioniVALENCE1GLOBALvol,Buffer0RANGEfrapion0,Alpha}DEFINENANN4UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)}PARAMETER{DFree=0.3(um2/ms)frapion0=50e-6(mM)diam(um)frapiono(mM)Alpha=0.0(1/ms)}ASSIGNED{frapioni(mM)vol[NANN](1)}STATE{frapion[NANN](mM)frapionBuffer[NANN](mM)Buffer[NANN](mM)}BREAKPOINT{SOLVEstateMETHODsparse}LOCALcoord_doneINITIAL{if(coord_done==0){coord_done=1coord()}frapioni=frapion0FROMi=0TONANN-1{frapion[i]=frapioni}}LOCALfrat[NANN]PROCEDUREcoord(){LOCALr,dr2r=1/2dr2=r/(NANN-1)/2vol[0]=0frat[0]=2*rFROMi=0TONANN-2{vol[i]=vol[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vol[i+1]=PI*(r+dr2/2)*2*dr2}}KINETICstate{COMPARTMENTi,diam*diam*vol[i]{frapion}LONGITUDINAL_DIFFUSIONj,DFree*diam*diam*vol[j]{frapion}FROMi=0TONANN-2{~frapion[i]<->frapion[i+1](DFree*frat[i+1],DFree*frat[i+1])~frapion[i]<<(-Alpha*diam*diam*frapion[i])}frapioni=frapion[0]}