UNITS{(mA)=(milliamp)(mV)=(millivolt)}PARAMETER{v(mV)dt(ms)areacelsius(degC)gamma=10(pS)eta=8(1/um2)deterministic=0vhalfn=11(mV)vhalfl=-56(mV)a0l=0.05(/ms)a0n=0.05(/ms)zetan=-1.5(1)zetal=3(1)gmn=0.55(1)gml=1(1)lmin=2(mS)nmin=0.1(mS)pw=-1(1)tq=-40qq=5q10=5qtl=1ekvmin=-120(mV)vmax=100(mV)DONT_VECTORIZE}NEURON{SUFFIXskaUSEIONkREADekWRITEikRANGEN,eta,gamma,gka,deterministic,reffGLOBALP_an,P_bn,P_al,P_blGLOBALninf,linf,ltau,ntau,lminGLOBALvmin,vmax,q10GLOBALDONT_VECTORIZE}STATE{nlN0L0N1L0N0L1N1L1n0l0_n1l0n0l0_n0l1n1l0_n1l1n1l0_n0l0n0l1_n1l1n0l1_n0l0n1l1_n0l1n1l1_n1l0}ASSIGNED{ik(mA/cm2)ninflinfltau(ms)ntau(ms)gka(pS/um2)an(/ms)bn(/ms)al(/ms)bl(/ms)reff(pS/um2)Nscale_dens(pS/um2)P_anP_bnP_alP_bl}INITIAL{rates(v)n=ninfl=linfscale_dens=gamma/areareff=eta*gammaN=floor(eta*area+0.5)N1L1=floor(n*l*N+0.5)N1L0=floor(n*(1-l)*N+0.5)N0L1=floor((1-n)*l*N+0.5)N0L0=N-N1L1-N1L0-N0L1n0l0_n1l0=0n0l0_n0l1=0n1l0_n1l1=0n1l0_n0l0=0n0l1_n1l1=0n0l1_n0l0=0n1l1_n0l1=0n1l1_n1l0=0}BREAKPOINT{SOLVEstatesif(deterministic){if(deterministic-1){gka=n*l*reff}else{gka=floor(n*l*N+0.5)*scale_dens}}else{gka=strap(N1L1)*scale_dens}ik=gka*(v-ek)*(1e-4)}PROCEDUREstates(){VERBATIMexterndoubleBnlDev_RNG();ENDVERBATIMrates(v)n=n+(1-exp(-dt/ntau))*(ninf-n)l=l+(1-exp(-dt/ltau))*(linf-l)P_an=strap(an*dt)P_bn=strap(bn*dt)ChkProb(P_an)ChkProb(P_bn)n0l0_n1l0=BnlDev_RNG(P_an,N0L0)n0l1_n1l1=BnlDev_RNG(P_an,N0L1)n1l1_n0l1=BnlDev_RNG(P_bn,N1L1)n1l0_n0l0=BnlDev_RNG(P_bn,N1L0)N0L0=N0L0-n0l0_n1l0+n1l0_n0l0N1L0=N1L0-n1l0_n0l0+n0l0_n1l0N0L1=N0L1-n0l1_n1l1+n1l1_n0l1N1L1=N1L1-n1l1_n0l1+n0l1_n1l1P_al=strap(al*dt)P_bl=strap(bl*dt)ChkProb(P_al)ChkProb(P_bl)n0l0_n0l1=BnlDev_RNG(P_al,N0L0-n0l0_n1l0)n1l0_n1l1=BnlDev_RNG(P_al,N1L0-n1l0_n0l0)n0l1_n0l0=BnlDev_RNG(P_bl,N0L1-n0l1_n1l1)n1l1_n1l0=BnlDev_RNG(P_bl,N1L1-n1l1_n0l1)N0L0=N0L0-n0l0_n0l1+n0l1_n0l0N1L0=N1L0-n1l0_n1l1+n1l1_n1l0N0L1=N0L1-n0l1_n0l0+n0l0_n0l1N1L1=N1L1-n1l1_n1l0+n1l0_n1l1}FUNCTIONalpn(v(mV)){LOCALzetazeta=zetan+pw/(1+exp((v-tq)/qq))alpn=exp(1.e-3*zeta*(v-vhalfn)*9.648e4/(8.315*(273.16+celsius)))}FUNCTIONbetn(v(mV)){LOCALzetazeta=zetan+pw/(1+exp((v-tq)/qq))betn=exp(1.e-3*zeta*gmn*(v-vhalfn)*9.648e4/(8.315*(273.16+celsius)))}FUNCTIONalpl(v(mV)){alpl=exp(1.e-3*zetal*(v-vhalfl)*9.648e4/(8.315*(273.16+celsius)))}FUNCTIONbetl(v(mV)){betl=exp(1.e-3*zetal*gml*(v-vhalfl)*9.648e4/(8.315*(273.16+celsius)))}PROCEDURErates(v(mV)){LOCALa,qtTABLEntau,ltau,ninf,linf,al,bl,an,bnDEPENDq10,celsius,a0n,nmin,lmin,qtlFROMvminTOvmaxWITH199qt=q10^((celsius-24)/10)a=alpn(v)ninf=1/(1+a)ntau=betn(v)/(qt*a0n*(1+a))if(ntau<nmin){ntau=nmin}a=alpl(v)linf=1/(1+a)ltau=0.26*(v+50)/qtlif(ltau<lmin/qtl){ltau=lmin/qtl}al=linf/ltaubl=1/ltau-alan=ninf/ntaubn=1/ntau-an}FUNCTIONstrap(x){if(x<0){strap=0VERBATIMfprintf(stderr,"skaprox.mod:strap:negativestate");ENDVERBATIM}else{strap=x}}PROCEDUREChkProb(p){if(p<0.0||p>1.0){VERBATIMfprintf(stderr,"skaprox.mod:ChkProb:argumentnotaprobability.\n");ENDVERBATIM}}