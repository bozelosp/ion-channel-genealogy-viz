NEURON{POINT_PROCESSostimRANGEradiusRANGEdelay,amp,durRANGEpulses,isi,pcountPOINTERirradiancePOINTERfluxPOINTERphotonsPOINTERtstimonPOINTERtstimoffRANGEwavelength}UNITS{(mW)=(milliwatt)(W)=(watt)PI=(pi)(1)}PARAMETER{radius=100(um)delay=1(ms)dur=5(ms)amp=38(W/cm2)wavelength=4.73e-7(m)h=6.6260693e-34(m2kg/s)c=299792458.0(m/s)pulses=1isi=1(ms)}ASSIGNED{onirradiance(W/cm2)flux(1/mscm2)photons(photons/ms)pcounttstimontstimoff}INITIAL{on=0pcount=pulsesirradiance=0flux=0photons=0net_send(delay,1)tstimon=0tstimoff=0}BEFOREBREAKPOINT{if(on==0){irradiance=0photons=0flux=0}elseif(on==1){calc_irradiance_photons_flux()}}NET_RECEIVE(w){if(flag==1){on=1tstimon=tpcount=pcount-1if(pcount>0){net_send(dur,3)}else{net_send(dur,2)}}elseif(flag==2){on=0tstimoff=t}elseif(flag==3){on=0net_send(isi,1)tstimoff=t}}FUNCTIONcalc_irradiance_photons_flux(){LOCALphoton_energy,areairradiance=ampphoton_energy=h*c/wavelengthflux=(1/1000)*amp/photon_energyarea=PI*(radius^2)photons=1e-8*flux*area}