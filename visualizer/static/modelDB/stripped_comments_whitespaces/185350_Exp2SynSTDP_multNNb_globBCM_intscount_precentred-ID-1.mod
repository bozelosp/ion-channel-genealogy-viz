NEURON{POINT_PROCESSExp2SynSTDP_multNNb_globBCM_intscount_precentredRANGEtau1,tau2,e,i,dtau,ptauRANGEwMaxPOINTERd,pNONSPECIFIC_CURRENTiRANGEg,tpost,start}DEFINEEpspTimes10000UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)}PARAMETER{tau1=.1(ms)<1e-9,1e9>tau2=10(ms)<1e-9,1e9>e=0(mV)dtau=36(ms)ptau=26(ms)wMax=0.01(uS)start=30000(ms)}ASSIGNED{v(mV)i(nA)g(uS)factortpost(ms)presyntime[EpspTimes](ms)countertotal(uS)flagOLDdp}STATE{A(uS)B(uS)}INITIAL{LOCALtptotal=0if(tau1/tau2>.9999){tau1=.9999*tau2}A=0B=0tp=(tau1*tau2)/(tau2-tau1)*log(tau2/tau1)factor=-exp(-tp/tau1)+exp(-tp/tau2)factor=1/factortpost=-100000FROMi=0TOEpspTimes-1{presyntime[i]=-1e9}counter=0net_send(0,1)flagOLD=1}BREAKPOINT{SOLVEstateMETHODcnexpg=B-Ai=g*(v-e)}DERIVATIVEstate{A'=-A/tau1B'=-B/tau2}NET_RECEIVE(w(uS),wE(uS),tpre(ms),X){INITIAL{wE=wtpre=-1e9X=0}if(flag==0){A=A+wE*factorB=B+wE*factortpre=tcounter=counter+1presyntime[counter-1]=tpreif(t>start){X=d*exp((tpost-t)/dtau)wE=wE*(1-X)if(wE>0){}else{wE=0}}flagOLD=flag}elseif(flag==2){FOR_NETCONS(w1,wE1,tpres,X1){if(flagOLD==flag){}else{if(t>start){FROMi=0TOcounter-1{X1=p*exp((presyntime[i]-t)/ptau)wE1=wE1*(1+X1)}if(wE1<wMax){}else{wE1=wMax}FROMi=0TOcounter-1{presyntime[i]=-1e9}counter=0}}}tpost=tflagOLD=flag}else{WATCH(v>-37)2}}