NEURON{THREADSAFEPOINT_PROCESStmGlutRANGEtau1_ampa,tau2_ampa,tau1_nmda,tau2_nmdaRANGEg_ampa,g_nmda,i_ampa,i_nmda,nmda_ratioRANGEe,g,i,q,mgRANGEtau,tauR,tauF,U,u0RANGEca_ratio_ampa,ca_ratio_nmdaRANGEbase,f_ampa,f_nmdaPOINTERpkaNONSPECIFIC_CURRENTiUSEIONcalWRITEicalVALENCE2}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)(mM)=(milli/liter)}PARAMETER{tau1_ampa=2.2(ms)tau2_ampa=11.5(ms)tau1_nmda=5.63(ms)tau2_nmda=320(ms)nmda_ratio=0.5(1)e=0(mV)tau=3(ms)tauR=100(ms)tauF=0(ms)U=0.3(1)<0,1>u0=0(1)<0,1>ca_ratio_ampa=0.005ca_ratio_nmda=0.1mg=1(mM)q=2base=0.0f_ampa=0.0f_nmda=0.0}ASSIGNED{v(mV)i(nA)i_ampa(nA)i_nmda(nA)ical(nA)ical_ampa(nA)ical_nmda(nA)g(uS)g_ampa(uS)g_nmda(uS)factor_ampafactor_nmdaxpka(1)}STATE{A_ampa(uS)B_ampa(uS)A_nmda(uS)B_nmda(uS)}INITIAL{LOCALtp_ampa,tp_nmdaA_ampa=0B_ampa=0tp_ampa=(tau1_ampa*tau2_ampa)/(tau2_ampa-tau1_ampa)*log(tau2_ampa/tau1_ampa)factor_ampa=-exp(-tp_ampa/tau1_ampa)+exp(-tp_ampa/tau2_ampa)factor_ampa=1/factor_ampatau1_ampa=tau1_ampa/qtau2_ampa=tau2_ampa/qA_nmda=0B_nmda=0tp_nmda=(tau1_nmda*tau2_nmda)/(tau2_nmda-tau1_nmda)*log(tau2_nmda/tau1_nmda)factor_nmda=-exp(-tp_nmda/tau1_nmda)+exp(-tp_nmda/tau2_nmda)factor_nmda=1/factor_nmdatau1_nmda=tau1_nmda/qtau2_nmda=tau2_nmda/q}BREAKPOINT{LOCALitotal,mggateSOLVEstateMETHODcnexpmggate=1/(1+exp(-0.062(/mV)*v)*(mg/3.57(mM)))g_ampa=B_ampa-A_ampaitotal=modulation(f_ampa)*g_ampa*(v-e)ical_ampa=ca_ratio_ampa*itotali_ampa=itotal-ical_ampag_nmda=B_nmda-A_nmdaitotal=modulation(f_nmda)*g_nmda*(v-e)*mggatei_nmda=itotal-ical_nmdaical=ical_ampa+ical_nmdai=i_ampa+i_nmdag=g_ampa+g_nmda}DERIVATIVEstate{A_ampa'=-A_ampa/tau1_ampaB_ampa'=-B_ampa/tau2_ampaA_nmda'=-A_nmda/tau1_nmdaB_nmda'=-B_nmda/tau2_nmda}NET_RECEIVE(weight(uS),y,z,u,tsyn(ms)){LOCALweight_ampa,weight_nmdaINITIAL{y=0z=0u=u0tsyn=t}z=z*exp(-(t-tsyn)/tauR)z=z+(y*(exp(-(t-tsyn)/tau)-exp(-(t-tsyn)/tauR))/(tau/tauR-1))y=y*exp(-(t-tsyn)/tau)x=1-y-zif(tauF>0){u=u*exp(-(t-tsyn)/tauF)u=u+U*(1-u)}else{u=U}weight_ampa=weightweight_nmda=weight_ampa*nmda_ratioA_ampa=A_ampa+weight_ampa*factor_ampa*x*uB_ampa=B_ampa+weight_ampa*factor_ampa*x*uA_nmda=A_nmda+weight_nmda*factor_nmda*x*uB_nmda=B_nmda+weight_nmda*factor_nmda*x*uy=y+x*utsyn=t}FUNCTIONmodulation(factor){modulation=1+factor*(pka-base)}