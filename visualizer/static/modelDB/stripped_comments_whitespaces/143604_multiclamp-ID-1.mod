NEURON{POINT_PROCESSMultIClampELECTRODE_CURRENTiRANGEtrf,tpRANGEdel,per,numberRANGEamp,i}UNITS{(mV)=(millivolt)(nS)=(nanosiemens)(nA)=(nanoamp)}PARAMETER{trf(ms)<0,1e9>tp(ms)<0,1e9>del(ms)<0,1e9>per(ms)<0,1e9>numberamp(nA)<0,1e9>}ASSIGNED{v(mV)i(nA)ontallym(1/ms)b(1)dur(ms)t0(ms)}INITIAL{if(trf<=0){trf=0.025UNITSOFFprintf("timerisefallmustbelongerthan0printf("increasedtotrf=%gms\n",trf)UNITSON}if(tp<0){tp=0UNITSOFFprintf("timeplateaumustnotbenegativeprintf("changedtotp=%gms\n",tp)UNITSON}dur=2*trf+tpif(per<=dur){per=durUNITSOFFprintf("periodmustbelongerthantrapezoidduration%gprintf("increasedtoper=%gms\n",per)UNITSON}on=0m=0b=0tally=numberif(tally>0){net_send(del,1)tally=tally-1}}BREAKPOINT{i=amp*(m*(t-t0)+b)}NET_RECEIVE(w){if((on==0)&&(flag==1)){t0=tm=1/trfb=0on=1net_send(trf,2)}if(flag==2){m=0b=1net_send(tp,3)}if(flag==3){t0=tm=-1/trfb=1net_send(trf,4)}if(flag==4){m=0b=0on=0if(tally>0){net_send(per-dur,1)tally=tally-1}}}