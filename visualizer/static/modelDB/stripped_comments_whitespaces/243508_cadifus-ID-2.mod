NEURON{SUFFIXcadifusUSEIONcaREADcao,cai,icaWRITEcai,icaUSEIONip3READip3iWRITEip3iVALENCE1RANGEica_pmp,cai0,fluo,fluoNewRANGEalphaRANGEDip3,Ip3init,modelStim,v_bar_betaGLOBALvrat,TBufs,TBufm,BufferAlpha}DEFINENannuli4UNITS{(mol)=(1)(molar)=(1/liter)(uM)=(micromolar)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)}PARAMETER{Dip3=0.1(um2/ms)Ip3init=0.0000250(mM)Currentip3=0.0(mA/cm2)cai0=50e-6(mM)fluo=0(mM)fluoNew=0DCa=0.22(um2/ms)BufferAlpha=100modelStim=0(mM)kappa_delta=1.5e-3(mM)K_3=1e-3(mM)K_pi=0.6e-3(mM)K_D=0.7(mM)K_p=10e-3(mM)K_PLCdelta=0.1e-3(mM)K_R=1.3e-3(mM)r_bar_5P=0.04e-3(/ms)v_bar_3K=2e-6(mM/ms)v_bar_beta=0.2e-6(mM/ms)v_bar_delta=0.02e-6(mM/ms)TBufs=0.450(mM)kfs=1000(/mM-ms)KDs=10(uM)TBufm=0.075(mM)kfm=1000(/mM-ms)KDm=0.24(uM)DBufm=0.050(um2/ms)cath=0.2e-3(mM)gamma=8(um/s)alpha=1(1)vmax=3.75e-6(mM/ms)Kp=0.27e-3(mM)jmax=3.5e-3(mM/ms)caer=0.400(mM)Kip3=0.8e-3(mM)Kact=0.3e-3(mM)kon=2.7(/mM-ms)Kinh=0.2e-3(mM)}ASSIGNED{diam(um)ica(mA/cm2)ica_pmp(mA/cm2)ica_pmp_last(mA/cm2)parea(um)sump(mM)cai(mM)cao(mM)vrat[Nannuli](1)bufs_0(mM)bufm_0(mM)L[Nannuli](mM/ms)}CONSTANT{volo=1e10(um2)}STATE{ca[Nannuli](mM)<1e-7>bufs[Nannuli](mM)<1e-3>cabufs[Nannuli](mM)<1e-7>bufm[Nannuli](mM)<1e-4>cabufm[Nannuli](mM)<1e-8>hc[Nannuli]ho[Nannuli]ip3i(mM)<1e-10>}BREAKPOINT{SOLVEstateMETHODsparseica_pmp_last=ica_pmpica=ica_pmp}LOCALfactors_done,jxINITIAL{ip3i=Ip3initif(factors_done==0){factors_done=1factors()}cai=cai0bufs_0=KDs*TBufs/(KDs+(1000)*cai0)bufm_0=KDm*TBufm/(KDm+(1000)*cai0)FROMi=0TONannuli-1{ca[i]=caibufs[i]=bufs_0cabufs[i]=TBufs-bufs_0bufm[i]=bufm_0cabufm[i]=TBufm-bufm_0}sump=cathparea=PI*diamica=0ica_pmp=0ica_pmp_last=0FROMi=0TONannuli-1{ho[i]=Kinh/(ca[i]+Kinh)hc[i]=1-ho[i]jx=(-vmax*ca[i]^2/(ca[i]^2+Kp^2))jx=jx+jmax*(1-(ca[i]/caer))*((ip3i/(ip3i+Kip3))*(ca[i]/(ca[i]+Kact))*ho[i])^3L[i]=-jx/(1-(ca[i]/caer))}}LOCALfrat[Nannuli]PROCEDUREfactors(){LOCALr,dr2r=1/2dr2=r/(Nannuli-1)/2vrat[0]=0frat[0]=2*rFROMi=0TONannuli-2{vrat[i]=vrat[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vrat[i+1]=PI*(r+dr2/2)*2*dr2}}LOCALdsq,dsqvol,K_gamma,v_3K,v_delta,v_gluKINETICstate{COMPARTMENTi,diam*diam*vrat[i]{cabufscabufsbufmcabufmsump}COMPARTMENTvolo{cao}COMPARTMENTPI*diam*diam/4{ip3i}LONGITUDINAL_DIFFUSIONi,DCa*diam*diam*vrat[i]{ca}LONGITUDINAL_DIFFUSIONi,DBufm*diam*diam*vrat[i]{bufmcabufm}~ca[0]<->sump((0.001)*parea*gamma*u(ca[0]/(1(mM)),cath/(1(mM))),(0.001)*parea*gamma*u(ca[0]/(1(mM)),cath/(1(mM))))ica_pmp=2*FARADAY*(f_flux-b_flux)/pareaK_gamma=K_R*(1+(K_p/K_R)*ca[0]/(ca[0]+K_pi))v_3K=v_bar_3K*ca[0]^4/(ca[0]^4+K_D^4)*ip3i/(ip3i+K_3)v_delta=v_bar_delta/(1+ip3i/kappa_delta)*ca[0]^2/(ca[0]^2+K_PLCdelta^2)v_glu=v_bar_beta*modelStim/(modelStim+K_gamma)~ip3i<<((PI*diam*diam*(v_glu+v_delta-v_3K-r_bar_5P*ip3i))/2)~ca[0]<<(-(ica-ica_pmp_last)*PI*diam/(2*FARADAY))FROMi=0TONannuli-2{~ca[i]<->ca[i+1](DCa*frat[i+1],DCa*frat[i+1])~bufm[i]<->bufm[i+1](DBufm*frat[i+1],DBufm*frat[i+1])}dsq=diam*diamFROMi=0TONannuli-1{dsqvol=dsq*vrat[i]~ca[i]+bufs[i]<->cabufs[i](kfs*dsqvol,(0.001)*KDs*kfs*dsqvol)~ca[i]+bufm[i]<->cabufm[i](kfm*dsqvol,(0.001)*KDm*kfm*dsqvol)}FROMi=0TONannuli-1{dsqvol=dsq*vrat[i]~ca[i]<<(-dsqvol*alpha*vmax*ca[i]^2/(ca[i]^2+Kp^2))~hc[i]<->ho[i](kon*Kinh,kon*ca[i])~ca[i]<<(dsqvol*alpha*jmax*(1-(ca[i]/caer))*((ip3i/(ip3i+Kip3))*(ca[i]/(ca[i]+Kact))*ho[i])^3)~ca[i]<<(dsqvol*alpha*L[i]*(1-(ca[i]/caer)))}cai=ca[0]fluo=cabufm[0]fluoNew=(BufferAlpha*cabufm[0]+ca[0]-BufferAlpha*(TBufm-bufm_0)-cai0)/(BufferAlpha*(TBufm-bufm_0)+cai0)}FUNCTIONu(x,th){if(x>th){u=1}else{u=0}}