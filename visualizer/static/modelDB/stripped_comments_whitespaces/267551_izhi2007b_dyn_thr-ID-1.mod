NEURON{POINT_PROCESSIzhi2007b_dyn_thrRANGEC,k,vr,v0,u0,vt,vt0,vpeak,dyn_th,u,a,b,c,d,alpha,Vi,Vmin,Ka,Ki,tau,Iin,celltype,alive,cellid,verbose,derivtype,delta,t0NONSPECIFIC_CURRENTi}UNITS{(mV)=(millivolt)(uM)=(micrometer)}PARAMETER{C=1k=0.7vr=-60(mV)v0=-70(mV)u0=0vt0=-40(mV)vpeak=35(mV)dyn_th=0a=0.03b=-2c=-50d=100Iin=0alpha=0.3Vi=-41.0Vmin=-37.0Ka=7Ki=8.75tau=6.5celltype=1alive=1cellid=-1}ASSIGNED{v(mV)i(nA)u(mV)vt(mV)deltat0derivtype}INITIAL{u=u0if(dyn_th==1){vt=vt_thetainf(vr)}else{vt=vt0}derivtype=2net_send(0,1)}BREAKPOINT{delta=t-t0if(celltype<5){if(t>0){u=u+delta*a*(b*(v-vr)-u)if(dyn_th==1){vt=vt+delta*(vt_thetainf(v)-vt)/tau}}}else{if(celltype==5){if(v<d){u=u+delta*a*(0-u)}else{u=u+delta*a*((0.025*(v-d)*(v-d)*(v-d))-u)}}if(celltype==6){if(v>-65){b=0}else{b=15}u=u+delta*a*(b*(v-vr)-u)}if(celltype==7){if(v>-65){b=2}else{b=10}u=u+delta*a*(b*(v-vr)-u)}}t0=ti=-(k*(v-vr)*(v-vt)-u+Iin)/C/1000}FUNCTIONvt_thetainf(v(mV))(mV){vt_thetainf=alpha*(v-Vi)+Vmin+Ka*log(1+exp((v-Vi)/Ki))}FUNCTIONderivfunc(){if(celltype==5&&derivtype==2){derivfunc=a*(0-u)}elseif(celltype==5&&derivtype==1){derivfunc=a*((0.025*(v-d)*(v-d)*(v-d))-u)}elseif(celltype==5){VERBATIMhoc_execerror("izhi2007b.modERRA:derivtypenotset",0);ENDVERBATIM}else{derivfunc=a*(b*(v-vr)-u)}}NET_RECEIVE(w){if(flag==1){if(celltype==4){WATCH(v>(vpeak-0.1*u))2}elseif(celltype==6){WATCH(v>(vpeak+0.1*u))2}else{WATCH(v>vpeak)2}if(celltype==6||celltype==7){WATCH(v>-65)3WATCH(v<-65)4}if(celltype==5){WATCH(v>d)3WATCH(v<d)4}v=v0}elseif(flag==2){if(alive){net_event(t)}if(celltype==4){v=c+0.04*uif((u+d)<670){u=u+d}else{u=670}}elseif(celltype==5){v=c}elseif(celltype==6){v=c-0.1*uu=u+d}else{v=cu=u+d}}elseif(flag==3){if(celltype==5){derivtype=1}elseif(celltype==6){b=0}elseif(celltype==7){b=2}}elseif(flag==4){if(celltype==5){derivtype=2}elseif(celltype==6){b=15}elseif(celltype==7){b=10}}}