DEFINEMAXSYNNMDA250VERBATIMstaticintMAXSYNNMDA=250;ENDVERBATIMINDEPENDENT{tFROM0TO1WITH1(ms)}NEURON{POINT_PROCESSmultiNMDANONSPECIFIC_CURRENTiRANGERon,Roff,ri,nsyn,non,g,gmax,BGLOBALCmax,Cdur,Alpha,Beta,ErevGLOBALPrethresh,Deadtime,Rinf,Rtau,mg}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(umho)=(micromho)(mM)=(milli/liter)}PARAMETER{dt(ms)Cmax=0.5(mM)Cdur=0.3(ms)Alpha=0.11(/msmM)Beta=0.0064(/ms)Erev=0(mV)gmax(umho)Prethresh=0Deadtime=1(ms)mg=1(mM)}ASSIGNED{on[MAXSYNNMDA]TL[MAXSYNNMDA](ms)ri[MAXSYNNMDA]lastrelease[MAXSYNNMDA](ms)RonRoffnsynnonRinfRtau(ms)v(mV)i(nA)g(umho)trel(ms)ptr_array_nmdaB}INITIAL{LOCALjFROMj=0TOnsyn-1{on[j]=0TL[j]=-9e9lastrelease[j]=-9e9ri[j]=0}Ron=0Roff=0non=0Rinf=Cmax*Alpha/(Cmax*Alpha+Beta)Rtau=1/((Alpha*Cmax)+Beta)}BREAKPOINT{if(gmax>0){SOLVEreleaseB=mgblock(v)g=gmax*(Ron+Roff)*Bi=g*(v-Erev)}else{i=0}}PROCEDURErelease(){LOCALq,jFROMj=0TOnsyn-1{trel=((t-lastrelease[j])-Cdur)if(trel>Deadtime){if(presynaptic(j)>Prethresh){on[j]=1non=non+1lastrelease[j]=tri[j]=ri[j]*exptable(-Beta*(t-TL[j]))TL[j]=tRon=Ron+ri[j]Roff=Roff-ri[j]if(Roff<1e-9){Roff=0}}}elseif(trel<0){}elseif(on[j]>0){on[j]=0non=non-1ri[j]=Rinf+(ri[j]-Rinf)*exptable(-(t-TL[j])/Rtau)TL[j]=tRon=Ron-ri[j]Roff=Roff+ri[j]if(Ron<1e-9){Ron=0}}}if(Roff>0){Roff=Roff*exptable(-Beta*dt)if(Roff<1e-9){Roff=0}}if(non>0){q=non*RinfRon=q+(Ron-q)*exptable(-dt/Rtau)}}FUNCTIONexptable(x){TABLEFROM-25TO25WITH10000if((x>-25)&&(x<25)){exptable=exp(x)}else{exptable=0.}}FUNCTIONmgblock(v(mV)){TABLEDEPENDmgFROM-140TO80WITH1000mgblock=1/(1+exp(0.062(/mV)*-v)*(mg/3.57(mM)))}VERBATIM#defineppnmda((double***)(&(ptr_array_nmda)))externdouble*hoc_pgetarg();ENDVERBATIMPROCEDUREallocate(n){VERBATIMif(*ppnmda){free(*ppnmda);}*ppnmda=((double**)hoc_Ecalloc((int)_ln,sizeof(double*))),hoc_malchk();ENDVERBATIM}FUNCTIONpresynaptic(index){VERBATIMif(_lindex>=nsyn){printf("Warning:attempttousepointeroutsiderange\n");printf("tryingtousepointernumber%d\n",(int)_lindex);printf("butnumberofdefinedpointerswasnsyn=%d.\n",(int)nsyn);}_lpresynaptic=*((*ppnmda)[(int)_lindex]);ENDVERBATIM}PROCEDUREaddlink(){VERBATIMif(++nsyn>MAXSYNNMDA){printf("ExceedingmaximumofallowedlinksMAXSYNNMDA=%d\n",MAXSYNNMDA);printf("editthenmodlcodetoincreasethemaximumallowed.\n");exit(-1);}(*ppnmda)[(int)(nsyn-1)]=hoc_pgetarg(1);ENDVERBATIM}