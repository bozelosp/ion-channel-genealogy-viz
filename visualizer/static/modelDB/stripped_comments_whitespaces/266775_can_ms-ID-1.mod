UNITS{(mV)=(millivolt)(mA)=(milliamp)(S)=(siemens)(molar)=(1/liter)(mM)=(millimolar)FARADAY=(faraday)(coulomb)R=(k-mole)(joule/degC)}NEURON{SUFFIXcan_msUSEIONcaREADcai,caoWRITEicaVALENCE2RANGEpbar,icaRANGEdamod,maxMod,level}PARAMETER{pbar=0.0(cm/s)a=0.21q=3damod=0maxMod=1level=0}ASSIGNED{v(mV)ica(mA/cm2)eca(mV)celsius(degC)cai(mM)cao(mM)minfmtau(ms)hinfhtau(ms)}STATE{mh}BREAKPOINT{SOLVEstatesMETHODcnexpica=pbar*m*m*(h*a+1-a)*ghk(v,cai,cao)*modulation()}INITIAL{rates()m=minfh=hinf}DERIVATIVEstates{rates()m'=(minf-m)/mtau*qh'=(hinf-h)/htau*q}PROCEDURErates(){UNITSOFFminf=1/(1+exp((v-(-3))/(-8)))mtau=0.06+1/(exp((v-25)/18)+exp((v-(-31))/(-44)))hinf=1/(1+exp((v-(-74.8))/6.5))htau=70UNITSON}FUNCTIONghk(v(mV),ci(mM),co(mM))(.001coul/cm3){LOCALz,eci,ecoz=(1e-3)*2*FARADAY*v/(R*(celsius+273.15))eco=co*efun(z)eci=ci*efun(-z)ghk=(1e-3)*2*FARADAY*(eci-eco)}FUNCTIONefun(z){if(fabs(z)<1e-4){efun=1-z/2}else{efun=z/(exp(z)-1)}}FUNCTIONmodulation(){modulation=1+damod*(maxMod-1)*level}