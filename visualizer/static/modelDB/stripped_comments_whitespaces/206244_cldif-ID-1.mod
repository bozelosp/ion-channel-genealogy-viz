NEURON{SUFFIXcldifusUSEIONclREADiclWRITEcli,eclVALENCE-1USEIONhco3READhco3i,hco3oVALENCE-1GLOBALvratRANGEtau,cli0,clo0,egaba,delta_egaba,init_egaba,ehco3,ecl}DEFINENannuli11UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)(mV)=(millivolt)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)F=(faraday)(coulombs)R=(k-mole)(joule/degC)}PARAMETER{DCl=2(um2/ms)tau=3000(ms)cli0=7.5(mM)clo0=136.1(mM)hco3i0=16(mM)hco3o0=26(mM)P=0.18celsius=34(degC)}ASSIGNED{diam(um)icl(mA/cm2)cli(mM)hco3i(mM)hco3o(mM)vrat[Nannuli]egaba(mV)ehco3(mV)ecl(mV)init_egaba(mV)delta_egaba(mV)}STATE{cl[Nannuli](mM)<1e-10>}BREAKPOINT{SOLVEstateMETHODsparseecl=log(cli/clo0)*(1000)*(celsius+273.15)*R/Fegaba=P*ehco3+(1-P)*ecldelta_egaba=egaba-init_egaba}LOCALfactors_doneINITIAL{if(factors_done==0){factors_done=1factors()}cli=cli0hco3i=hco3i0hco3o=hco3o0FROMi=0TONannuli-1{cl[i]=cli}ehco3=log(hco3i/hco3o)*(1000)*(celsius+273.15)*R/Fecl=log(cli/clo0)*(1000)*(celsius+273.15)*R/Fegaba=P*ehco3+(1-P)*eclinit_egaba=egabadelta_egaba=egaba-init_egaba}LOCALfrat[Nannuli]PROCEDUREfactors(){LOCALr,dr2r=1/2dr2=r/(Nannuli-1)/2vrat[0]=0frat[0]=2*rFROMi=0TONannuli-2{vrat[i]=vrat[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vrat[i+1]=PI*(r+dr2/2)*2*dr2}}KINETICstate{COMPARTMENTi,diam*diam*vrat[i]{cl}LONGITUDINAL_DIFFUSIONi,DCl*diam*diam*vrat[i]{cl}~cl[0]<<((icl*PI*diam/FARADAY)+(diam*diam*vrat[0]*(cli0-cl[0])/tau))FROMi=0TONannuli-2{~cl[i]<->cl[i+1](DCl*frat[i+1],DCl*frat[i+1])}cli=cl[0]}