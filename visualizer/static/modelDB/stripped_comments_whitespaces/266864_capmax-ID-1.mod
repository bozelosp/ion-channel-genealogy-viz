NEURON{SUFFIXcapmaxPOINTERicapRANGEi,tp,debug,i1,i2,i3,lockit,i1,i2,i3,up}PARAMETER{debug=0}ASSIGNED{i(milliamp/cm2)tp(ms)icap(milliamp/cm2)i1i2i3}STATE{uplockit}INITIAL{i=0tp=0lockit=-1up=0i1=0i2=0i3=0}BREAKPOINT{SOLVEmx}PROCEDUREabsmx(){if(fabs(icap)>i){i=fabs(icap)tp=t}}PROCEDUREmxpos(){if(icap>i){i=icaptp=t}}PROCEDUREmx(){if(up==1){if(lockit<0){if(icap>i){i=icaptp=t}if(debug==1){VERBATIMfprintf(stdout,"Lockit%f\tup:%f\tt:%f\ti:%f\n",lockit,up,t,i);ENDVERBATIM}}}if((t>10)&&(icap>i3)&&(i3>i2)&&(i2>i1)){up=1}else{up=0}if((icap>0)&&(icap<i*0.75)&&((t-tp)<2)){lockit=1}i1=i2i2=i3i3=icap}