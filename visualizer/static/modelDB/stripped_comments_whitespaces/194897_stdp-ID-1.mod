NEURON{POINT_PROCESSSTDPPOINTERsynweightRANGEtauhebb,tauantiRANGEhebbwt,antiwtRANGERLwindhebb,RLwindantiRANGEuseRLexpRANGERLlenhebb,RLlenantiRANGERLhebbwt,RLantiwtRANGEwmaxRANGEsoftthreshRANGESTDPonRANGERLonRANGEverboseRANGEtlastpre,tlastpostRANGEtlasthebbelig,tlastantieligRANGEintervalRANGEdeltawRANGEnewweightRANGEskip}ASSIGNED{synweighttlastpre(ms)tlastpost(ms)tlasthebbelig(ms)tlastantielig(ms)interval(ms)deltawnewweight}INITIAL{tlastpre=-1tlastpost=-1tlasthebbelig=-1tlastantielig=-1interval=0deltaw=0newweight=0}PARAMETER{tauhebb=10(ms)tauanti=10(ms)hebbwt=1.0antiwt=-1.0RLwindhebb=10(ms)RLwindanti=10(ms)useRLexp=0RLlenhebb=100(ms)RLlenanti=100(ms)RLhebbwt=1.0RLantiwt=-1.0wmax=15.0softthresh=0STDPon=1RLon=1verbose=0skip=0}NET_RECEIVE(w){deltaw=0.0skip=0if(verbose>1){printf("t=%f(BEFORE)tlaspre=%f,tlastpost=%f,flag=%f,w=%f,deltaw=%f\n",t,tlastpre,tlastpost,flag,w,deltaw)}if((flag==-1)&&(tlastpre!=t-1)){skip=1deltaw=hebbwt*exp(-interval/tauhebb)if(softthresh==1){deltaw=softthreshold(deltaw)}adjustweight(deltaw)if(verbose>1){printf("HebbianSTDPevent}elseif((flag==1)&&(tlastpost!=t-1)){skip=1deltaw=antiwt*exp(interval/tauanti)if(softthresh==1){deltaw=softthreshold(deltaw)}adjustweight(deltaw)if(verbose>1){printf("anti-HebbianSTDPevent}if(skip==0){if(w>=0){interval=tlastpost-tif((tlastpost>-1)&&(-interval>1.0)){if(STDPon==1){if(verbose>1){printf("net_send(1,1)\n")}net_send(1,1)}if((RLon==1)&&(-interval<=RLwindanti)){tlastantielig=t}}tlastpre=t}else{interval=t-tlastpreif((tlastpre>-1)&&(interval>1.0)){if(STDPon==1){if(verbose>1){printf("net_send(1,-1)\n")}net_send(1,-1)}if((RLon==1)&&(interval<=RLwindhebb)){tlasthebbelig=t}}tlastpost=t}}if(verbose>1){printf("t=%f(AFTER)tlaspre=%f,tlastpost=%f,flag=%f,w=%f,deltaw=%f\n",t,tlastpre,tlastpost,flag,w,deltaw)}}PROCEDUREreward_punish(reinf){if(RLon==1){deltaw=0.0deltaw=deltaw+reinf*hebbRL()deltaw=deltaw+reinf*antiRL()if(softthresh==1){deltaw=softthreshold(deltaw)}adjustweight(deltaw)if(verbose>0){printf("RLevent}}FUNCTIONhebbRL(){if((RLon==0)||(tlasthebbelig<0.0)){hebbRL=0.0}elseif(useRLexp==0){if(t-tlasthebbelig<=RLlenhebb){hebbRL=RLhebbwt}else{hebbRL=0.0}}else{hebbRL=RLhebbwt*exp((tlasthebbelig-t)/RLlenhebb)}}FUNCTIONantiRL(){if((RLon==0)||(tlastantielig<0.0)){antiRL=0.0}elseif(useRLexp==0){if(t-tlastantielig<=RLlenanti){antiRL=RLantiwt}else{antiRL=0.0}}else{antiRL=RLantiwt*exp((tlastantielig-t)/RLlenanti)}}FUNCTIONsoftthreshold(rawwc){if(rawwc>=0){softthreshold=rawwc*(1.0-synweight/wmax)}else{softthreshold=rawwc*synweight/wmax}}PROCEDUREadjustweight(wc){synweight=synweight+wcif(synweight>wmax){synweight=wmax}if(synweight<0){synweight=0}}