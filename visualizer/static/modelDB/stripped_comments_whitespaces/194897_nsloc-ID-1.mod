NEURON{ARTIFICIAL_CELLNSLOCRANGEinterval,number,start,xloc,yloc,zloc,id,type,subtype,fflag,mlenmin,mlenmax,checkIntervalRANGEnoiseTHREADSAFEPOINTERdonotuse}PARAMETER{interval=100(ms)<1e-9,1e9>number=3000<0,1e9>start=1(ms)noise=0<0,1>xloc=-1yloc=-1zloc=-1id=-1type=-1subtype=-1fflag=1check_interval=1.0(ms)}ASSIGNED{event(ms)last_interval(ms)transitiononispikedonotuse}PROCEDUREseed(x){set_seed(x)}INITIAL{on=0ispike=0if(noise<0){noise=0}if(noise>1){noise=1}if(start>=0&&number>0){on=1event=start+invl(interval)-interval*(1.-noise)if(event<0){event=0}net_send(event,3)}}PROCEDUREinit_sequence(t(ms)){if(number>0){on=1event=0ispike=0}}FUNCTIONinvl(mean(ms))(ms){if(mean<=0.){mean=.01(ms)}if(noise==0){invl=mean}else{invl=(1.-noise)*mean+noise*mean*erand()}}VERBATIM#ifndefNRN_VERSION_GTEQ_8_2_0doublenrn_random_pick(void*r);void*nrn_random_arg(intargpos);#defineRANDCAST#else#defineRANDCAST(Rand*)#endifENDVERBATIMFUNCTIONerand(){VERBATIMif(_p_donotuse){_lerand=nrn_random_pick(RANDCAST_p_donotuse);}else{if(_nt!=nrn_threads){hoc_execerror("multithreadrandominNetStim","onlyviahocRandom");}ENDVERBATIMerand=exprand(1)VERBATIM}ENDVERBATIM}PROCEDUREnoiseFromRandom(){VERBATIM{void**pv=(void**)(&_p_donotuse);if(ifarg(1)){*pv=nrn_random_arg(1);}else{*pv=(void*)0;}}ENDVERBATIM}PROCEDUREnext_invl(){if(number>0){event=invl(interval)}if(ispike>=number){on=0}}NET_RECEIVE(w){if(flag==0){if(w>0&&on==0){init_sequence(t)next_invl()event=event-interval*(1.-noise)net_send(event,1)}elseif(w<0){on=0}}if(flag==3){if(on==1){init_sequence(t)net_send(0,1)net_send(2*check_interval,4)}}if(flag==1&&on==1){ispike=ispike+1net_event(t)next_invl()transition=0if(on==1){net_send(event,1)}}if(flag==5&&on==1&&transition==1){ispike=ispike+1net_event(t)next_invl()if(on==1){net_send(event,5)}}if(flag==4&&on==1){if(interval<last_interval){next_invl()transition=1net_send(event,5)}last_interval=intervalnet_send(check_interval,4)}if(flag==1&&on==0){net_event(t)}}