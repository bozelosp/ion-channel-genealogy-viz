NEURON{SUFFIXcarPOINTERstim_iUSEIONcaREADcai,caoWRITEicaRANGEflag,curr,gcabar,m,h,ica,sh,count,delta2,vrun2,stim_moltCaRANGEcurr,inf,fac,tau}UNITS{(mA)=(milliamp)(mV)=(millivolt)(molar)=(1/liter)(mM)=(millimolar)FARADAY=(faraday)(coulomb)R=(k-mole)(joule/degC)}ASSIGNED{ica(mA/cm2)inf[2]tau[2](ms)v(mV)celsius(degC)cai(mM)cao(mM)stim_i}PARAMETER{currgcabar=0(mho/cm2)eca=140(mV)eca2=140(mV)sh=0(mV)time1=600time0=100alpha=1alphash1=0.15sh2count=1vrun(mV)delta=0vinit=-76.2vvrun=0timestep=1000vrun2v0dv0ddvflag=0FCa=2PCa=1BCa=2CCa=50stim_moltCa=1}STATE{mh}INITIAL{rates(v,sh2)m=0h=1vrun=0vvrun=vrun}BREAKPOINT{SOLVEstatesMETHODcnexpeca2=eca+vvrun*alphaica=gcabar*m*m*m*h*(v-eca)}DERIVATIVEstates{rates(v,sh2)m'=(inf[0]-m)/tau[0]h'=(inf[1]-h)/tau[1]}BEFORESTEP{LOCALiif(stim_i==0&&flag==0){vrun=0vvrun=0}else{flag=1delta=v-vinitif(count<timestep+1){vrun=(delta-vrun)*(FCa/(count+1))+vrunvrun2=vrun}else{vrun2=(delta)*(FCa/(timestep+1))+vrun2*pow((1-FCa/(timestep+1)),PCa)}vvrun=(BCa*vrun2/(1+vrun2/CCa))count=count+1}sh2=sh+alphash1*vvrun}PROCEDURErates(v(mV),sh2){LOCALa,b,iFROMi=0TO1{tau[i]=vartau(v,i)inf[i]=varss(v-sh2,i)}}FUNCTIONvarss(v(mV),i){if(i==0){varss=1/(1+exp((v+48.5)/(-3(mV))))}elseif(i==1){varss=1/(1+exp((v+53)/(1(mV))))}}FUNCTIONvartau(v(mV),i)(ms){if(i==0){vartau=50(ms)}elseif(i==1){vartau=5(ms)}}