NEURON{POINT_PROCESSWghkampa_preMLUSEIONnaWRITEinaUSEIONkWRITEikUSEIONcaREADcaiUSEIONglutREADglutiWRITEiglut,glutiVALENCE0RANGEtaur,taudRANGEiampa,winit,iglutRANGEP,Pmax,lrRANGEg_factor,I,U_SE_factor,glut_factorRANGEU_SE,U_SE_init,tau_takeover,tau_in}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)(molar)=(1/liter)(mM)=(millimolar)FARADAY=(faraday)(coulomb)R=(k-mole)(joule/degC)}PARAMETER{taur=2(ms)<1e-9,1e9>taud=10(ms)<1e-9,1e9>nai=18(mM)nao=140(mM)ki=140(mM)ko=5(mM)cai(mM)celsius(degC)Pmax=1e-6(cm/s)alpha1=0.35beta1=80alpha2=0.55beta2=80tau_rec=0.8(ms)tau_in=3(ms)U_SE_init=0.1(1)U_SE_factor=0(1)tau_takeover=0.1(ms)glut_factor=40(1)g_factor=1(1)}ASSIGNED{ina(nA)ik(nA)v(mV)P(cm/s)factoriampa(nA)lrArea(cm2)U_SE(1)I(1)iglut(nA)}STATE{A(cm/s)B(cm/s)x(1)y_rel(1)z(1)gluti(mM)}INITIAL{LOCALtpif(taur/taud>.9999){taur=.9999*taud}A=0B=0tp=(taur*taud)/(taud-taur)*log(taud/taur)factor=-exp(-tp/taur)+exp(-tp/taud)factor=1/factorArea=1U_SE=U_SE_initx=1(1)y_rel=0(1)z=0(1)I=0(1)gluti=0(mM)}BREAKPOINT{SOLVEstateMETHODcnexpP=B-Aina=P*ghk(v,nai,nao,1)*Area*g_factorik=P*ghk(v,ki,ko,1)*Area*g_factoriampa=ik+ina}DERIVATIVEstate{lr=eta(cai)A'=-A/taurB'=-B/taudU_SE=U_SE_init*(1+U_SE_factor)x'=z/tau_rec-U_SE*x*Iy_rel'=-y_rel/tau_in+U_SE*x*Iz=1-x-y_relgluti'=-gluti/tau_takeover+y_rel*glut_factor}FUNCTIONghk(v(mV),ci(mM),co(mM),z)(0.001coul/cm3){LOCALarg,eci,ecoarg=(0.001)*z*FARADAY*v/(R*(celsius+273.15))eco=co*efun(arg)eci=ci*efun(-arg)ghk=(0.001)*z*FARADAY*(eci-eco)}FUNCTIONefun(z){if(fabs(z)<1e-4){efun=1-z/2}else{efun=z/(exp(z)-1)}}FUNCTIONeta(ci(mM)){LOCALinv,P1,P2,P3,P4P1=100P2=P1*1e-4P4=1e3P3=3ci=(ci-1e-4)*1e3inv=P4+P1/(P2+ci*ci*ci)eta=1/inv}FUNCTIONOmega(ci(mM)){ci=(ci-1e-4)*1e3Omega=0.25+1/(1+exp(-(ci-alpha2)*beta2))-0.25/(1+exp(-(ci-alpha1)*beta1))}NET_RECEIVE(weight(uS)){if(flag==0){I=10net_send(0.1,2)}if(flag==2){I=0}A=A+Pmax*factor*glutiB=B+Pmax*factor*gluti}