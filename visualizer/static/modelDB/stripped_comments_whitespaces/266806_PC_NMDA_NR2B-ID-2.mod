NEURON{POINT_PROCESSPC_NMDA_NR2BNONSPECIFIC_CURRENTiUSEIONcaREADecaWRITEicaRANGEQ10_diff,Q10_channelRANGEg,ic,icaRANGECdur,Erev,T,TmaxRANGERb,Ru,Rd,Rr,Ro,Rc,rb1,rb2,gmax,RdRateRANGEtau_1,tau_rec,tau_facil,U,u0RANGEPRERANGEUsedRANGEMgBlock,v0_block,k_blockRANGEdiffuse,Trelease,lamd,Diff,M,Rd,nd,syntype,y_scaleRANGEC0,C1,C2,C3,C4,D1,D2,O}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(umho)=(micromho)(mM)=(milli/liter)(uM)=(micro/liter)(pS)=(picosiemens)(nS)=(nanosiemens)PI=(pi)(1)}PARAMETER{syntypegmax=5000(pS)Q10_diff=1.4Q10_channel=2.2U=0.2(1)<0,1>tau_rec=8(ms)<1e-9,1e9>tau_facil=5(ms)<0,1e9>M=21.515Rd=1.03(um)Diff=0.223(um2/ms)tau_1=1(ms)<1e-9,1e9>u0=0(1)<0,1>Tmax=1(mM)Cdur=0.3(ms)C0_C1_on=9.06(/mM/ms)C1_C0_off=0.115(/ms)C1_C2_on=4.53(/mM/ms)C2_C1_off=0.23(/ms)C2_D1_on=1.659(/ms)D1_C2_off=0.245(/ms)C2_D2_on=0.338(/ms)D2_C2_off=0.00274(/ms)C2_C3_on=8.553(/ms)C3_C2_off=0.528(/ms)C2_C4_on=0.145(/ms)C4_C2_off=0.694(/ms)C3_O_on=0.145(/ms)O_C3_off=0.694(/ms)C4_O_on=8.553(/ms)O_C4_off=0.528(/ms)Erev=-3.7(mV)v0_block=-20(mV)k_block=13(mV)nd=1kB=0.44(mM)diffuse=1lamd=20(nm)celsius(degC)}ASSIGNED{v(mV)i(nA)ic(nA)ica(nA)g(pS)eca(mV)rb1(/ms)rb2(/ms)T(mM)xTrelease(mM)tspike[100](ms)PRE[100]Mres(mM)MgBlocknumpulsestzerogbar_Q10(mho/cm2)Q10(1)}STATE{C0C1C2C3C4D1D2O}INITIAL{rates(v)C0=1C1=0C2=0C3=0C4=0D1=0D2=0O=0T=0numpulses=0gbar_Q10=Q10_diff^((celsius-30)/10)Q10=Q10_channel^((celsius-30)/10)Mres=1e3*(1e3*1e15/6.022e23*M)FROMi=1TO100{PRE[i-1]=0tspike[i-1]=0}tspike[0]=1e12(ms)if(tau_1>=tau_rec){printf("Warningtau_rec=tau_1+1e-5}}FUNCTIONimax(a,b){if(a>b){imax=a}else{imax=b}}FUNCTIONdiffusione(){LOCALDifWave,i,cntc,fi,aaaDifWave=0cntc=imax(numpulses-100,0)FROMi=cntcTOnumpulses{fi=fmod(i,100)tzero=tspike[fi]if(t>tzero){aaa=(-Rd*Rd/(4*Diff*(t-tzero)))if(fabs(aaa)<699){DifWave=DifWave+PRE[fi]*Mres*exp(aaa)/((4*PI*Diff*(1e-3)*lamd)*(t-tzero))}else{if(aaa>0){DifWave=DifWave+PRE[fi]*Mres*exp(699)/((4*PI*Diff*(1e-3)*lamd)*(t-tzero))}else{DifWave=DifWave+PRE[fi]*Mres*exp(-699)/((4*PI*Diff*(1e-3)*lamd)*(t-tzero))}}}}diffusione=DifWave}BREAKPOINT{rates(v)SOLVEkstatesMETHODsparseg=gmax*gbar_Q10*Oi=(1e-6)*g*(v-Erev)*MgBlockica=((1e-6)*g*(v-Erev)*MgBlock)/10ic=i+ica}KINETICkstates{Trelease=diffusione()rb1=C0_C1_on*Treleaserb2=C1_C2_on*Trelease~C0<->C1(rb1*Q10,C1_C0_off*Q10)~C1<->C2(rb2*Q10,C2_C1_off*Q10)~C2<->D1(C2_D1_on*Q10,D1_C2_off*Q10)~C2<->D2(C2_D2_on*Q10,D2_C2_off*Q10)~C2<->C3(C2_C3_on*Q10,C3_C2_off*Q10)~C2<->C4(C2_C4_on*Q10,C4_C2_off*Q10)~C3<->O(C3_O_on*Q10,O_C3_off*Q10)~C4<->O(C4_O_on*Q10,O_C4_off*Q10)CONSERVEC0+C1+C2+C3+C4+D1+D2+O=1}PROCEDURErates(v(mV)){TABLEMgBlockDEPENDv0_block,k_blockFROM-120TO30WITH150MgBlock=1/(1+exp(-(v-v0_block)/k_block))}NET_RECEIVE(weight,on,nspike,tzero(ms),y,z,u,tsyn(ms)){LOCALfiINITIAL{y=0z=0u=u0tsyn=tnspike=1}if(flag==0){nspike=nspike+1if(!on){tzero=ton=1z=z*exp(-(t-tsyn)/(tau_rec))z=z+(y*(exp(-(t-tsyn)/tau_1)-exp(-(t-tsyn)/(tau_rec)))/((tau_1/(tau_rec))-1))y=y*exp(-(t-tsyn)/tau_1)x=1-y-zif(tau_facil>0){u=u*exp(-(t-tsyn)/tau_facil)u=u+U*(1-u)}else{u=U}y=y+x*uT=Tmax*yfi=fmod(numpulses,100)PRE[fi]=ytspike[fi]=tnumpulses=numpulses+1tsyn=t}net_send(Cdur,nspike)}if(flag==nspike){tzero=tT=0on=0}}