UNITS{(molar)=(1/liter)}UNITS{(mV)=(millivolt)(mA)=(milliamp)(mM)=(millimolar)}NEURON{SUFFIXmykcaPOINTERstim_iUSEIONcaREADcaiUSEIONkREADekWRITEikRANGEflag,curr,gbar,ik,sh,taua,taub,ggbar,ek2,vrun,count,vvrun,taun2,vrun2,delta,delta2,stim_moltCaGLOBALoinf,tau,alpha}UNITS{FARADAY=(faraday)(kilocoulombs)R=8.313424(joule/degC)}PARAMETER{currv(mV)sh=0(mV)dt(ms)ek(mV)ek2=-80(mV)celsius=20(degC)gbar=0.01(mho/cm2)cai=1e-3(mM)d1=0.92d2=1d11=0.92d22=1k1=0.01(mM)k2=0.000003(mM)bbar=0.48(/ms)abar=0.28(/ms)k1b=0.01(mM)k2b=0.000003(mM)bbar2=0.48(/ms)abar2=0.28(/ms)count=1vrun=0(mV)vvrun=0delta=0vinit=-76.2alpha=1.1alphash1=0.15sh2delta1=0timestep=1000vrun2v0dv0ddvFK=2PK=1BK=2.11CK=48stim_moltK=1flag=0st=1(1)}ASSIGNED{ik(mA/cm2)oinftau(ms)taub(ms)taua(ms)ggbar(mho/cm2)taun2stim_i}INITIAL{vrun=0vvrun=vrunrate(v,cai,sh2)o=oinf}STATE{o}BREAKPOINT{SOLVEstateMETHODcnexpggbar=gbar*o^stek2=ek+vvrun*alphaik=gbar*o^st*(v-ek2)}DERIVATIVEstate{rate(v,cai,sh2)if(o<oinf){tau=taua}else{tau=taub}oinf=oinf*tauo'=(oinf-o)/tau}FUNCTIONalp(v(mV),c(mM))(1/ms){alp=c*abar/(c+exp1(k1,d1,v))}FUNCTIONbet(v(mV),c(mM))(1/ms){bet=bbar/(1+c/exp1(k2,d2,v))}FUNCTIONalp2(v(mV),c(mM))(1/ms){alp2=c*abar2/(c+exp1(k1b,d11,v))}FUNCTIONbet2(v(mV),c(mM))(1/ms){bet2=bbar2/(1+c/exp1(k2b,d22,v))}FUNCTIONexp1(k(mM),d,v(mV))(mM){exp1=k*exp(-2*d*FARADAY*v/R/(273.15+celsius))}BEFORESTEP{LOCALiif(stim_i==0&&flag==0){vrun=0vvrun=0}else{flag=1delta=v-vinitif(count<timestep+1){vrun=(delta-vrun)*(FK/(count+1))+vrunvrun2=vrun}else{vrun2=(delta)*(FK/(timestep+1))+vrun2*pow((1-FK/(timestep+1)),PK)}vvrun=(BK*vrun2/(1+vrun2/CK))count=count+1}sh2=sh+alphash1*vvrun}PROCEDURErate(v(mV),c(mM),sh2){LOCALa,i,emaa=alp(v-sh2,c)taua=1/(a+bet(v-sh2,c))taub=1/(alp2(v-sh2,c)+bet2(v-sh2,c))oinf=a}