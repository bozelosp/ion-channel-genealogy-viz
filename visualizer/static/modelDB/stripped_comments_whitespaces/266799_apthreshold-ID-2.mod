NEURON{POINT_PROCESSAPThresholdRANGEn,slopeth,ampth,time,vth,firing1,firing2}UNITS{(mV)=(millivolt)}PARAMETER{nslopeth=10(mV/ms)ampth=-20(mV)time(ms)vth(mV)v(mV)dt(ms)}ASSIGNED{firing1firing2spacetspacethv1(mV)}VERBATIMexternvoidvector_resize();externdouble*vector_vec();externvoid*vector_arg();ENDVERBATIMINITIAL{n=0firing1=0firing2=0v1=0(mV)VERBATIM{void*vvt;void*vvth;vvt=*((void**)(&spacet));vvth=*((void**)(&spaceth));if(vvt){vector_resize(vvt,0);}if(vvth){vector_resize(vvth,0);}}ENDVERBATIMcheck()}BREAKPOINT{SOLVEcheckMETHODafter_cvode}PROCEDUREcheck(){VERBATIMif((v-v1)/dt>=slopeth&&!firing1){firing1=1;time=t;vth=v;}if(v>=ampth&&firing1&&!firing2){intsize;double*px;void*vvt;void*vvth;firing2=1;n+=1.;vvt=*((void**)(&spacet));vvth=*((void**)(&spaceth));if(vvt){size=(int)n;vector_resize(vvt,size);px=vector_vec(vvt);px[size-1]=time;}if(vvth){size=(int)n;vector_resize(vvth,size);px=vector_vec(vvth);px[size-1]=vth;}}if(firing1&&(v-v1)/dt<slopeth&&t>time){firing1=0;}if(firing2&&v<ampth&&t>time){firing2=0;firing1=0;}v1=v;ENDVERBATIM}PROCEDUREspiketimes(){VERBATIMexternvoid*vector_arg();void**vvt;vvt=(void**)(&spacet);*vvt=(void*)0;if(ifarg(1)){*vvt=vector_arg(1);}ENDVERBATIM}PROCEDUREthresholds(){VERBATIMexternvoid*vector_arg();void**vvth;vvth=(void**)(&spaceth);*vvth=(void*)0;if(ifarg(1)){*vvth=vector_arg(1);}ENDVERBATIM}