UNITS{(mV)=(millivolt)(mA)=(milliamp)(nA)=(nanoamp)(mW)=(milliwatt)(photons)=(1)}NEURON{SUFFIXchanrhodNONSPECIFIC_CURRENTicatRANGEphotons,flux,irradiance,U,U0,U1RANGEchannel_density,gdens1,gdens2RANGEx,y,zGLOBALsource_photons,source_flux,source_irradianceRANGEKa1,Ka2GLOBALKd1,Kd2GLOBALKrRANGEe12,e21,e12dark,e21darkRANGEdelta1,delta2RANGEo10,o20RANGEIslow,IfastRANGEc_1,c_2,bGLOBALh,cRANGEamp,photon_energyRANGEwavelengthRANGEphi0,phio,gcatGLOBALsigma_retinal,gcat1,gcat2,ecat,Imax,gamma,tChRGLOBALepsilon1,epsilon2RANGETx,phiGLOBALtstimon,tstimoff}PARAMETER{channel_density=1.3e10(1/cm2)gcat1=50e-15(mho)gcat2=250e-17(mho)gamma=0.05sigma_retinal=1.2e-16(cm2)epsilon1=0.5(1)epsilon2=0.1ecat=0(mV)Tx=1(1)vshift=0(mV)tChR=1.3(ms)x=0(1)y=0(1)z=0(1)Ka1=0.5Ka2=0.12Kd1=0.13Kd2=0.025Kr=0.0004e12=0.053e21=0.023e12dark=0.022e21dark=0.011delta1=0.03(ms)delta2=0.15(ms)h=6.6260693e-34(m2kg/s)c=299792458.0(m/s)wavelength=4.45e-7}ASSIGNED{v(mV)icat(mA/cm2)gdens1(mho/cm2)gdens2(mho/cm2)source_irradiance(W/cm2)source_photons(photons/ms)source_flux(photons/mscm2)irradiance(W/cm2)flux(photons/mscm2)phi(photons/ms)UU0U1ImaxIslowIfastc_1c_2bampphoton_energyphi0phiogcattstimontstimoff}STATE{o1o2c1c2}INITIAL{irradiance=0flux=0phi=0Islow=0Ifast=0tstimon=0tstimoff=0c1=1c2=0o1=0o2=0phio=0o10=0o20=0}BREAKPOINT{irradiance=source_irradiance*Txflux=source_flux*Txphi=flux*sigma_retinalU=v-ecat-vshift-75U0=40U1=15Imax=(v-ecat-vshift)*gcat1*channel_densityb=(Kd1+Kd2+e12dark+e21dark)/2c_1=0.1029797709c_2=0.0398631371gcat=(o1+gamma*o2)*gcat1*channel_densityif(phi>0){Ka1=epsilon1*phi*(1-exp(-(t-tstimon)/tChR))Ka2=epsilon2*phi*(1-exp(-(t-tstimon)/tChR))e12=0.053e21=0.023icat=Imax*(o1+gamma*o2)*(1-exp(-U/U0))/(U/U1)o10=o1o20=o2phio=phi}else{Ka1=epsilon1*phio*(exp(-((t-tstimoff)/tChR))-exp(-(t-tstimon)/tChR))Ka2=epsilon2*phio*(exp(-((t-tstimoff)/tChR))-exp(-(t-tstimon)/tChR))e12=0.022e21=0.011Islow=Imax*(((delta2-(Kd1+(1-gamma)*e12dark))*o10+((1-gamma)*e21dark+gamma*(delta2-Kd2))*o20)/(delta2-delta1))Ifast=Imax*(((Kd1+(1-gamma)*e12dark-delta1)*o10+(-(1-gamma)*e21dark+gamma*(Kd2-delta1))*o20)/(delta2-delta1))icat=Islow*exp(-delta1*(t-tstimoff))+Ifast*exp(-delta2*(t-tstimoff))}SOLVEstatesMETHODcnexpif(o1>1){o1=1}if(o1<0){o1=0}if(o2>1){o2=1}if(o2<0){o2=0}if(c1>1){c1=1}if(c1<0){c1=0}if(c2>1){c2=1}if(c2<0){c2=0}c1=1-o1-o2-c2}DERIVATIVEstates{o1'=Ka1*c1-(Kd1+e12)*o1+e21*o2o2'=Ka2*c2+e12*o1-(Kd2+e21)*o2c2'=Kd2*o2-(Ka2+Kr)*c2}