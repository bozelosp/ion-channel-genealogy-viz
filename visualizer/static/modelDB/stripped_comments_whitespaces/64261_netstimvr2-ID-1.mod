NEURON{ARTIFICIAL_CELLNetStimVR2RANGEy,interval,noise,thetaRANGEtransform,prmtr,alpha,fthetastimGLOBALtchange,thetastimGLOBALRmax,sigma,Rmin}PARAMETER{noise=1<0,1>theta=0<0,1>tchange=20(ms)thetastim=0<0,1>Rmax=60(/s)Rmin=0(/s)sigma=0.4transform=0prmtr=0alpha=1}ASSIGNED{interval(ms)yevent(ms)rate(/s)fthetastim}CONSTANT{PI=3.141592654}PROCEDUREseed(x){set_seed(x)}INITIAL{y=0if(noise<0){noise=0}if(noise>1){noise=1}net_send(1e-12,4)}FUNCTIONinvl(mean(ms))(ms){if(mean<=0.){mean=.01(ms)}if(noise==0){invl=mean}else{invl=(1.-noise)*mean+noise*mean*exprand(1)}}FUNCTIONtuning_curve(theta,theta0)(ms){LOCALdd=theta-theta0if(d<=-0.5){d=d+1}if(d>0.5){d=d-1}rate=alpha*((Rmax-Rmin)*exp((cos(2*PI*d)-1)/(sigma*sigma))+Rmin)if(rate>1e-9){tuning_curve=(1000)/rate}else{tuning_curve=1e12}}NET_RECEIVE(w){if(flag==4){if(transform==1){fthetastim=prmtr*thetastim}elseif(transform==2){fthetastim=0.5*(sin(2*PI*thetastim+prmtr)+1)}elseif(transform==3){fthetastim=thetastim*thetastim}elseif(transform==4){fthetastim=asin(2*thetastim-1)/PI}elseif(transform==5){fthetastim=0.5*(sin(prmtr*2*PI*thetastim)+1)}else{fthetastim=thetastim}interval=tuning_curve(theta,fthetastim)event=invl(interval)-interval*(1.-noise)if(event<1e-12){event=1e-12}if(event<tchange){net_send(event,1)}net_send(tchange,3)}else{if(flag==3){if(transform==1){fthetastim=prmtr*thetastim}elseif(transform==2){fthetastim=0.5*(sin(2*PI*thetastim+prmtr)+1)}elseif(transform==3){fthetastim=thetastim*thetastim}elseif(transform==4){fthetastim=asin(2*thetastim-1)/(2*PI)}elseif(transform==5){fthetastim=0.5*(sin(prmtr*2*PI*thetastim)+1)}else{fthetastim=thetastim}interval=tuning_curve(theta,fthetastim)event=t+invl(interval)-interval*(1.-noise)if(event<t){event=t}if(event<tchange){net_send(event-t,1)}net_send(tchange-t,3)}else{if(flag==1){y=2net_event(t)event=event+invl(interval)if(event<tchange){net_send(event-t,1)}net_send(0.1,2)}else{if(flag==2){y=0}}}}}