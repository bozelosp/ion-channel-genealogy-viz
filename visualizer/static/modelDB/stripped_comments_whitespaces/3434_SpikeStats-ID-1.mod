NEURON{POINT_PROCESSSpikeStatsRANGEbinsnum,ignoreBefore,stimPeriod,poissDt,sinsum,cossumPOINTERn,vs,phase,pst,sinphs,cosphs}UNITS{PI=(pi)(1)}CONSTANT{radToDeg=57.295779513082322865}PARAMETER{binsnum=80<0,1e9>ignoreBefore=0(ms)<0,1e9>stimPeriod=1(ms)<0,1e9>poissDt=0.0125(ms)<1e-9,1e9>}ASSIGNED{sinsumcossumnvsphasepstsinphscosphs}INITIAL{LOCALphsiVERBATIM#definePST(&pst)#defineSINPHS(&sinphs)#defineCOSPHS(&cosphs)#defineI_INT((int)_li)#definePHSI(_lphsi)ENDVERBATIMsinsum=0cossum=0if(pointersValid()){n=0vs=0phase=-1e-9FROMi=0TObinsnum-1{phsi=2*PI/binsnum*iVERBATIMPST[I_INT]=0.0;SINPHS[I_INT]=sin(PHSI);COSPHS[I_INT]=cos(PHSI);ENDVERBATIM}}}NET_RECEIVE(change){LOCALiVERBATIM#definePST(&pst)#defineSINPHS(&sinphs)#defineCOSPHS(&cosphs)#defineI_INT((int)_li)ENDVERBATIMif(t>ignoreBefore){n=n+1UNITSOFFi=fmod(floor(fmod(t,stimPeriod)/poissDt),binsnum)UNITSONVERBATIM(PST[I_INT])++;sinsum+=SINPHS[I_INT];cossum+=COSPHS[I_INT];ENDVERBATIMvs=sqrt(sinsum*sinsum+cossum*cossum)/nphase=atan2(sinsum,cossum)*radToDegif(phase<0){phase=phase+360}}}FUNCTIONpointersValid(){if((!nrn_pointing(n))||(!nrn_pointing(vs))||(!nrn_pointing(phase))||(!nrn_pointing(pst))||(!nrn_pointing(sinphs))||(!nrn_pointing(cosphs))){printf("SpikeStatsprintf("mustallbesetusingsetpointer!\n")pointersValid=0}else{pointersValid=1}}