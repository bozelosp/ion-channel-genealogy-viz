NEURON{SUFFIXdCaAPRANGEw,vthRANGEK,tauA,tauB,A,B,DRANGEt_dCaAPRANGEsigma_diff,refract_periodRANGEvrestRANGEdcaap_countNONSPECIFIC_CURRENTi}UNITS{(mV)=(millivolt)(nA)=(nanoamp)(uS)=(microsiemens)}PARAMETER{w=0vth(mV)refract_periodtauAtauBDsigma_diffKvrestt_dCaAPdcaap_count}ASSIGNED{v(mV)i(nA)}STATE{AB}INITIAL{A=0B=0K=0t_dCaAP=-refract_perioddcaap_count=0}BREAKPOINT{SOLVEdCaAPMETHODcnexpi=-(A-B)*w*K}DERIVATIVEdCaAP{A'=A*(1-A)/tauAB'=B*(1-B)/tauB}BEFOREBREAKPOINT{if(t>=t_dCaAP+refract_period&&v>vth&&w>0){t_dCaAP=tA=0.001B=0K=exp(-(v-vth)/(vth-vrest)/D)if(K>1){K=1}dcaap_count=dcaap_count+1printf("Fired%.0fdCaAPat%fmswithK=%f\n",dcaap_count,t_dCaAP,K)}if(B==0&&t>=t_dCaAP+sigma_diff&&w>0){B=0.001}}