NEURON{SUFFIXcaLUSEIONcaREADcai,caoWRITEicaRANGEpbar,p,iGLOBALinf_n,tau_n,inf_h,tau_h,inf_c,tau_c}UNITS{(molar)=(1/liter)(mV)=(millivolt)(mA)=(milliamp)(mM)=(millimolar)FARADAY=(faraday)(coulomb)R=(k-mole)(joule/degC)}PARAMETER{pbar=0.241e-3(cm/s)gates_n=2vhalf_n=-30.1(mV)slope_n=-4.77(mV)needAdj=1vhalfA_n=0(mV)slopeA_n=0(mV)v5_adj=0(mV)slp_adj=0(mV)tauA_n=1.5(ms)tauDv_n=0(mV)tauG_n=0.5tauF_n=0tau0_n=0(ms)vhalf_h=-59.5(mV)slope_h=10(mV)tauA_h=200(ms)tauG_h=0.5tau0_h=0(ms)tauF_h=0tauDv_h=0hill_c=2K_c=.001(mM)tauA_c=10(ms)tau0_c=10(ms)}ASSIGNED{celsius(degC)v(mV)i(mA/cm2)ica(mA/cm2)cai(mM)cao(mM)p(cm/s)inf_ntau_n(ms)inf_htau_h(ms)inf_ctau_c(ms)}STATE{nhc}BREAKPOINT{SOLVEstatesMETHODcnexpp=0p=pbar*n^2*h*ci=p*ghk(v,cai,cao)ica=i}INITIAL{rates(v,cai)n=inf_nh=inf_hc=inf_c}DERIVATIVEstates{rates(v,cai)n'=(inf_n-n)/tau_nh'=(inf_h-h)/tau_hc'=(inf_c-c)/tau_c}PROCEDURErates(v(mV),cai(mM)){if(needAdj>0){needAdj=0ngate_adjust(gates_n,vhalf_n,slope_n)vhalfA_n=v5_adjslopeA_n=slp_adj}inf_n=Boltzmann(v,vhalfA_n,slopeA_n)tau_n=BorgMod_tau(v,vhalfA_n,slopeA_n,tau0_n,tauA_n,tauG_n,tauF_n,tauDv_n)inf_h=1/(1+exp((v-vhalf_h)/slope_h))tau_h=tau0_h+tauA_h*4*sqrt(tauG_h*(1-tauG_h))/(exp(-(v-vhalf_h)/slope_h*(1-tauG_h))+exp((v-vhalf_h)/slope_h*tauG_h))inf_c=1/(1+(cai/K_c)^hill_c)tau_c=tau0_c+tauA_c/(1+(cai/K_c)^hill_c)}FUNCTIONBoltzmann(v(mV),v5(mV),s(mV)){Boltzmann=1/(1+exp((v-v5)/s))}FUNCTIONBorgMod_tau(v(mV),v5(mV),s(mV),tau0(ms),tauA(ms),tauG,tauF,tauDv(mV))(ms){LOCALkc,kr,Dv,wr,kfDv=(v-(v5+tauDv))kf=10^tauFBorgMod_tau=tau0+tauA*4*sqrt(tauG*(1-tauG))/(exp(-Dv*(1-tauG)*kf/s)+exp(Dv*tauG*kf/s))}FUNCTIONghk(v(mV),ci(mM),co(mM))(.001coul/cm3){LOCALz,eci,ecoz=(1e-3)*2*FARADAY*v/(R*(celsius+273.15))eco=co*efun(z)eci=ci*efun(-z)ghk=(.001)*2*FARADAY*(eci-eco)}FUNCTIONefun(z){if(fabs(z)<1e-4){efun=1-z/2}else{efun=z/(exp(z)-1)}}FUNCTIONBoltz_m1(x,v5(mV),s(mV))(mV){Boltz_m1=s*log(1/x-1)+v5}PROCEDUREngate_adjust(ng,vh(mV),slp(mV)){LOCALx1,x2,v1,v2x1=0.3x2=0.7v1=Boltz_m1(x1,vh,slp)v2=Boltz_m1(x2,vh,slp)slp_adj=(v2-v1)/(log((1/x2)^(1/ng)-1)-log((1/x1)^(1/ng)-1))v5_adj=v1-slp_adj*log(1/x1^(1/ng)-1)}