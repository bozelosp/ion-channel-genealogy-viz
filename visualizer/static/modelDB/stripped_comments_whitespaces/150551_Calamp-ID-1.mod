NEURON{POINT_PROCESSCalAmpUSEIONcaREADcaiRANGEn,thresh,time,firing,max,high}UNITS{(molar)=(1/liter)(uM)=(micromolar)(mM)=(millimolar)}PARAMETER{nthresh=100e-6(mM)time(ms)}ASSIGNED{firingspacehighmaxcai(mM)}VERBATIM#ifndefNRN_VERSION_GTEQ_8_2_0externvoidvector_resize();externdouble*vector_vec();externvoid*vector_arg();#endifENDVERBATIMINITIAL{n=0firing=0high=0VERBATIM{void*vv;vv=*((void**)(&space));if(vv){vector_resize(vv,0);}}ENDVERBATIMcheck()}BREAKPOINT{SOLVEcheckMETHODafter_cvode}PROCEDUREcheck(){VERBATIMintsize;double*px;void*vv;if(cai>=thresh&&!firing){firing=1;time=t;high=1;max=cai;}if(high){if(cai<=thresh&&t>time){n+=1.;vv=*((void**)(&space));if(vv){size=(int)n;vector_resize(vv,size);px=vector_vec(vv);px[size-1]=max;}high=0;}if(cai>max){max=cai;}}if(firing&&cai<thresh&&t>time){firing=0;}ENDVERBATIM}PROCEDURErecord(){VERBATIMvoid**vv;vv=(void**)(&space);*vv=(void*)0;if(ifarg(1)){*vv=vector_arg(1);}ENDVERBATIM}