NEURON{SUFFIXcldif_CA3_NKCC1_HCO3USEIONclREADiclWRITEcliVALENCE-1USEIONhco3READihco3WRITEhco3iVALENCE-1GLOBALvratRANGEtau,cli0,clo0,hco3i0,hco3o0,egaba,delta_egaba,init_egaba,ehco3_help,ecl_help}DEFINENannuli4UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)(mV)=(millivolt)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)F=(faraday)(coulombs)R=(k-mole)(joule/degC)}PARAMETER{DCl=2(um2/ms)tau_NKCC1=174000(ms)tau_passive=321000(ms)tau_hco3=1000(ms)cli0=50(mM)cli_Start=10(mM)clo0=133.5(mM)hco3i0=16(mM)hco3o0=26(mM)hco3i_Start=16(mM)celsius=31(degC)}ASSIGNED{diam(um)icl(mA/cm2)ihco3(mA/cm2)cli(mM)hco3i(mM)hco3o(mM)vrat[Nannuli]ehco3_help(mV)ecl_help(mV)ActPump}STATE{cl[Nannuli](mM)<1e-10>hco3[Nannuli](mM)<1e-10>}BREAKPOINT{SOLVEstateMETHODsparseecl_help=log(cli/clo0)*(1000)*(celsius+273.15)*R/Fehco3_help=log(hco3i/hco3o0)*(1000)*(celsius+273.15)*R/F}LOCALfactors_doneINITIAL{if(factors_done==0){factors_done=1factors()}cli=cli_Starthco3i=hco3i0hco3o=hco3o0FROMi=0TONannuli-1{cl[i]=cli}FROMi=0TONannuli-1{hco3[i]=hco3i}ehco3_help=log(hco3i/hco3o)*(1000)*(celsius+273.15)*R/Fecl_help=log(cli/clo0)*(1000)*(celsius+273.15)*R/F}LOCALfrat[Nannuli]PROCEDUREfactors(){LOCALr,dr2r=1/2dr2=r/(Nannuli-1)/2vrat[0]=0frat[0]=2*rFROMi=0TONannuli-2{vrat[i]=vrat[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vrat[i+1]=PI*(r+dr2/2)*2*dr2}}KINETICstate{if(cli0>=cl[0]){ActPump=1}else{ActPump=0}COMPARTMENTi,diam*diam*vrat[i]{cl}LONGITUDINAL_DIFFUSIONi,DCl*diam*diam*vrat[i]{cl}~cl[0]<<((icl*PI*diam/FARADAY)+ActPump*(diam*diam*vrat[0]*(cli0-cl[0])/tau_NKCC1)+(diam*diam*vrat[0]*(cli0-cl[0])/tau_passive))FROMi=0TONannuli-2{~cl[i]<->cl[i+1](DCl*frat[i+1],DCl*frat[i+1])}cli=cl[0]COMPARTMENTi,diam*diam*vrat[i]{hco3}LONGITUDINAL_DIFFUSIONi,DCl*diam*diam*vrat[i]{hco3}~hco3[0]<<((ihco3*PI*diam/FARADAY)+(diam*diam*vrat[0]*(hco3i0-hco3[0])/tau_hco3))FROMi=0TONannuli-2{~hco3[i]<->hco3[i+1](DCl*frat[i+1],DCl*frat[i+1])}hco3i=hco3[0]}