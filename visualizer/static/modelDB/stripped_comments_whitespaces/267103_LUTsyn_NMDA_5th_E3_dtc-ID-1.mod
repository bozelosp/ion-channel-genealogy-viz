NEURON{POINT_PROCESSLUTsyn_NMDA_5th_E3_dtcRANGEgain,basis_gain,tau1,tau2,tau3,tau4,t4,t3,t2,t1,t0,MEM,scalar,order,open,gran,indexRANGEg0,g1,g2,alpha,g,e,open_Mg,nbNMDAR,C,B,E,factor,wf,v1RANGEtc1,tc2,tc3,wtc2,wtc3RANGEo1_tc1,o1_tc2,o1_tc3,o2_tc1,o2_tc2,o2_tc3,o3_tc1,o3_tc2,o3_tc3,o4_tc1,o4_tc2,o4_tc3,o5_tc1,o5_tc2,o5_tc3RANGEfactor1,factor2,factor3,factor4,factor5RANGEo1_spks,o2_spks,o3_spks,o4_spks,o5_spksPOINTERgain_arrayNONSPECIFIC_CURRENTi}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)}ASSIGNED{i(nA)gain_arraybasis_gaingaintau1tau2tau3tau4t4t3t2t1t0orderopengranMEMindexgfactorwfv1wtc3o1_spkso2_spkso3_spkso4_spkso5_spks}PARAMETER{scalar=1alpha=0.01g0=0.0g1=40.0(pS)g2=247.0(pS)Mg=1open_Mg=0.0ve=0nbNMDAR=1.235tc1=0.1(ms)tc2=10(ms)tc3=11(ms)wtc2=0.5o1_tc1=1(ms)o1_tc2=1(ms)o1_tc3=1(ms)factor1=1o2_tc1=1(ms)o2_tc2=1(ms)o2_tc3=1(ms)factor2=1o3_tc1=1(ms)o3_tc2=1(ms)o3_tc3=1(ms)factor3=1o4_tc1=1(ms)o4_tc2=1(ms)o4_tc3=1(ms)factor4=1o5_tc1=1(ms)o5_tc2=1(ms)o5_tc3=1(ms)factor5=1}INITIAL{if(tc1/tc2>.9999){tc1=.9999*tc2}if(tc2/tc3>.9999){tc2=.9999*tc3}wtc3=1-wtc2C=0B=0E=0tau1=-1tau2=-1tau3=-1tau4=-1t4=0t3=0t2=0t1=0t0=0MEM=200order=0index=0basis_gain=basis_gain/fabs(scalar)gain=basis_gain}STATE{CBE}BREAKPOINT{SOLVEstateMETHODcnexpopen=wtc2*B+wtc3*E-Cg0=g1+((g2-g1)/(1+exp(alpha*v*0.001(1/mV))))open_Mg=(open)/(1+exp(-62*v*0.001(1/mV))*Mg/3.57)g=g0*open_Mg*0.001i=g*(v-e)*nbNMDARv1=v}DERIVATIVEstate{C'=-C/tc1B'=-B/tc2E'=-E/tc3}NET_RECEIVE(weight(uS)){SOLVEupdate_tausSOLVEfind_gainwf=weight*factor*gainC=C+wfB=B+wfE=E+wf}PROCEDUREupdate_taus(){t4=t3t3=t2t2=t1t1=t0t0=ttau1=floor((t0-t1)/gran+0.5)tau2=floor((t0-t2)/gran+0.5)tau3=floor((t0-t3)/gran+0.5)tau4=floor((t0-t4)/gran+0.5)}PROCEDUREfind_gain(){if((t0!=0)&&(t1!=0)&&(t2!=0)&&(t3!=0)&&(t4!=0)){if(tau1>(MEM-4)){order=1}elseif(tau2>(MEM-3)){order=2}elseif(tau3>(MEM-2)){order=3}elseif(tau4>(MEM-1)){order=4}else{order=5}}elseif(t1==0){order=1}elseif(t2==0){if(tau1>(MEM-4)){order=1}else{order=2}}elseif(t3==0){if(tau1>(MEM-4)){order=1}elseif(tau2>(MEM-3)){order=2}else{order=3}}elseif(t4==0){if(tau1>(MEM-4)){order=1}elseif(tau2>(MEM-3)){order=2}elseif(tau3>(MEM-2)){order=3}else{order=4}}if(order==1){gain=basis_gaintc1=o1_tc1tc2=o1_tc2tc3=o1_tc3factor=factor1o1_spks=o1_spks+1}else{if(order==2){index=convert_index(tau1,MEM-3,MEM-2,MEM-1)tc1=o2_tc1tc2=o2_tc2tc3=o2_tc3factor=factor2o2_spks=o2_spks+1}elseif(order==3){index=convert_index(tau1,tau2,MEM-2,MEM-1)tc1=o3_tc1tc2=o3_tc2tc3=o3_tc3factor=factor3o3_spks=o3_spks+1}elseif(order==4){index=convert_index(tau1,tau2,tau3,MEM-1)tc1=o4_tc1tc2=o4_tc2tc3=o4_tc3factor=factor4o4_spks=o4_spks+1}elseif(order==5){index=convert_index(tau1,tau2,tau3,tau4)tc1=o5_tc1tc2=o5_tc2tc3=o5_tc3factor=factor5o5_spks=o5_spks+1}VERBATIMgain=((double*)_p_gain_array)[(int)index];ENDVERBATIM}}FUNCTIONconvert_index(ind1,ind2,ind3,ind4){UNITSOFFconvert_index=((pow(ind4,4)-6*pow(ind4,3)+11*pow(ind4,2)-6*(ind4))/24+(pow(ind3,3)-3*pow(ind3,2)+2*(ind3))/6+(pow(ind2,2)-(ind2))/2+ind1)UNITSON}