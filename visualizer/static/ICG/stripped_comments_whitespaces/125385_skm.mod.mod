INDEPENDENT{tFROM0TO1WITH1(ms)}UNITS{(mA)=(milliamp)(mV)=(millivolt)(pS)=(picosiemens)(um)=(micron)}NEURON{SUFFIXskmUSEIONkREADekWRITEikRANGEgk,gamma,deterministic,reffRANGEN,etaGLOBALninf,ntau,a,b,P_a,P_bGLOBALRb,RaGLOBALvmin,vmax,q10,temp,tadjGLOBALDONT_VECTORIZE}PARAMETER{v(mV)dt(ms)areagamma=40(pS)eta=0.25(1/um2)tha=-30(mV)qa=9(mV)Ra=0.001(/ms)Rb=0.001(/ms)celsius(degC)temp=23(degC)q10=2.3deterministic=0vmin=-120(mV)vmax=100(mV)DONT_VECTORIZE}ASSIGNED{a(/ms)b(/ms)ik(mA/cm2)gk(pS/um2)ek(mV)ninfntau(ms)tadjNreff(pS/um2)scale_dens(pS/um2)P_aP_b}STATE{nN0N1n0_n1n1_n0}INITIAL{trates(v)n=ninfscale_dens=gamma/areareff=eta*gammaN=floor(eta*area+0.5)N1=floor(n*N+0.5)N0=N-N1n0_n1=0n1_n0=0}BREAKPOINT{SOLVEstatesif(deterministic){if(deterministic-1){gk=n*reff*tadj}else{gk=floor(n*N+0.5)*scale_dens*tadj}}else{gk=strap(N1)*scale_dens*tadj}ik=(1e-4)*gk*(v-ek)}PROCEDUREstates(){VERBATIMexterndoubleBnlDev_RNG();ENDVERBATIMtrates(v)n=n+(1-exp(-dt/ntau))*(ninf-n)P_a=strap(a*dt)P_b=strap(b*dt)ChkProb(P_a)ChkProb(P_b)n0_n1=BnlDev_RNG(P_a,N0)n1_n0=BnlDev_RNG(P_b,N1)N0=strap(N0-n0_n1+n1_n0)N1=N-N0}PROCEDUREtrates(v){TABLEninf,ntau,a,b,tadjDEPENDcelsius,temp,Ra,Rb,tha,qa,q10FROMvminTOvmaxWITH199tadj=q10^((celsius-temp)/10)a=Ra*(v-tha)/(1-exp(-(v-tha)/qa))a=a*tadjb=-Rb*(v-tha)/(1-exp((v-tha)/qa))b=b*tadjntau=1/(a+b)ninf=a/(a+b)}FUNCTIONstrap(x){if(x<0){strap=0VERBATIMfprintf(stderr,"skm.mod:strap:negativestate");ENDVERBATIM}else{strap=x}}PROCEDUREChkProb(p){if(p<0.0||p>1.0){VERBATIMfprintf(stderr,"skm.mod:ChkProb:argumentnotaprobability.\n");ENDVERBATIM}}