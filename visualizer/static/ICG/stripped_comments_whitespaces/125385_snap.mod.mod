INDEPENDENT{tFROM0TO1WITH1(ms)}NEURON{SUFFIXsnapUSEIONnaREADenaWRITEinaGLOBALminf,mtau,am,bmRANGEN,reff,eta,gamma,deterministic,gnaGLOBALP_am,P_bmGLOBALtha,qa,vshiftGLOBALRa,RbGLOBALvmin,vmax,q10,orig_temp,wflag,tadjGLOBALDONT_VECTORIZE}UNITS{(mA)=(milliamp)(mV)=(millivolt)(pS)=(picosiemens)(um)=(micron)}PARAMETER{v(mV)dt(ms)areavshift=-10(mV)tha=-35(mV)qa=9(mV)Ra=0.182(/ms)Rb=0.124(/ms)gamma=20(pS)eta=50(1/um2)celsius(degC)orig_temp=23(degC)q10=2.3deterministic=0vmin=-120(mV)vmax=100(mV)DONT_VECTORIZE}ASSIGNED{ina(mA/cm2)gna(pS/um2)ena(mV)am(/ms)bm(/ms)minfmtau(ms)tadjNreff(pS/um2)scale_dens(pS/um2)P_amP_bmwflag}STATE{mm00m1m2m3m00_m1m1_m2m2_m3m3_m2m2_m1m1_m00}INITIAL{trates(v+vshift)wflag=1m=minfscale_dens=gamma/areareff=gamma*etaN=floor(eta*area+0.5)m1=floor(3*m*(1-m)*(1-m)*N+0.5)m2=floor(3*m*m*(1-m)*N+0.5)m3=floor(m*m*m*N+0.5)m00=N-(m1+m2+m3)m00_m1=0m1_m2=0m2_m3=0m3_m2=0m2_m1=0m1_m00=0}BREAKPOINT{SOLVEstatesif(deterministic){if(deterministic-1){gna=m*m*m*reff*tadj}else{gna=floor(m*m*m*N+0.5)*scale_dens*tadj}}else{gna=strap(m3)*scale_dens*tadj}ina=(1e-4)*gna*(v-ena)}PROCEDUREstates(){VERBATIMexterndoubleBnlDev_RNG();ENDVERBATIMtrates(v+vshift)m=m+(1-exp(-dt/mtau))*(minf-m)P_am=strap(am*dt)P_bm=strap(bm*dt)ChkProb(3.0*P_am)ChkProb(3.0*P_bm)ChkProb(P_bm/(1.0-2.0*P_am))ChkProb(2.0*P_bm/(1.0-P_am))m00_m1=BnlDev_RNG(3.0*P_am,m00)m1_m2=BnlDev_RNG(2.0*P_am,m1)m1_m00=BnlDev_RNG(P_bm/(1.0-2.0*P_am),m1-m1_m2)m2_m3=BnlDev_RNG(P_am,m2)m2_m1=BnlDev_RNG(2.0*P_bm/(1.0-P_am),m2-m2_m3)m3_m2=BnlDev_RNG(3.0*P_bm,m3)m00=m00-m00_m1+m1_m00m1=m1-m1_m2-m1_m00+m2_m1+m00_m1m2=m2-m2_m3-m2_m1+m3_m2+m1_m2m3=m3-m3_m2+m2_m3}PROCEDUREtrates(vm){TABLEminf,mtau,am,bm,tadjDEPENDdt,Ra,Rb,tha,qa,q10,orig_temp,celsiusFROMvminTOvmaxWITH199tadj=q10^((celsius-orig_temp)/10)am=SigmoidRate(vm,tha,Ra,qa)am=am*tadjbm=SigmoidRate(-vm,-tha,Rb,qa)bm=bm*tadjmtau=1/(am+bm)minf=am*mtau}FUNCTIONSigmoidRate(v,th,a,q){if(fabs(v-th)>1e-6){SigmoidRate=a*(v-th)/(1-exp(-(v-th)/q))}else{SigmoidRate=a*q}}FUNCTIONstrap(x){if(x<0){strap=0if(wflag){VERBATIMfprintf(stderr,"snap.mod:strap:negativevalueforstate");ENDVERBATIMwflag=0}}else{strap=x}}PROCEDUREChkProb(p){if(p<0.0||p>1.0){if(wflag){VERBATIMfprintf(stderr,"snap.mod:ChkProb:argumentnotaprobability.\n");ENDVERBATIMwflag=0}}}