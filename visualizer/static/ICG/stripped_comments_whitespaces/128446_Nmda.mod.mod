NEURON{POINT_PROCESSNmdaNONSPECIFIC_CURRENTiRANGERb,Ru,Rd,Rr,Ro,Rc,rbRANGEg,gmax,ErevRANGEMgBlock,v0_block,k_blockRANGETreleaseRANGEtau_1,tau_rec,tau_facil,URANGER,M,Diff}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(pS)=(picosiemens)(umho)=(micromho)(mM)=(milli/liter)(uM)=(micro/liter)PI=(pi)(1)}PARAMETER{gmax=1.88e4(pS)Erev=0(mV)v0_block=-20(mV)k_block=13(mV)Rb=5(/ms/mM)Ru=0.1(/ms)Rd=12e-4(/ms)Rr=9e-3(/ms)Ro=3e-2(/ms)Rc=0.966(/ms)tau_1=3(ms)<1e-9,1e9>tau_rec=35.1(ms)<1e-9,1e9>tau_facil=10.8(ms)<0,1e9>U=0.416(1)<0,1>u0=0(1)<0,1>M=21500R=1.033(um)Diff=0.223(um2/ms)lamd=20(nm)}ASSIGNED{v(mV)i(nA)g(pS)rb(/ms)MgBlockTrelease(mM)tspike[50](ms)xtsyn(ms)PRE[50]Mres(mM)NTdiffusion(mM)numpulses}STATE{C0C1C2DO}INITIAL{rates(v)C0=1C1=0C2=0O=0D=0Trelease=0(mM)tspike[0]=1e12(ms)Mres=(1e3*1e15/6.022e23*M)numpulses=0}FUNCTIONNTdiffWave(){LOCALijk,t0NTdiffusion=0FROMijk=1TOnumpulses{t0=tspike[ijk-1]if(t>t0){NTdiffusion=NTdiffusion+PRE[ijk-1]*Mres*exp(-R*R/(4*Diff*(t-t0)))/(4*PI*Diff*((1e-3)*lamd)*(t-t0))}}NTdiffWave=NTdiffusion}BREAKPOINT{Trelease=NTdiffWave()SOLVEkstatesMETHODsparseg=gmax*Oi=(1e-6)*g*(v-Erev)*MgBlock}KINETICkstates{rb=Rb*Trelease~C0<->C1(rb,Ru)~C1<->C2(rb,Ru)~C2<->D(Rd,Rr)~C2<->O(Ro,Rc)CONSERVEC0+C1+C2+D+O=1}PROCEDURErates(v(mV)){TABLEMgBlockDEPENDv0_block,k_blockFROM-120TO30WITH150MgBlock=1/(1+exp(-(v-v0_block)/k_block))}NET_RECEIVE(weight,on,nspike,t0(ms),y,z,u,tsyn(ms)){INITIAL{y=0z=0u=u0tsyn=tnspike=1}if(flag==0){nspike=nspike+1if(!on){t0=ton=1z=z*exp(-(t-tsyn)/tau_rec)z=z+(y*(exp(-(t-tsyn)/tau_1)-exp(-(t-tsyn)/tau_rec))/((tau_1/tau_rec)-1))y=y*exp(-(t-tsyn)/tau_1)x=1-y-zif(tau_facil>0){u=u*exp(-(t-tsyn)/tau_facil)u=u+U*(1-u)}else{u=U}y=y+x*uPRE[numpulses]=ytspike[numpulses]=tnumpulses=numpulses+1tsyn=t}on=0}}