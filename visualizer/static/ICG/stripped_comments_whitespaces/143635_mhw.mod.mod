NEURON{SUFFIXmhwGLOBALmode,slope_threshRANGEVthresh,Peak,tmax,Amp,dvdtRANGEHalfheight,t0,t1,WidthRANGERisetime,Falltime,t_rt_0,t_rt_1,t_ft_0,t_ft_1,thresh10,thresh90}UNITS{(mA)=(milliamp)(mV)=(millivolt)(mM)=(milli/liter)}PARAMETER{mode=0(1)slope_thresh=20(1)}ASSIGNED{v(mV)Vthresh(mV)VthreshSet(1)Peak(mV)tmax(ms)Halfheight(mV)t0(ms)t1(ms)Amp(mV)Width(ms)findwhich(1)Risetime(ms)Falltime(ms)thresh10(mV)thresh90(mV)t_rt_0(ms)t_rt_1(ms)t_ft_0(ms)t_ft_1(ms)rise10set(1)rise90set(1)fall90set(1)fall10set(1)v2(mV)v3(mV)t2(mV)t3(mV)dvdt(mV/ms)}INITIAL{if(mode==1){Vthresh=-100(mV)Peak=vtmax=-1(ms)Halfheight=vt0=-1(ms)t1=-1(ms)Width=-1(ms)Risetime=-1(ms)Falltime=-1(ms)thresh10=vthresh90=vt_rt_0=-1(ms)t_rt_1=-1(ms)t_ft_0=-1(ms)t_ft_1=-1(ms)v2=0(mV)v3=0(mV)t2=0(ms)t3=0(ms)dvdt=0(mV/ms)VthreshSet=0(1)}elseif(mode==2){Amp=Peak-VthreshHalfheight=Vthresh+0.5*Ampfindwhich=0thresh10=Vthresh+0.1*Ampthresh90=Vthresh+0.9*Amp}elseif(mode==0){Vthresh=vPeak=vtmax=-1(ms)t0=-1(ms)t1=-1(ms)Width=-1(ms)Risetime=-1(ms)Falltime=-1(ms)t_rt_0=-1(ms)t_rt_1=-1(ms)t_ft_0=-1(ms)t_ft_1=-1(ms)findwhich=0}rise10set=0(1)rise90set=0(1)fall90set=0(1)fall10set=0(1)}PROCEDUREfindmax(){if(v>Peak){Peak=vtmax=t}if(!VthreshSet&&t>2){if(dvdt>=slope_thresh){Vthresh=vVthreshSet=1}}}PROCEDUREfindx(){if(findwhich==0){if(v>Halfheight){t0=tfindwhich=1}}elseif(findwhich==1){if(v<Halfheight){t1=tWidth=t1-t0findwhich=2}}if(rise90set){if(!fall90set){if(v<thresh90){t_ft_0=tfall90set=1}}if(!fall10set){if(v<thresh10){t_ft_1=tfall10set=1Falltime=t_ft_1-t_ft_0}}}if(!rise10set){if(v>thresh10){t_rt_0=trise10set=1}}if(!rise90set){if(v>thresh90){t_rt_1=trise90set=1Risetime=t_rt_1-t_rt_0}}}BREAKPOINT{SOLVEcheckMETHODafter_cvode}PROCEDUREcheck(){v2=v3v3=vt2=t3t3=tif(t3-t2>0){dvdt=(v3-v2)/(t3-t2)}}AFTERSOLVE{if(mode==1){findmax()}elseif(mode==2){findx()}elseif(mode==0){findmax()findx()}}