NEURON{SUFFIXkaUSEIONkREADekWRITEikRANGEgk,gkbar,gcomp,glearn,iRANGETau,Te,Tp,eps,float,r,KRANGEz,e,p,thresh,delay}UNITS{(S)=(siemens)(uS)=(microsiemens)(mV)=(millivolt)(mA)=(milliamp)}PARAMETER{Tau=20.0(ms)<1e-9,1e9>Te=200.0(ms)<1e-9,1e9>Tp=1000.0(ms)<1e-9,1e9>eps=1e-6r=0.8gkbar=54.8(uS/cm2)thresh=-20(mV)delay=7glearn=0K=1<1e-9,1e9>}ASSIGNED{v(mV)ek(mV)ik(mA)i(mA)gk(S/cm2)gcompfiringuptimecounterready}STATE{zep}BREAKPOINT{SOLVEstatesMETHODcnexpgcomp=g_comp(p)if(K<eps){gk=gkbar*glearn}else{gk=gkbar*gcomp}i=1e-6*gk*(v-ek)ik=i}DERIVATIVEstates{detect(v)if(firing==1){z=z+r*(1-z)}z'=-z/Taue'=(z-e)/Tep'=(e-p)/Tp}INITIAL{z=0.01e=0.01p=0.01up=0firing=0time=0counter=0ready=0}FUNCTIONg_comp(p){if(p<eps){gcomp=1}else{g_comp=log(p)/log(eps)}}PROCEDUREdetect(v(mV)){if(v>thresh&&up==0){counter=delayup=1ready=1}if(ready==1&&counter>0){counter=counter-1}if(ready==1&&counter<=0){firing=1ready=0time=t}if(t>time){firing=0}if(v<thresh){up=0}}