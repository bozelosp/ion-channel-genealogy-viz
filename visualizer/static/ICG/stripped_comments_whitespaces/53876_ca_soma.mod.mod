NEURON{SUFFIXca_somaUSEIONcaREADcai,icaWRITEcaiNONSPECIFIC_CURRENTifakeGLOBALvratGLOBALfactorRANGEK2f_ex,K2f_ATPase,BRANGEi_Na_Ca_ex,i_ATPase,I}DEFINENthin5DEFINENthick21DEFINENshells25UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)(mV)=(millivolt)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)}PARAMETER{DCa=0.6(um2/ms)k1buf=30(/mMms)k2buf=0.03(/ms)B=0.025(mM)K2f_ex=6.3680304e-08(mA/cm2mM4)cao=2(mM)E_1=0.01315(/mV)E_2=0.0255(/mV)nai=7.6(mM)nao=152(mM)K2f_ATPase=0.00051137214(mA/cm2)f_ATPase=100(/mMms)b_ATPase=0.005(/ms)factor=1(1)mM2M=1e-3(1)}ASSIGNED{v(mV)diam(um)ica(mA/cm2)I(mA/cm2)i_Na_Ca_ex(mA/cm2)i_ATPase(mA/cm2)cai(mM)vrat[Nshells](um3)Kd(/mM)B0(mM)ifake(mA/cm2)}STATE{ca[Nshells](mM)<1e-6>CaBuffer[Nshells](mM)<1e-6>Buffer[Nshells](mM)<1e-6>n(1)}BREAKPOINT{SOLVEstatesMETHODcnexpSOLVEstateMETHODsparsei_Na_Ca_ex=-K2f_ex*(nai^3*cao*exp(E_1*v)-nao^3*cai*exp(-E_2*v))i_ATPase=K2f_ATPase*nI=icaifake=0}DERIVATIVEstates{n'=f_ATPase*cai*(1-n)-b_ATPase*n}INITIAL{factors()n=f_ATPase*cai/(f_ATPase*cai+b_ATPase)Kd=k1buf/k2bufB0=B/(1+Kd*cai)FROMi=0TONshells-1{cai=5e-5ca[i]=caiBuffer[i]=B0CaBuffer[i]=B-B0}}LOCALfrat[Nshells]LOCALradii[Nthick]LOCALdrthick[Nthick]LOCALdrthick2[Nthick]LOCALi_PROCEDUREfactors(){LOCALr,drthin,drthin2r=diam/2radii[0]=rFROMi=1TONthick-1{radii[i]=(radii[i-1]^3-(1/21)*r^3)^(1/3)drthick[i-1]=radii[i-1]-radii[i]drthick2[i-1]=drthick[i-1]/2}drthin=2*(drthick[0])/(2*Nthin-1)drthin2=drthin/2vrat[0]=0frat[0]=2*rFROMi=0TONthin-2{vrat[i]=vrat[i]+(4*PI/3)*(3*r^2*drthin2-3*r*drthin2^2+drthin2^3)r=r-drthin2frat[i+1]=4*PI*r*r/drthinr=r-drthin2vrat[i+1]=(4*PI/3)*(3*r^2*drthin2+3*r*drthin2^2+drthin2^3)}FROMi=Nthin-1TONshells-2{i_=1if(i==Nthin-1){vrat[i]=vrat[i]+(4*PI/3)*(3*r^2*drthin2-3*r*drthin2^2+drthin2^3)r=r-drthin2frat[i+1]=4*PI*r*r/(drthin2+drthick2[i_])r=r-drthick2[i_]vrat[i+1]=(4*PI/3)*(3*r^2*drthick2[i_]+3*r*drthick2[i_]^2+drthick2[i_]^3)}else{vrat[i]=vrat[i]+(4*PI/3)*(3*r^2*drthick2[i_]-3*r*drthick2[i_]^2+drthick2[i_]^3)r=r-drthick2[i_]frat[i+1]=4*PI*r*r/drthick[i_]r=r-drthick2[i_]vrat[i+1]=(4*PI/3)*(3*r^2*drthick2[i_]+3*r*drthick2[i_]^2+drthick2[i_]^3)}i_=i_+1}}KINETICstate{COMPARTMENTi,vrat[i]{caCaBufferBuffer}~ca[0]<<((-ica-i_Na_Ca_ex-i_ATPase)*PI*diam*diam/(2*FARADAY))FROMi=0TONshells-2{~ca[i]<->ca[i+1](DCa*frat[i+1],DCa*frat[i+1])}FROMi=0TONshells-1{~ca[i]+Buffer[i]<->CaBuffer[i](k1buf*vrat[i],k2buf*vrat[i])}cai=ca[0]}