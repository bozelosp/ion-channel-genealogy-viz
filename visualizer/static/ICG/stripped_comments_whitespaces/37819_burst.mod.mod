NEURON{ARTIFICIAL_CELLBURSTRANGEinterval,number,numbersavRANGEtaum,refrac,m,refractoryRANGEtaua,adap,addad,fflagGLOBALdebug}PARAMETER{interval=10(ms)<1e-9,1e9>number=10<0,1e9>taum=10(ms)taua=100(ms)addad=0.2refrac=200(ms)debug=0fflag=1}ASSIGNED{event(ms)onend(ms)madapnumbersavt0m(ms)t0a(ms)refractory}INITIAL{on=0m=0adap=1refractory=0t0a=0index=0recval()}NET_RECEIVE(w){if(flag==0){m=m*(1-(t-t0m)/taum)t0m=tif(m>0){m=m+w}else{m=w}if(t0a>0){adap=adap*(1-(t-t0a)/taua)}t0a=tif(m>1&&refractory==0){refractory=1on=1event=tnumbersav=numberif(adap>1){number=number/adap}end=t+1e-6+interval*(number-1)net_send(0,1)}}if(flag==1&&on==1){VERBATIMif(debug==1){printf("a:%g,%g,%g\n",t,adap,t0a);}ENDVERBATIMif(t0a>0){adap=adap*(1-(t-t0a)/taua)}t0a=tif(adap+addad>=1){adap=adap+addad}else{adap=1.0}net_event(t)event=event+interval*adapnet_send(event-t,1)if(event>end){net_send(refrac,2)number=numbersavon=0m=0}}if(flag==2){refractory=0}recval()}INCLUDE"ppsav.inc"INCLUDE"pointer.inc"