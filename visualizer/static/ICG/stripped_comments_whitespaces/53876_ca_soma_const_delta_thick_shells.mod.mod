NEURON{SUFFIXca_soma_const_drthickUSEIONcaREADcai,icaWRITEcaiGLOBALvratGLOBALfactorRANGEK2f_ex,K2f_ATPase,BRANGEi_Na_Ca_ex,i_ATPase,I}DEFINENthin5DEFINENthick21DEFINENshells25UNITS{(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)(mV)=(millivolt)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)}PARAMETER{DCa=0.6(um2/ms)k1buf=30(/mMms)k2buf=0.03(/ms)B=0.025(mM)K2f_ex=0cao=2(mM)E_1=0.01315(/mV)E_2=0.0255(/mV)nai=7.6(mM)nao=152(mM)K2f_ATPase=0f_ATPase=100(/mMms)b_ATPase=0.005(/ms)factor=1(1)}ASSIGNED{v(mV)diam(um)ica(mA/cm2)I(mA/cm2)i_Na_Ca_ex(mA/cm2)i_ATPase(mA/cm2)cai(mM)vrat[Nshells](um3)Kd(/mM)B0(mM)}STATE{ca[Nshells](mM)<1e10>CaBuffer[Nshells](mM)Buffer[Nshells](mM)n(1)}BREAKPOINT{SOLVEstatesMETHODcnexpi_Na_Ca_ex=-K2f_ex*(nai^3*cao*exp(E_1*v)-nao^3*cai*exp(-E_2*v))i_ATPase=K2f_ATPase*nI=icaSOLVEstateMETHODsparse}DERIVATIVEstates{n'=f_ATPase*cai*(1-n)-b_ATPase*n}INITIAL{factors()n=f_ATPase*cai/(f_ATPase*cai+b_ATPase)Kd=k1buf/k2bufB0=B/(1+Kd*cai)FROMi=0TONshells-1{cai=1e-5ca[i]=caiBuffer[i]=B0CaBuffer[i]=B-B0}}LOCALfrat[Nshells]PROCEDUREfactors(){LOCALr,drthin,drthin2,drthick,drthick2r=diam/2drthick=r/Nthickdrthick2=drthick/2drthin=2*drthick/(2*Nthin-1)drthin2=drthin/2vrat[0]=0frat[0]=2*rFROMi=0TONthin-2{vrat[i]=vrat[i]+(4*PI/3)*(3*r^2*drthin2-3*r*drthin2^2+drthin2^3)r=r-drthin2frat[i+1]=4*PI*r*r/drthinr=r-drthin2vrat[i+1]=(4*PI/3)*(3*r^2*drthin2+3*r*drthin2^2+drthin2^3)}FROMi=Nthin-1TONshells-2{if(i==Nthin-1){vrat[i]=vrat[i]+(4*PI/3)*(3*r^2*drthin2-3*r*drthin2^2+drthin2^3)r=r-drthin2frat[i+1]=4*PI*r*r/(drthin2+drthick2)r=r-drthick2vrat[i+1]=(4*PI/3)*(3*r^2*drthick2+3*r*drthick2^2+drthick2^3)}else{vrat[i]=vrat[i]+(4*PI/3)*(3*r^2*drthick2-3*r*drthick2^2+drthick2^3)r=r-drthick2frat[i+1]=4*PI*r*r/drthickr=r-drthick2vrat[i+1]=(4*PI/3)*(3*r^2*drthick2+3*r*drthick2^2+drthick2^3)}}}KINETICstate{COMPARTMENTi,vrat[i]{caCaBufferBuffer}~ca[0]<<((-ica-i_Na_Ca_ex-i_ATPase)*PI*diam*diam/(2*FARADAY))FROMi=0TONshells-2{~ca[i]<->ca[i+1](DCa*frat[i+1],DCa*frat[i+1])}FROMi=0TONshells-1{~ca[i]+Buffer[i]<->CaBuffer[i](k1buf*vrat[i],k2buf*vrat[i])}cai=ca[0]}