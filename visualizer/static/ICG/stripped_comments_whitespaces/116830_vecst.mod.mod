NEURON{SUFFIXnothingGLOBALBVBASE,RES,VECST_INSTALLED}PARAMETER{BVBASE=-1.VECST_INSTALLED=0ERR=-1.3479e121ALL=-1.3479e120NEG=-1.3478e120POS=-1.3477e120CHK=-1.3476e120NOZ=-1.3475e120GTH=-1.3474e120GTE=-1.3473e120LTH=-1.3472e120LTE=-1.3471e120EQU=-1.3470e120EQV=-1.3469e120EQW=-1.3468e120NEQ=-1.3467e120SEQ=-1.3466e120RXP=-1.3465e120IBE=-1.3464e120EBI=-1.3463e120IBI=-1.3462e120EBE=-1.3461e120}ASSIGNED{RES}VERBATIM#include<stdlib.h>#include<math.h>#include<limits.h>#include<sys/time.h>externdouble*hoc_pgetarg();externdoublehoc_call_func(Symbol*,intnarg);externFILE*hoc_obj_file_arg(intnarg);externObject**hoc_objgetarg();externvoidvector_resize();externintvector_instance_px();externvoid*vector_arg();externdouble*vector_vec();externdoublehoc_epsilon;externdoublechkarg();externvoidset_seed();externintivoc_list_count(Object*);externObject*ivoc_list_item(Object*,int);externinthoc_is_double_arg(intnarg);intlist_vector_px();intlist_vector_px2();intlist_vector_resize();staticdoublesc[6];typedefstructBVEC{intsize;intbufsize;short*x;Object*o;}bvec;#defineBYTEHEADERint_II__;char*_IN__;char_OUT__[16];intBYTESWAP_FLAG=0;#defineBYTESWAP(_X__,_TYPE__)\if(BYTESWAP_FLAG==1){\_IN__=(char*)&(_X__);\for(_II__=0;_II__<sizeof(_TYPE__);_II__++){\_OUT__[_II__]=_IN__[sizeof(_TYPE__)-_II__-1];}\(_X__)=*((_TYPE__*)&_OUT__);\}#defineUNCODE(_X_,_J_,_Y_){(_Y_)=floor((_X_)/sc[(_J_)])/sc[4];\(_Y_)=floor(sc[4]*((_Y_)-floor(_Y_))+0.5);}ENDVERBATIMVERBATIMstaticdoubleident(void*vv){intnx,bsz;double*x;nx=vector_instance_px(vv,&x);bsz=vector_buffer_size(vv);printf("Obj*%xDbl*%xSize:%dBufsize:%d\n",vv,x,nx,bsz);}ENDVERBATIMVERBATIMstaticdoubleindset(void*vv){inti,nx,ny,nz,flag;double*x,*y,*z,val,val2;nx=vector_instance_px(vv,&x);ny=vector_arg_px(1,&y);if(hoc_is_object_arg(2)){flag=1;nz=vector_arg_px(2,&z);if(ny!=nz){hoc_execerror("v.indset:Vectorsizesdon'tmatch.",0);}}else{flag=0;val=*getarg(2);}if(ifarg(3)){val2=*getarg(3);for(i=0;i<nx;i++){x[i]=val2;}}for(i=0;i<ny;i++){if(y[i]>nx){hoc_execerror("v.indset:Indexexceedsvectorsize",0);}if(flag)x[(int)y[i]]=z[i];elsex[(int)y[i]]=val;}returni;}ENDVERBATIMVERBATIMstaticintscrsz=0;staticunsignedint*scr;staticdoubledcr[100];ENDVERBATIMVERBATIMstaticdoublefewind(void*vv){inti,j,nx,ni,nv[10],num;Object*ob;double*x,*ind,*vvo[10];nx=vector_instance_px(vv,&x);ni=vector_arg_px(1,&ind);ob=*hoc_objgetarg(2);num=ivoc_list_count(ob);if(num>10)hoc_execerror("ERR:fewindcanonlyhandle10vectors",0);for(i=0;i<num;i++){nv[i]=list_vector_px(ob,i,&vvo[i]);if(nx!=nv[i]){printf("fewindERR%d%d%d\n",i,nx,nv[i]);hoc_execerror("Vectorsmustallbesamesize:",0);}}if(ni>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=ni+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}for(i=0;i<ni;i++){scr[i]=(int)ind[i];if(scr[i]>=nx||scr[i]<0){printf("fewindERR1%d%d\n",scr[i],nx);hoc_execerror("Indexvectorout-of-bounds",0);}}for(j=0;j<num;j++){for(i=0;i<ni;i++)x[i]=vvo[j][scr[i]];for(i=0;i<ni;i++)vvo[j][i]=x[i];list_vector_resize(ob,j,ni);}returnni;}ENDVERBATIMVERBATIMstaticdoublefindx(void*vv){inti,j,ni,nx,av[11],bv[11],num;Object*ob1,*ob2;double*ind,*avo[11],*bvo[11];ni=vector_instance_px(vv,&ind);ob1=*hoc_objgetarg(1);ob2=*hoc_objgetarg(2);num=ivoc_list_count(ob1);i=ivoc_list_count(ob2);if(i!=num)hoc_execerror("findx****ERRA****:listshavedifferentcounts",0);if(num>11)hoc_execerror("findx****ERRB****:canonlyhandle11vectors",0);for(i=0;i<num;i++){av[i]=list_vector_px(ob1,i,&avo[i]);if(av[0]!=av[i]){printf("findx****ERRC****%d%d%d\n",i,av[0],av[i]);hoc_execerror("Srcvectorsmustallbesamesize:",0);}}nx=av[0];for(i=0;i<num;i++){bv[i]=list_vector_px2(ob2,i,&bvo[i],&vv);if(vector_buffer_size(vv)<ni){printf("findx****ERRD****arg#%dneed:%dsz:%d\n",num+i+1,ni,vector_buffer_size(vv));hoc_execerror("Destinationvectorwithinsufficientsize:",0);}else{vector_resize(vv,ni);}}if(ni>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=ni+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}for(i=0;i<ni;i++){scr[i]=(int)ind[i];if(scr[i]>=nx||scr[i]<0){printf("findx****ERRE********IND:%dSZ:%d\n",scr[i],nx);hoc_execerror("Indexvectorout-of-bounds",0);}}for(j=0,i=0;j<num;j++)for(i=0;i<ni;i++)bvo[j][i]=avo[j][scr[i]];returnni;}ENDVERBATIMVERBATIMstaticdoublesindx(void*vv){inti,j,ni,nx,av[11],bv[11],num;Object*ob1,*ob2;double*ind,*avo[11],*bvo[11];ni=vector_instance_px(vv,&ind);ob1=*hoc_objgetarg(1);ob2=*hoc_objgetarg(2);num=ivoc_list_count(ob1);i=ivoc_list_count(ob2);if(num!=i)hoc_execerror("sindx****ERRA****:twoveclistshavedifferentcounts",0);if(num>11)hoc_execerror("sindx****ERRB****:canonlyhandle11vectors",0);for(i=0;i<num;i++){av[i]=list_vector_px(ob1,i,&avo[i]);if(av[0]!=av[i]){printf("sindx****ERRC****%d%d%d\n",i,av[0],av[i]);hoc_execerror("Dest.vectorsmustallbesamesize:",0);}}nx=av[0];for(i=0;i<num;i++){bv[i]=list_vector_px(ob2,i,&bvo[i]);if(bv[i]!=ni){printf("sindx****ERRD****arg#%ddoesnotematchindlength%dvs%d\n",num+i+1,ni,bv[i]);hoc_execerror("Sourcevectorwithinsufficientsize:",0);}}if(ni>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=ni+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}for(i=0;i<ni;i++){scr[i]=(int)ind[i];if(scr[i]>=nx||scr[i]<0){printf("sindx****ERRE****IND:%dSZ:%d\n",scr[i],nx);hoc_execerror("Indexvectorout-of-bounds",0);}}for(j=0,i=0;j<num;j++)for(i=0;i<ni;i++)avo[j][scr[i]]=bvo[j][i];returnni;}ENDVERBATIMVERBATIMstaticdoublesindv(void*vv){inti,j,ni,nx,av[11],bv,num;Object*ob;double*ind,*avo[11],*bvo;ni=vector_instance_px(vv,&ind);ob=*hoc_objgetarg(1);bv=vector_arg_px(2,&bvo);num=ivoc_list_count(ob);if(num>11)hoc_execerror("sindv****ERRA****:canonlyhandle11vectors",0);for(i=0;i<num;i++){av[i]=list_vector_px(ob,i,&avo[i]);if(av[0]!=av[i]){printf("sindv****ERRC****%d%d%d\n",i,av[0],av[i]);hoc_execerror("Dest.vectorsmustallbesamesize:",0);}}nx=av[0];if(bv!=num){printf("sindv****ERRD****Vectorargdoesnotematchlistcount%dvs%d\n",num,bv);hoc_execerror("Sourcevectoriswrongsize:",0);}if(ni>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=ni+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}for(i=0;i<ni;i++){scr[i]=(int)ind[i];if(scr[i]>=nx||scr[i]<0){printf("sindv****ERRE****IND:%dSZ:%d\n",scr[i],nx);hoc_execerror("Indexvectorout-of-bounds",0);}}for(j=0,i=0;j<num;j++)for(i=0;i<ni;i++)avo[j][scr[i]]=bvo[j];returnni;}ENDVERBATIMVERBATIMstaticdoubleslct(void*vv){inti,j,k,m,n,p,ni,nk,na,nv[10],num,fl,lc,field[10];Object*lob;double*ind,*key,*arg,*vvo[10],val;ni=vector_instance_px(vv,&ind);nk=vector_arg_px(1,&key);na=vector_arg_px(2,&arg);lob=*hoc_objgetarg(3);num=ivoc_list_count(lob);if(num>10)hoc_execerror("ERR:vecst::slctcanonlyhandle10vectors",0);for(i=0,j=0,k=0;i<num;i++,j++){nv[i]=list_vector_px(lob,i,&vvo[i]);if(ni!=nv[i]&&(key[j]!=EQW||k!=1)){printf("vecst::slctERR%d%d%d%d%d\n",i,j,k,ni,nv[i]);hoc_execerror("indexandsearchedvectorsmustallbesamesize:",0);}if(key[j]==EQW||key[j]==EQV)if(k==0){j--;k++;}elsek=0;}for(j=0;j<num;j++){field[j]=-1;if(key[j]<=EBE&&key[j]>=ALL){field[j]=0;}elsefor(m=1;m<=5;m++){if(key[j]<=EBE*(m+1)&&key[j]>=ALL*(m+1)){key[j]/=(m+1);field[j]=m;}}if(field[j]==-1){printf("vecst::slctERRF%g\n",key[j]);hoc_execerror("",0);}}if(2*nk!=na){printf("vecst::slctERR3%d%d\n",nk,na);hoc_execerror("Argvectormustbedoublekeylength",0);}for(i=0,n=0;i<nk;i++)if(key[i]==EQV||key[i]==EQW)n++;if(nk+n!=num){printf("vecst::slctERR2%d(keys)+%d(EQV/W)!=%d(vecs)\n",nk,n,num);hoc_execerror("Keylengthmustbenumberofvecs+numofEQV/W",0);}for(j=0,k=0,m=0;j<ni;j++){for(i=0,m=0,n=0,fl=1;i<num;i++,n++,m+=2){if(field[n]==0)val=vvo[i][j];elseUNCODE(vvo[i][j],field[n],val);if(key[n]==ALL)continue;if(key[n]==NOZ){if(val==0.){fl=0;break;}elsecontinue;}elseif(key[n]==POS){if(val<=0.){fl=0;break;}elsecontinue;}elseif(key[n]==NEG){if(val>=0.){fl=0;break;}elsecontinue;}elseif(key[n]==GTH){if(val<=arg[m]){fl=0;break;}elsecontinue;}elseif(key[n]==GTE){if(val<arg[m]){fl=0;break;}elsecontinue;}elseif(key[n]==LTH){if(val>=arg[m]){fl=0;break;}elsecontinue;}elseif(key[n]==LTE){if(val>arg[m]){fl=0;break;}elsecontinue;}elseif(key[n]==EQU){if(val!=arg[m]){fl=0;break;}elsecontinue;}elseif(key[n]==EQV){if(val!=vvo[i+1][j]){fl=0;break;}else{i++;continue;}}elseif(key[n]==EQW){fl=0;for(p=0;p<nv[i+1];p++)if(val==vvo[i+1][p]){fl=1;break;}if(fl==0)break;else{i++;continue;}}elseif(key[n]==NEQ){if(val==arg[m]){fl=0;break;}elsecontinue;}elseif(key[n]==IBE){if((val<arg[m])||(val>=arg[m+1])){fl=0;break;}elsecontinue;}elseif(key[n]==EBI){if((val<=arg[m])||(val>arg[m+1])){fl=0;break;}elsecontinue;}elseif(key[n]==IBI){if((val<arg[m])||(val>arg[m+1])){fl=0;break;}elsecontinue;}elseif(key[n]==EBE){if((val<=arg[m])||(val>=arg[m+1])){fl=0;break;}elsecontinue;}else{printf("vecst::slctERR4%g\n",key[n]);hoc_execerror("Unknownkey",0);}}if(fl)ind[k++]=j;}vector_resize(vv,k);returnk;}ENDVERBATIMVERBATIMstaticdoubleslor(void*vv){inti,j,k,m,n,p,ni,nk,na,nv[10],num,fl,field[10];Object*lob;double*ind,*key,*arg,*vvo[10],val;ni=vector_instance_px(vv,&ind);nk=vector_arg_px(1,&key);na=vector_arg_px(2,&arg);lob=*hoc_objgetarg(3);num=ivoc_list_count(lob);if(num>10)hoc_execerror("ERR:vecst::slorcanonlyhandle10vectors",0);for(i=0,j=0,k=0;i<num;i++,j++){nv[i]=list_vector_px(lob,i,&vvo[i]);if(ni!=nv[i]&&(key[j]!=EQW||k!=1)){printf("vecst::slctERR%d%d%d%d%d\n",i,j,k,ni,nv[i]);hoc_execerror("indexandsearchedvectorsmustallbesamesize:",0);}if(key[j]==EQW||key[j]==EQV)if(k==0){j--;k++;}elsek=0;}for(j=0;j<num;j++){field[j]=-1;if(key[j]<=EBE&&key[j]>=ALL){field[j]=0;}elsefor(m=1;m<=5;m++){if(key[j]<=EBE*(m+1)&&key[j]>=ALL*(m+1)){key[j]/=(m+1);field[j]=m;}}if(field[j]==-1){printf("vecst::slctERRF%g\n",key[j]);hoc_execerror("",0);}}if(2*nk!=na){printf("vecst::slorERR3%d%d\n",nk,na);hoc_execerror("Argvectormustbedoublekeylength",0);}for(i=0,n=0;i<nk;i++)if(key[i]==EQV||key[i]==EQW)n++;if(nk+n!=num){printf("vecst::slorERR2%d(keys)+%d(EQV)!=%d(vecs)\n",nk,n,num);hoc_execerror("Keylengthmustbenumberofvecs+numofEQV",0);}for(j=0,k=0,m=0;j<ni;j++){for(i=0,m=0,n=0,fl=0;i<num;i++,n++,m+=2){if(field[n]==0)val=vvo[i][j];elseUNCODE(vvo[i][j],field[n],val);if(key[n]==ALL){fl=1;break;}if(key[n]==NOZ){if(val==0.)continue;else{fl=1;break;}}elseif(key[n]==POS){if(val<=0.)continue;else{fl=1;break;}}elseif(key[n]==NEG){if(val>=0.)continue;else{fl=1;break;}}elseif(key[n]==GTH){if(val<=arg[m])continue;else{fl=1;break;}}elseif(key[n]==GTE){if(val<arg[m])continue;else{fl=1;break;}}elseif(key[n]==LTH){if(val>=arg[m])continue;else{fl=1;break;}}elseif(key[n]==LTE){if(val>arg[m])continue;else{fl=1;break;}}elseif(key[n]==EQU){if(val!=arg[m])continue;else{fl=1;break;}}elseif(key[n]==EQV){if(val!=vvo[i+1][j])continue;else{i++;fl=1;break;}}elseif(key[n]==EQW){fl=0;for(p=0;p<nv[i+1];p++)if(val==vvo[i+1][p]){fl=1;break;}if(fl==1)break;else{i++;continue;}}elseif(key[n]==NEQ){if(val==arg[m])continue;else{fl=1;break;}}elseif(key[n]==IBE){if((val<arg[m])||(val>=arg[m+1])){continue;}else{fl=1;break;}}elseif(key[n]==EBI){if((val<=arg[m])||(val>arg[m+1])){continue;}else{fl=1;break;}}elseif(key[n]==IBI){if((val<arg[m])||(val>arg[m+1])){continue;}else{fl=1;break;}}elseif(key[n]==EBE){if((val<=arg[m])||(val>=arg[m+1])){continue;}else{fl=1;break;}}else{printf("vecst::slorERR4%g\n",key[n]);hoc_execerror("Unknownkey",0);}}if(fl)ind[k++]=j;}vector_resize(vv,k);returnk;}ENDVERBATIMVERBATIMstaticdoubleiwr(void*vv){inti,j,nx;double*x;FILE*f,*hoc_obj_file_arg();f=hoc_obj_file_arg(1);nx=vector_instance_px(vv,&x);if(nx>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=nx+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}for(i=0;i<nx;i++)scr[i]=(int)x[i];fwrite(&nx,sizeof(int),1,f);fwrite(scr,sizeof(int),nx,f);returnnx;}ENDVERBATIMVERBATIMstaticdoubleird(void*vv){inti,j,nx,n;double*x;FILE*f,*hoc_obj_file_arg();f=hoc_obj_file_arg(1);nx=vector_instance_px(vv,&x);fread(&n,sizeof(int),1,f);if(n>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=n+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}if(n!=nx){nx=vector_buffer_size(vv);if(n<=nx){vector_resize(vv,n);nx=n;}else{printf("%d>%d::",n,nx);hoc_execerror("Vectormaxcapacitytoosmallforird",0);}}fread(scr,sizeof(int),n,f);for(i=0;i<nx;i++)x[i]=(double)scr[i];returnn;}ENDVERBATIMVERBATIMstaticdoublefread2(void*vv){inti,j,nx,n,type,maxsz;double*x;FILE*fp,*hoc_obj_file_arg();BYTEHEADERfp=hoc_obj_file_arg(1);nx=vector_instance_px(vv,&x);maxsz=vector_buffer_size(vv);n=(int)*getarg(2);type=(int)*getarg(3);if(n>maxsz){printf("%d>%d::",n,maxsz);hoc_execerror("Vectormaxcapacitytoosmallforfread2",0);}else{vector_resize(vv,n);}if(type==6||type==16){unsignedint*xs;if(n>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=n+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}xs=(unsignedint*)scr;fread(xs,sizeof(int),n,fp);if(type==16)BYTESWAP_FLAG=1;for(i=0;i<n;i++){BYTESWAP(scr[i],int)x[i]=(double)scr[i];}returnn;}if(type==3||type==13){float*xf=(float*)malloc(n*(unsigned)sizeof(float));fread(xf,sizeof(float),n,fp);if(type==13)BYTESWAP_FLAG=1;for(i=0;i<n;i++){BYTESWAP(xf[i],float)x[i]=(double)xf[i];}free((char*)xf);}elsehoc_execerror("Typeunsupportedinfread2",0);}ENDVERBATIMVERBATIMstaticdoubleinsct(void*vv){inti,j,k,nx,nv1,nv2,maxsz;double*x,*v1,*v2;nx=vector_instance_px(vv,&x);maxsz=vector_buffer_size(vv);vector_resize(vv,maxsz);nv1=vector_arg_px(1,&v1);nv2=vector_arg_px(2,&v2);for(i=0,k=0;i<nv1;i++)for(j=0;j<nv2;j++)if(v1[i]==v2[j]){if(k<maxsz){x[k++]=v1[i];}else{k++;}}if(k>maxsz){printf("\tinsctWARNING:ranoutofroom:%d<%d\n",maxsz,k);}else{vector_resize(vv,k);}return(double)k;}ENDVERBATIMVERBATIMstaticdoublevfill(void*vv){inti,nx,nv1;double*x,*v1;nx=vector_instance_px(vv,&x);nv1=vector_arg_px(1,&v1);for(i=0;i<nx;i++)x[i]=v1[i%nv1];}ENDVERBATIMVERBATIMstaticdoublecull(void*vv){inti,j,k,nx,nv1,nv2,maxsz,flag;double*x,*v1,*v2;nx=vector_instance_px(vv,&x);maxsz=vector_buffer_size(vv);vector_resize(vv,maxsz);nv1=vector_arg_px(1,&v1);nv2=vector_arg_px(2,&v2);for(i=0,k=0;i<nv1;i++){flag=1;for(j=0;j<nv2;j++)if(v1[i]==v2[j])flag=0;if(flag){if(k<maxsz){x[k++]=v1[i];}else{k++;}}}if(k>maxsz){printf("\tcullWARNING:ranoutofroom:%d<%d\n",maxsz,k);}else{vector_resize(vv,k);}return(double)k;}ENDVERBATIMVERBATIMstaticdoubleredundout(void*vv){inti,j,nx,nv1,maxsz,indflag;double*x,*v1,val;if(ifarg(2))indflag=1;elseindflag=0;nx=vector_instance_px(vv,&x);maxsz=vector_buffer_size(vv);vector_resize(vv,maxsz);nv1=vector_arg_px(1,&v1);val=v1[0];x[0]=(indflag?0:val);for(j=1,i=1;i<nv1&&j<maxsz;i++)if(v1[i]!=val){val=v1[i];x[j++]=(indflag?i:val);}if(j==maxsz){printf("\tredundoutWARNING:ranoutofroom:%d<needed\n",maxsz);}else{vector_resize(vv,j);}return(double)j;}ENDVERBATIMVERBATIMstaticdoublemredundout(void*vv){inti,j,k,m,p,q,maxsz,ns,nx,av[11],bv[11],num,numb,indflag,match;Object*ob,*ob2;double*x,*avo[11],*bvo[11],val[11];void*vva[11],*vvb[11];nx=vector_instance_px(vv,&x);ob=*hoc_objgetarg(1);if(ifarg(2))indflag=(int)*getarg(2);elseindflag=0;if(ifarg(3)){ob2=*hoc_objgetarg(3);numb=ivoc_list_count(ob2);}elsenumb=0;maxsz=vector_buffer_size(vv);if(indflag)vector_resize(vv,maxsz);num=ivoc_list_count(ob);if(num>11)hoc_execerror("mredundout****ERRA****:canonlyhandle11vectors",0);for(i=0;i<num;i++){av[i]=list_vector_px2(ob,i,&avo[i],&vva[i]);if(av[0]!=av[i]){printf("mredundout****ERRC****%d%d%d\n",i,av[0],av[i]);hoc_execerror("Vectorsmustallbesamesize:",0);}}ns=av[0];for(i=0;i<numb;i++){bv[i]=list_vector_px2(ob2,i,&bvo[i],&vvb[i]);if(ns!=bv[i]){printf("mredundout****ERRC2****%d%d%d\n",i,ns,bv[i]);hoc_execerror("Vectorsmustallbesamesize:",0);}}if(ns/4>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=ns/4+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}for(j=0;j<num;j++)val[j]=avo[j][0];for(i=1,k=0;i<ns;i++){for(j=0,match=1;j<num;j++){if(val[j]!=avo[j][i]){match=0;break;}}if(match){if(k>=scrsz){printf("mredundout****ERRD****overscrsize%d\n",k);hoc_execerror("",0);}scr[k++]=i;}elsefor(j=0;j<num;j++)val[j]=avo[j][i];}if(indflag){if(k>maxsz){printf("mredundout****ERRE****vecoverflow%d>%d\n",k,maxsz);hoc_execerror("",0);}for(i=0;i<k;i++)x[i]=(double)scr[i];vector_resize(vv,k);}else{for(i=0,p=scr[0];i<k-1;i++){for(m=scr[i],p--;m<scr[i+1];m++,p++){for(j=0;j<num;j++)avo[j][p]=avo[j][m];for(j=0;j<numb;j++)bvo[j][p]=bvo[j][m];}}for(m=scr[i],p--;m<ns;m++,p++){for(j=0;j<num;j++)avo[j][p]=avo[j][m];for(j=0;j<numb;j++)bvo[j][p]=bvo[j][m];}for(j=0;j<num;j++)vector_resize(vva[j],ns-k);for(j=0;j<numb;j++)vector_resize(vvb[j],ns-k);}returnk;}ENDVERBATIMVERBATIMstaticdoublecvlv(void*vv){inti,j,k,nx,nsrc,nfilt;double*x,*src,*filt,sum,lpad,rpad;nx=vector_instance_px(vv,&x);nsrc=vector_arg_px(1,&src);nfilt=vector_arg_px(2,&filt);if(nx!=nsrc){hoc_execerror("Vectorsnotsamesize:",0);}if(nfilt>nsrc){hoc_execerror("Filterbiggerthansource",0);}for(i=0;i<nx;i++){x[i]=0.0;for(j=0,k=i-(int)(nfilt/2);j<nfilt;j++,k++){if(k>0&&k<nsrc-1)x[i]+=filt[j]*src[k];}}}ENDVERBATIMVERBATIMstaticdoubleintrp(void*vv){inti,la,lb,nx;double*x,fl,a,b;nx=vector_instance_px(vv,&x);fl=*getarg(1);i=0;a=x[0];la=0;if(a==fl)a=0;while(i<nx-1){for(i=la+1;x[i]==fl&&i<nx-1;i++);b=x[i];lb=i;for(i=la+1;i<lb;i++)x[i]=a+(b-a)/(lb-la)*(i-la);a=b;la=lb;}return(double)fl;}ENDVERBATIMVERBATIMstaticdoublesumabs(void*vv){inti,nx;double*x,sum;nx=vector_instance_px(vv,&x);for(sum=0,i=0;i<nx;i++)sum+=fabs(x[i]);returnsum;}ENDVERBATIMVERBATIMstaticdoublenind(void*vv){inti,j,k,m,nx,ni,nv[10],num,c,last;double*x,*ind,*vvo[10];nx=vector_instance_px(vv,&x);for(i=0;ifarg(i);i++);if(i>9)hoc_execerror("ERR:nindcanonlyhandle9vectors",0);num=i-2;for(i=0;i<num;i++){nv[i]=vector_arg_px(i+2,&vvo[i]);if(nx!=nv[i]){printf("nindERR%d%d%d\n",i,nx,nv[i]);hoc_execerror("Vectorsmustallbesamesize:",0);}}ni=vector_arg_px(1,&ind);c=nx-ni;if(ni>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=ni+10000;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}for(i=0,last=-1;i<ni;i++){scr[i]=(int)ind[i];if(scr[i]<0||scr[i]>=nx)hoc_execerror("nind():Indexoutofbounds",0);if(scr[i]<=last)hoc_execerror("nind():indicesshouldmonoincrease",0);last=scr[i];}for(j=0;j<num;j++){for(i=0,last=-1,m=0;i<ni;i++){for(k=last+1;k<scr[i];k++){x[m++]=vvo[j][k];}last=scr[i];}for(k=last+1;k<nx;k++,m++){x[m]=vvo[j][k];}for(i=0;i<c;i++)vvo[j][i]=x[i];vv=vector_arg(j+2);vector_resize(vv,c);}returnc;}ENDVERBATIMVERBATIMstaticdoublekeyind(void*vv){inti,j,k,ni,nk,nv[10],num;double*ind,*key,*vvo[10];ni=vector_instance_px(vv,&ind);for(i=0;ifarg(i);i++);i--;if(i>10)hoc_execerror("ERR:keyindcanonlyhandle9vectors",0);num=i-1;for(i=0;i<num;i++){nv[i]=vector_arg_px(i+2,&vvo[i]);if(ni!=nv[i]){printf("keyindERR%d%d%d\n",i,ni,nv[i]);hoc_execerror("Non-keyvectorsmustbesamesize:",0);}}nk=vector_arg_px(1,&key);if(nk!=num){printf("keyindERR2%d%d\n",nk,num);hoc_execerror("Keylengthmustbenumberofvecs",0);}k=0;for(j=0;j<ni;j++){for(i=0;i<nk;i++){if(key[i]==ALL)continue;if(key[i]==NOZ){if(vvo[i][j]==0.)break;elsecontinue;}elseif(key[i]==POS){if(vvo[i][j]<=0.)break;elsecontinue;}elseif(key[i]==NEG){if(vvo[i][j]>=0.)break;elsecontinue;}elseif(key[i]!=vvo[i][j])break;}if(i==nk)ind[k++]=j;}vector_resize(vv,k);returnk;}ENDVERBATIMVERBATIMstaticdoublethresh(void*vv){inti,nx,ny,cnt;double*x,*y,th;nx=vector_instance_px(vv,&x);cnt=0;if(hoc_is_object_arg(1)){ny=vector_arg_px(1,&y);th=0;if(nx!=ny){hoc_execerror("Vectorsizesdon'tmatchinthresh.",0);}for(i=0;i<nx;i++){if(x[i]>=y[i]){x[i]=1.;cnt++;}else{x[i]=BVBASE;}}}else{th=*getarg(1);for(i=0;i<nx;i++){if(x[i]>=th){x[i]=1.;cnt++;}else{x[i]=BVBASE;}}}returncnt;}ENDVERBATIMVERBATIMstaticdoubletriplet(void*vv){inti,nx;double*x,*y,a,b;nx=vector_instance_px(vv,&x);a=*getarg(1);b=*getarg(2);for(i=0;i<nx;i+=3)if(x[i]==a&&x[i+1]==b)break;if(i<nx)return(double)i;elsereturn-1.;}ENDVERBATIMVERBATIMstaticdoubleonoff(void*vv){inti,j,n,nv,non,nt,nd,nr,num;double*st,*vol,*obon,*thr,*dur,*refr;n=vector_instance_px(vv,&st);nv=vector_arg_px(1,&vol);non=vector_arg_px(2,&obon);nt=vector_arg_px(3,&thr);nd=vector_arg_px(4,&dur);nr=vector_arg_px(5,&refr);if(n!=nv||n!=non||n!=nt||n!=nd||n!=nr){hoc_execerror("v.onoff:vectorsnotallsamesize",0);}for(i=0,num=0;i<n;i++){obon[i]--;if(obon[i]>0.){st[i]=1.;continue;}if(vol[i]>=thr[i]&&obon[i]<=-refr[i]){st[i]=1.;obon[i]=dur[i];num++;}else{st[i]=BVBASE;}}returnnum;}ENDVERBATIMVERBATIMstaticdoublebpeval(void*vv){inti,n,no,nd,flag=0;doubleadd,div;double*vo,*outp,*del;n=vector_instance_px(vv,&vo);no=vector_arg_px(1,&outp);nd=vector_arg_px(2,&del);if(ifarg(3)&&ifarg(4)){add=*getarg(3);div=*getarg(4);flag=1;}if(n!=no||n!=nd)hoc_execerror("v.bpeval:vectorsnotallsamesize",0);if(flag){for(i=0;i<n;i++)vo[i]=((outp[i]+add)/div)*(1.-1.*((outp[i]+add)/div))*del[i];}else{for(i=0;i<n;i++)vo[i]=outp[i]*(1.-1.*outp[i])*del[i];}}ENDVERBATIMVERBATIMstaticdoublesedit(void*vv){inti,n,ni,f=0;double*x,*ind,th,val;Symbol*s;char*op;op=gargstr(1);n=vector_instance_px(vv,&x);sprintf(op,"helloworld");return(double)n;}ENDVERBATIMVERBATIMstaticdoublew(void*vv){inti,n,ni,f=0;double*x,*ind,th,val;Symbol*s;char*op;if(!ifarg(1)){printf("v1.w('op',thresh[,val,v2])\n");printf("a.wherethatsetselementsinv1toval(default0),ifv2=>onlylookattheseelements\n");printf("'op'=='functionname'isa.applytargetedbyv2calledasfunc(x[i],thresh,val)\n");return-1.;}op=gargstr(1);n=vector_instance_px(vv,&x);th=*getarg(2);if(ifarg(3)){val=*getarg(3);}else{val=0.0;}if(ifarg(4)){ni=vector_arg_px(4,&ind);f=1;}if(!strcmp(op,"==")){if(f==1){for(i=0;i<ni;i++){if(x[(int)ind[i]]==th){x[(int)ind[i]]=val;}}}else{for(i=0;i<n;i++){if(x[i]==th){x[i]=val;}}}}elseif(!strcmp(op,"!=")){if(f==1){for(i=0;i<ni;i++){if(x[(int)ind[i]]!=th){x[(int)ind[i]]=val;}}}else{for(i=0;i<n;i++){if(x[i]!=th){x[i]=val;}}}}elseif(!strcmp(op,">")){if(f==1){for(i=0;i<ni;i++){if(x[(int)ind[i]]>th){x[(int)ind[i]]=val;}}}else{for(i=0;i<n;i++){if(x[i]>th){x[i]=val;}}}}elseif(!strcmp(op,"<")){if(f==1){for(i=0;i<ni;i++){if(x[(int)ind[i]]<th){x[(int)ind[i]]=val;}}}else{for(i=0;i<n;i++){if(x[i]<th){x[i]=val;}}}}elseif(!strcmp(op,">=")){if(f==1){for(i=0;i<ni;i++){if(x[(int)ind[i]]>=th){x[(int)ind[i]]=val;}}}else{for(i=0;i<n;i++){if(x[i]>=th){x[i]=val;}}}}elseif(!strcmp(op,"<=")){if(f==1){for(i=0;i<ni;i++){if(x[(int)ind[i]]<=th){x[(int)ind[i]]=val;}}}else{for(i=0;i<n;i++){if(x[i]<=th){x[i]=val;}}}}elseif((s=hoc_lookup(op))){if(f==1){for(i=0;i<ni;i++){hoc_pushx(x[(int)ind[i]]);hoc_pushx(th);hoc_pushx(val);x[(int)ind[i]]=hoc_call_func(s,3);}}else{for(i=0;i<n;i++){hoc_pushx(x[i]);hoc_pushx(th);hoc_pushx(val);x[i]=hoc_call_func(s,3);}}}return(double)i;}ENDVERBATIMVERBATIMstaticdoublexing(void*vv){inti,j,nsrc,ndest,ntvec,f,maxsz,tvf;double*src,*dest,*tvec,th;tvf=0;ndest=vector_instance_px(vv,&dest);nsrc=vector_arg_px(1,&src);if(ifarg(3)){ntvec=vector_arg_px(2,&tvec);th=*getarg(3);tvf=1;}elseif(ifarg(2)){th=*getarg(2);}elseth=0.0;maxsz=vector_buffer_size(vv);vector_resize(vv,maxsz);if(tvf&&nsrc!=ntvec)hoc_execerror("v.xing:vectorsnotallsamesize",0);for(i=0,f=0,j=0;i<nsrc;i++){if(src[i]>th){if(f==0){if(j>=maxsz){printf("(%d)::",maxsz);hoc_execerror("Destvectoosmallinxing",0);}if(i>0){if(tvf){dest[j++]=tvec[i-1]+(tvec[i]-tvec[i-1])*(th-src[i-1])/(src[i]-src[i-1]);}else{dest[j++]=(i-1)+(th-src[i-1])/(src[i]-src[i-1]);}}f=1;}}else{if(f==1){f=0;}}}vector_resize(vv,j);return(double)i;}ENDVERBATIMVERBATIMstaticdoublexzero(void*vv){inti,n,nv,up;double*x,*vc,th,cnt=0.;n=vector_instance_px(vv,&x);nv=vector_arg_px(1,&vc);if(ifarg(2)){th=*getarg(2);}else{th=0.0;}if(vc[0]<th)up=0;elseup=1;if(nv!=n)hoc_execerror("Vectorsizedoesn'tmatch.",0);for(i=0;i<nv;i++){x[i]=0.;if(up){if(vc[i]<th){x[i]=-1;up=0;cnt++;}}elseif(vc[i]>th){up=x[i]=1;cnt++;}}returncnt;}ENDVERBATIMVERBATIMstaticdoublenegwrap(void*vv){inti,n,flag;double*x,cnt;n=vector_instance_px(vv,&x);if(ifarg(1))flag=(int)*getarg(1);elseflag=1;for(i=0,cnt=0;i<n;i++)if(x[i]<0){x[i]=(flag?-x[i]:0.);cnt++;}returncnt;}ENDVERBATIMVERBATIMstaticdoublesw(void*vv){inti,n;double*x,fr,to;n=vector_instance_px(vv,&x);fr=*getarg(1);to=*getarg(2);for(i=0;i<n;i++){if(x[i]==fr){x[i]=to;}}returnn;}ENDVERBATIMVERBATIMstaticdoubleb2v(void*vv){inti,n,num;double*x;bvec*to;Object*ob;n=vector_instance_px(vv,&x);ob=*(hoc_objgetarg(1));to=(bvec*)ob->u.this_pointer;if(to->size!=n){hoc_execerror("Vectorandbytevecsizesdon'tmatch.",0);}for(i=0;i<n;i++)x[i]=(double)to->x[i];returnn;}ENDVERBATIMVERBATIMstaticdoublev2d(void*vv){inti,n,num;double*x,*to;n=vector_instance_px(vv,&x);to=hoc_pgetarg(1);if(ifarg(2)){num=*getarg(2);}else{num=-1;}if(num>-1&&num!=n){hoc_execerror("Vectorsizedoesn'tmatch.",0);}for(i=0;i<n;i++){to[i]=x[i];}returnn;}ENDVERBATIMVERBATIMstaticdoubled2v(void*vv){inti,n,num;double*x,*fr;n=vector_instance_px(vv,&x);fr=hoc_pgetarg(1);if(ifarg(2)){num=*getarg(2);}else{num=-1;}if(num>-1&&num!=n){hoc_execerror("Vectorsizedoesn'tmatch.",0);}for(i=0;i<n;i++){x[i]=fr[i];}returnn;}ENDVERBATIMVERBATIMstaticdoublelcat(void*vv){inti,j,k,n,lc,cap,maxsz;Object*ob1,*ob2;double*x,*fr;void*vw;n=vector_instance_px(vv,&x);vector_resize(vv,maxsz=vector_buffer_size(vv));ob1=*hoc_objgetarg(1);lc=ivoc_list_count(ob1);for(i=0,j=0;i<lc&&j<maxsz;i++){cap=list_vector_px2(ob1,i,&fr,&vw);for(k=0;k<cap&&j<maxsz;k++,j++)x[j]=fr[k];}if(i<lc||k<cap)printf("vecstlcatWARN:notallvecscopied\n");vector_resize(vv,j);return(double)j;}ENDVERBATIMVERBATIMstaticdoublemkcode(void*vv){inti,j,k,n,num,bits;Object*ob;double*x,*vvo[5];n=vector_instance_px(vv,&x);ob=*hoc_objgetarg(1);if(ifarg(2))bits=*getarg(2);elsebits=3;num=ivoc_list_count(ob);if(num!=5)hoc_execerror("mkcode****ERRA****:canonlyhandle5vectors",0);for(i=0;i<num;i++){j=list_vector_px(ob,i,&vvo[i]);if(n!=j){printf("mkcode****ERRC****%d%d%d\n",i,n,j);hoc_execerror("Vectorsmustallbesamesize:",0);}}for(i=0;i<n;i++){for(j=0,x[i]=0;j<5;j++){if(vvo[j][i]<0.||vvo[j][i]>=sc[4]||floor(vvo[j][i]+0.5)!=vvo[j][i]){printf("vec.mkcodeOOB%g>%ginvec[%d].x[%d]\n",vvo[j][i],sc[4],j,i);hoc_execerror("",0);}x[i]+=vvo[j][i]*sc[j+1];}}return(double)i;}ENDVERBATIMVERBATIMstaticdoubleuncode(void*vv){inti,j,n,ny,num,field;Object*ob;double*x,*y,*vvo[5],val,old;n=vector_instance_px(vv,&x);field=0;if(!ifarg(1)){printf("\tv.uncode(val)--takeapartvalandplaceinvector\n\tv.uncode(VECLIST)--takeapartvectoritemsandplaceinvectorsinlist(cfuncodf)\n\tv.uncode(vec,field)--takeapartvectoritemsandplacerequestedfieldinvector\n\tv.uncode(field,val)--replacefieldinvwithval(cfrecodf)\n\tv.uncode(field,vec)--replacefieldinvwithvaluesfromvec\n");return0.;}elseif(!ifarg(2)){if(hoc_is_double_arg(1)){val=*getarg(1);if(vector_buffer_size(vv)<5){hoc_execerror("uncode****ERRA****:vectortoosmalltoresize(5)",0);}vector_resize(vv,5);for(i=1;i<=5;i++)UNCODE(val,i,x[i-1])returnx[0];}else{ob=*hoc_objgetarg(1);num=ivoc_list_count(ob);if(num!=5)hoc_execerror("uncode****ERRA****:canonlyhandle5vectors",0);for(i=0;i<num;i++){j=list_vector_px(ob,i,&vvo[i]);if(n!=j){printf("uncode****ERRC****%d%d%d\n",i,n,j);hoc_execerror("Vectorsmustallbesamesize:",0);}}for(i=0;i<n;i++)for(j=1;j<=5;j++)UNCODE(x[i],j,vvo[j-1][i]);return(double)i;}}else{if(hoc_is_double_arg(1)){field=(int)chkarg(1,1.,5.);ny=-1;if(hoc_is_double_arg(2)){val=chkarg(2,0.,sc[4]-1);if(floor(val+0.5)!=val)hoc_execerror("uncode(vec)****ERRG****:non-intval",0);}else{ny=vector_arg_px(2,&y);if(ny!=n)hoc_execerror("uncode(vec)****ERRH****:diffsizedvecs",0);}for(i=0;i<n;i++){UNCODE(x[i],field,old)if(ny>0){if(y[i]<0.||y[i]>=sc[4]||floor(y[i]+0.5)!=y[i]){printf("vec.uncodeERRJOOB%g(%gmax)at%d\n",y[i],sc[4],i);hoc_execerror("",0);}x[i]+=sc[field]*(y[i]-old);}else{x[i]+=sc[field]*(val-old);}}return(double)i;}else{ny=vector_arg_px(1,&y);field=(int)chkarg(2,1.,5.);if(ny!=n)hoc_execerror("uncode(vec)****ERRI****:diffsizedvecs",0);for(i=0;i<n;i++)UNCODE(x[i],field,y[i])return(double)i;}}}ENDVERBATIMVERBATIMintlist_vector_px(Object*ob,inti,double**px){Object*obv;intsz;obv=ivoc_list_item(ob,i);sz=vector_capacity(obv->u.this_pointer);*px=vector_vec(obv->u.this_pointer);returnsz;}intlist_vector_px2(Object*ob,inti,double**px,void**vv){Object*obv;intsz;obv=ivoc_list_item(ob,i);sz=vector_capacity(obv->u.this_pointer);*px=vector_vec(obv->u.this_pointer);*vv=(void*)obv->u.this_pointer;returnsz;}intlist_vector_resize(Object*ob,inti,intsz){Object*obv;intmaxsz;obv=ivoc_list_item(ob,i);maxsz=vector_buffer_size(obv->u.this_pointer);if(sz>maxsz){printf("max:%drequest:%d",maxsz,sz);hoc_execerror("Can'tgrowvectorinlist_vector_resize",0);return-1;}vector_resize(obv->u.this_pointer,sz);returnsz;}ENDVERBATIMVERBATIMstaticdoubleismono1(double*x,doublen,intflag){inti;doublelast;last=x[0];if(flag==1){for(i=1;i<n&&x[i]>=last;i++)last=x[i];}elseif(flag==-1){for(i=1;i<n&&x[i]<=last;i++)last=x[i];}elseif(flag==0){for(i=1;i<n&&x[i]==last;i++);}if(i==n)return1.;elsereturn0.;}staticdoubleismono(void*vv){inti,n,flag;double*x,last;n=vector_instance_px(vv,&x);if(ifarg(1)){flag=(int)*getarg(1);}else{flag=1;}returnismono1(x,n,flag);}ENDVERBATIMVERBATIMstaticdoublecount(void*vv){inti,n,cnt=0;double*x,num;n=vector_instance_px(vv,&x);num=*getarg(1);for(i=0;i<n;i++)if(x[i]==num)cnt++;returncnt;}ENDVERBATIMVERBATIMstaticdoubleround_local(void*vv){inti,n;double*x;n=vector_instance_px(vv,&x);for(i=0;i<n;i++)x[i]=floor(x[i]+0.5);return(double)i;}ENDVERBATIMPROCEDUREExpo(x){TABLERESFROM-20TO0WITH5000RES=exp(x)}FUNCTIONAAA(x){Expo(x)AAA=RES}VERBATIMstaticdoublesmgs(void*vv){inti,j,nx,xv,nsum,points,maxsz;double*x,*sum;doublelow,high,step,var,svar,scale,arg;nsum=vector_instance_px(vv,&sum);nx=vector_arg_px(1,&x);low=*getarg(2);high=*getarg(3);step=*getarg(4);var=*getarg(5);points=(int)((high-low)/step+hoc_epsilon);if(nsum!=points){maxsz=vector_buffer_size(vv);if(points<=maxsz){nsum=points;vector_resize(vv,nsum);}else{printf("%d>%d::",points,maxsz);hoc_execerror("Vectormaxcapacitytoosmallinsmgs",0);}}svar=-2.*var*var/step/step;scale=1./sqrt(2.*M_PI)/var;for(j=0;j<points;j++)sum[j]=0.;for(i=0;i<nx;i++){xv=(int)((x[i]-low)/step+0.5);for(j=xv;j<points&&(arg=(j-xv)*(j-xv)/svar)>-20;j++){Expo(arg);sum[j]+=RES;}for(j=xv-1;j>=0&&(arg=(j-xv)*(j-xv)/svar)>-20;j--){Expo(arg);sum[j]+=RES;}}for(j=0;j<points;j++)sum[j]*=scale;returnsvar;}ENDVERBATIMVERBATIMstaticdoublevrdh(void*vv){intcode,i,num,n[2],maxsz;double*x;FILE*f;num=vector_instance_px(vv,&x);maxsz=vector_buffer_size(vv);f=hoc_obj_file_arg(1);num=(int)*getarg(2);if(maxsz<2*num){printf("vrdhERR0need%droominvec\n",2*num);hoc_execerror("",0);}vector_resize(vv,2*num);for(i=0;i<num;i++){fread(&n,sizeof(int),2,f);if(n[1]!=3){printf("vrdhERRAcode3onlyimplemented%d:%d\n",i,n[1]);hoc_execerror("",0);}x[2*i]=(double)n[0];x[2*i+1]=(double)n[1];fseek(f,(long)n[1],SEEK_CUR);}returnnum;}ENDVERBATIMPROCEDUREinstall_vecst(){if(VECST_INSTALLED==1){printf("$Id}else{VECST_INSTALLED=1VERBATIMinti,j;install_vector_method("indset",indset);install_vector_method("thresh",thresh);install_vector_method("triplet",triplet);install_vector_method("onoff",onoff);install_vector_method("bpeval",bpeval);install_vector_method("w",w);install_vector_method("sedit",sedit);install_vector_method("xing",xing);install_vector_method("cvlv",cvlv);install_vector_method("intrp",intrp);install_vector_method("xzero",xzero);install_vector_method("negwrap",negwrap);install_vector_method("sw",sw);install_vector_method("ismono",ismono);install_vector_method("count",count);install_vector_method("round",round_local);install_vector_method("fewind",fewind);install_vector_method("findx",findx);install_vector_method("sindx",sindx);install_vector_method("sindv",sindv);install_vector_method("nind",nind);install_vector_method("keyind",keyind);install_vector_method("slct",slct);install_vector_method("slor",slor);install_vector_method("insct",insct);install_vector_method("cull",cull);install_vector_method("redundout",redundout);install_vector_method("mredundout",mredundout);install_vector_method("d2v",d2v);install_vector_method("v2d",v2d);install_vector_method("b2v",b2v);install_vector_method("iwr",iwr);install_vector_method("ird",ird);install_vector_method("smgs",smgs);install_vector_method("ident",ident);install_vector_method("lcat",lcat);install_vector_method("fread2",fread2);install_vector_method("vfill",vfill);install_vector_method("vrdh",vrdh);install_vector_method("mkcode",mkcode);install_vector_method("uncode",uncode);install_vector_method("sumabs",sumabs);for(i=0,j=5;i<=5;i++,j--)sc[i]=pow(2,10*j);ENDVERBATIM}}FUNCTIONisojt(){VERBATIMObject*ob1,*ob2;ob1=*hoc_objgetarg(1);ob2=*hoc_objgetarg(2);if(!ob1)if(!ob2)return1;elsereturn0;if(!ob2||ob1->template!=ob2->template){return0;}return1;ENDVERBATIM}FUNCTIONojtnum(){VERBATIMObject*ob1;ob1=*hoc_objgetarg(1);if(!ob1)return-1;return(double)ob1->index;ENDVERBATIM}FUNCTIONeqojt(){VERBATIMObject*ob1,*ob2;ob1=*hoc_objgetarg(1);ob2=*hoc_objgetarg(2);if(ob1&&ob2&&ob1==ob2){return1;}return0;ENDVERBATIM}FUNCTIONrdmany(){VERBATIM{intcode,i,j,nx,nv,num,n[2];Object*ob;double*vvo[100],sf[2];FILE*f;f=hoc_obj_file_arg(1);ob=*hoc_objgetarg(2);code=*getarg(3);num=ivoc_list_count(ob);if(num>100)hoc_execerror("ERR:rdmanycanonlyhandle100vectors",0);for(i=0;i<num;i++){nv=list_vector_px(ob,i,&vvo[i]);if(i==0)nx=nv;if(nx!=nv){printf("rdmanyERR%d%d%d\n",i,nx,nv);hoc_execerror("Vectorsmustallbesamesize:",0);}}if(nx>scrsz){if(scrsz>0){free(scr);scr=(unsignedint*)NULL;}scrsz=nx+10;scr=(unsignedint*)ecalloc(scrsz,sizeof(int));}if(code==2){unsignedshort*xs;xs=(unsignedshort*)scr;for(i=0;i<num;i++){fread(&n,sizeof(int),2,f);fread(&sf,sizeof(double),2,f);if(n[0]!=nx){printf("rdmanyERRAvec(%d)%dvs%d\n",i,nx,n[0]);hoc_execerror("",0);}if(n[1]!=code){printf("rdmanyERRBcodemismatch%d%d\n",n[1],code);hoc_execerror("",0);}fread(xs,sizeof(short),n[0],f);for(j=0;j<n[0];j++)vvo[i][j]=(double)(xs[j]/sf[0]+sf[1]);}}elseprintf("rdmany()code%dnotimplemented\n",code);returnnum;}ENDVERBATIM}FUNCTIONbyteswap(){VERBATIMintn[2];doubleret;FILE*f;BYTEHEADERf=hoc_obj_file_arg(1);fread(&n,sizeof(int),2,f);if(n[1]<1||n[1]>5){BYTESWAP_FLAG=1;ret=1.;}elseret=0.;BYTESWAP(n[1],int)if(n[1]<1||n[1]>5){printf("byteswap:Somethingwrongwithlocationsampled:%d\n",n[1]);ret=-1.;}fseek(f,-2*sizeof(int),SEEK_CUR);returnret;ENDVERBATIM}FUNCTIONmkcodf(){VERBATIMinti;doublex,a;for(x=0.,i=1;i<=5;i++){a=chkarg(i,0.,sc[4]-1);if(floor(a+0.5)!=a){printf("mkcodfrestrictedtointegers%g\n",a);hoc_execerror("",0);}x+=a*sc[i];}returnx;ENDVERBATIM}FUNCTIONuncodf(){VERBATIMinti;doublex,ret,*ptr;x=*getarg(1);if(hoc_is_double_arg(2)){i=(int)chkarg(2,1.,5.);UNCODE(x,i,ret);returnret;}else{for(i=2;i<=6;i++)if(ifarg(i)){ptr=hoc_pgetarg(i);UNCODE(x,i-1,*ptr);}elsebreak;return*ptr;}ENDVERBATIM}FUNCTIONrecodf(){VERBATIMinti;doublex,y,old;i=(int)chkarg(1,1.,5.);x=*getarg(2);y=chkarg(3,0.,sc[4]-1);UNCODE(x,i,old);returnx+sc[i]*(y-old);ENDVERBATIM}FUNCTIONflor(){VERBATIMreturnfloor(*getarg(1));ENDVERBATIM}