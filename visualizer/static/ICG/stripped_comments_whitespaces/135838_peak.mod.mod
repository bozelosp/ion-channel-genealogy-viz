UNITS{(mV)=(millivolt)}INDEPENDENT{tFROM0TO1WITH1(ms)}NEURON{SUFFIXpkRANGEtmin,vminRANGEtpeak,vpeakRANGEdvdt,d2vdt2,tdvdtpeak,dvdtpeak,td2vdt2peak,d2vdt2peak}PARAMETER{tmin(ms)vmin(mV)v(mV)}ASSIGNED{tpeak(ms)vpeak(mV)v1(mV)v2(mV)v3(mV)t1(ms)t2(ms)t3(ms)initflag(1)dvdt(mV/ms)d2vdt2(mV/ms2)tdvdtpeak(ms)dvdtpeak(mV/ms)td2vdt2peak(ms)d2vdt2peak(mV/ms2)}INITIAL{tpeak=0(ms)vpeak=-100(mV)v1=0(mV)v2=0(mV)v3=0(mV)t1=0(mV)t2=0(mV)t3=0(mV)initflag=0(1)dvdt=0(mV/ms)d2vdt2=0(mV/ms2)tdvdtpeak=0(ms)dvdtpeak=0(mV/ms)td2vdt2peak=0(ms)d2vdt2peak=0(mV/ms2)check()}BREAKPOINT{SOLVEcheckMETHODafter_cvode}PROCEDUREcheck(){if(v>vpeak){tpeak=tvpeak=v}v1=v2v2=v3v3=vt1=t2t2=t3t3=tif(t3-t2>0){dvdt=(v3-v2)/(t3-t2)}if(t3-t2>0&&t2-t1>0){d2vdt2=(2*(t3*(v2-v1)+t2*(v1-v3)+t1*(v3-v2)))/((t1-t2)*(t1-t3)*(t2-t3))}if(v>vmin&&t>tmin){if(dvdt>dvdtpeak){tdvdtpeak=tdvdtpeak=dvdt}if(dvdt>0&&d2vdt2>d2vdt2peak){td2vdt2peak=td2vdt2peak=d2vdt2}}}