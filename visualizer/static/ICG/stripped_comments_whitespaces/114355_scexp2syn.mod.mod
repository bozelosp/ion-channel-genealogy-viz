NEURON{POINT_PROCESSScalExp2SynRANGEtau1,tau2,Ee,iRANGEEnumsynsRANGEidRANGEEintrvl,NEprocRANGEEgPOINTERproc_numRANGEEgmax0,EgmaxRANGEHSP_typeRANGEVtrg,VRANGEEtau,EenableRANGEcontinuous_update,event_windowRANGEorderPOINTERVsomaRANGEvavg,avgstrtRANGEmavg,mavgstrt,mavgintrvlNONSPECIFIC_CURRENTi}UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)(nS)=(nanosiemens)}PARAMETER{tau1=.1(ms)<1e-9,1e9>tau2=10(ms)<1e-9,1e9>Ee=0(mV)Enumsyns=1id=0Eintrvl=500(ms)NEprocEgmax0=1(nS)Vtrg=-60(mV)Etau=1e5(ms)Eenable=1order=0continuous_update=1event_window=5(ms)HSP_type=1avgstrt=0(ms)mavgstrt=0(ms)mavgintrvl=5000(ms)}ASSIGNED{v(mV)i(nA)Eg(uS)factorEordervavgstp1stp2mavgvintrvlnin_windowsynevent_timeproc_numVsomaV}STATE{EA(uS)EB(uS)Egmax(nS)}INITIAL{LOCALj,tpif(tau1/tau2>.9999){tau1=.9999*tau2}EA=0EB=0tp=(tau1*tau2)/(tau2-tau1)*log(tau2/tau1)factor=-exp(-tp/tau1)+exp(-tp/tau2)factor=1/factorEgmax=Egmax0Eorder=Egmax^orderif(HSP_type==0){V=Vsoma}elseif(HSP_type==1){V=v}in_window=continuous_updatesynevent_time=0stp1=0stp2=0n=1vavg=0vintrvl=0mavg=v}BREAKPOINT{Eg=EB-EAi=Eg*(v-Ee)SOLVEupdateMETHODafter_cvodeSOLVEstateMETHODcnexp}DERIVATIVEstate{EA'=-EA/tau1EB'=-EB/tau2}NET_RECEIVE(w){LOCALdraw,jj=0while(j<Enumsyns){draw=floor(scop_random()*NEproc)if(proc_num==draw){synevent_time=tstate_discontinuity(EA,EA+Egmax/1000*factor)state_discontinuity(EB,EB+Egmax/1000*factor)net_event(t)}j=j+1}}PROCEDUREupdate(){LOCALsfif(Egmax<0){Egmax=0}Eorder=Egmax^orderif(HSP_type==0){V=Vsoma}elseif(HSP_type==1){V=v}sf=Vtrg-Vif(Eenable){Egmax=Egmax*(1+exprand(sf)/Etau)}if(!continuous_update){if(t-synevent_time<=event_window){in_window=1}else{in_window=0}}if(t>=avgstrt){vavg=(vavg*stp1+v)/(stp1+1)stp1=stp1+1}if(t>=mavgstrt){vintrvl=vintrvl+vstp2=stp2+1if(t>mavgstrt+n*mavgintrvl-dt/2){if(mavgintrvl>0){mavg=vintrvl/stp2}n=n+1vintrvl=0stp2=0}}}