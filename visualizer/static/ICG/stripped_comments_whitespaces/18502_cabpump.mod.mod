NEURON{SUFFIXcadifpmpUSEIONcaREADcao,ica,caiWRITEcai,icaRANGEica_pmp,last_ica_pmpGLOBALvol,pump0}DEFINENANN4UNITS{(mV)=(millivolt)(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)(mol)=(1)FARADAY=(faraday)(coulomb)PI=(pi)(1)R=(k-mole)(joule/degC)}PARAMETER{celsius(degC)DFree=.6(um2/ms)diam(um)cao(mM)beta=50k1=5e8(/mM-s)k2=.25e6(/s)k3=.5e3(/s)k4=5e0(/mM-s)pump0=3e-14(mol/cm2)}ASSIGNED{ica(mA/cm2)cai(mM)vol[NANN](1)ica_pmp(mA/cm2)last_ica_pmp(mA/cm2)area1(um2)c1(1+8um5/ms)c2(1-10um2/ms)c3(1-10um2/ms)c4(1+8um5/ms)}CONSTANT{volo=1(liter)}STATE{ca[NANN](mM)pump(mol/cm2)pumpca(mol/cm2)}INITIAL{LOCALtotalparms()FROMi=0TONANN-1{ca[i]=cai}pumpca=cai*pump*c1/c2total=pumpca+pumpif(total>1e-9){pump=pump*(pump/total)pumpca=pumpca*(pump/total)}ica_pmp=0last_ica_pmp=0}BREAKPOINT{SOLVEstateMETHODsparselast_ica_pmp=ica_pmpica=ica_pmp}LOCALfrat[NANN]PROCEDUREcoord(){LOCALr,dr2r=1/2dr2=r/(NANN-1)/2vol[0]=0frat[0]=2*rFROMi=0TONANN-2{vol[i]=vol[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vol[i+1]=PI*(r+dr2/2)*2*dr2}}KINETICstate{COMPARTMENTi,(1+beta)*diam*diam*vol[i]*1(um){ca}COMPARTMENT(1e10)*area1{pumppumpca}COMPARTMENTvolo*(1e15){cao}~ca[0]<<(-(ica-last_ica_pmp)*PI*diam*1(um)*(1e4)*frat[0]/(2*FARADAY))FROMi=0TONANN-2{~ca[i]<->ca[i+1](DFree*frat[i+1]*1(um),DFree*frat[i+1]*1(um))}~ca[0]+pump<->pumpca(c1,c2)~pumpca<->pump+cao(c3,c4)ica_pmp=(1e-4)*2*FARADAY*(f_flux-b_flux)/area1cai=ca[0]}PROCEDUREparms(){coord()area1=2*PI*(diam/2)*1(um)c1=(1e7)*area1*k1c2=(1e7)*area1*k2c3=(1e7)*area1*k3c4=(1e7)*area1*k4}FUNCTIONss()(mM){SOLVEstateSTEADYSTATEsparsess=cai}