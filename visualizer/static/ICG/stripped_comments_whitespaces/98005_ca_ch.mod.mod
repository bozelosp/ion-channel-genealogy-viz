NEURON{SUFFIXca_chUSEIONcaREADcao,cai,icaWRITEcai,icaRANGEipump,last_ipump,testGLOBALDFree,k1buf,k2buf,k1,k2,k3,k4,totpump,totbufGLOBALvol,Buffer0}DEFINENANN4UNITS{(mol)=(1)(molar)=(1/liter)(mM)=(millimolar)(um)=(micron)(mA)=(milliamp)FARADAY=(faraday)(10000coulomb)PI=(pi)(1)}PARAMETER{DFree=.6(um2/ms)diam=1(um)cao(mM)ica(mA/cm2)k1buf=500(/mM-ms)k2buf=0.5(/ms)k1=1.e10(um3/s)k2=50.e7(/s)k3=1.e10(/s)k4=5.e6(um3/s)totpump=0.2(mol/cm2)totbuf=1.2(mM)}CONSTANT{volo=1(liter)}ASSIGNED{area(um2)testcai(mM)vol[NANN](1)ipump(mA/cm2)last_ipump(mA/cm2)}STATE{ca[NANN](mM)<1.e-5>CaBuffer[NANN](mM)Buffer[NANN](mM)pump(mol/cm2)<1.e-3>pumpca(mol/cm2)<1.e-15>}BREAKPOINT{SOLVEstateMETHODsparselast_ipump=ipumpica=ipumptest=0}LOCALcoord_doneINITIAL{if(coord_done==0){coord_done=1coord()}FROMi=0TONANN-1{ca[i]=cai}ipump=0pump=totpumppumpca=(1e-18)*pump*cao*k4/k3FROMi=0TONANN-1{ca[i]=caiCaBuffer[i]=(totbuf*ca[i])/(k2buf/k1buf+ca[i])Buffer[i]=totbuf-CaBuffer[i]}}LOCALfrat[NANN]PROCEDUREcoord(){LOCALr,dr2r=1/2dr2=r/(NANN-1)/2vol[0]=0frat[0]=2*rFROMi=0TONANN-2{vol[i]=vol[i]+PI*(r-dr2/2)*2*dr2r=r-dr2frat[i+1]=2*PI*r/(2*dr2)r=r-dr2vol[i+1]=PI*(r+dr2/2)*2*dr2}}LOCALdsq,dsqvolKINETICstate{COMPARTMENTi,diam*diam*vol[i]*1(um){caCaBufferBuffer}COMPARTMENT(1.e10)*area{pumppumpca}COMPARTMENT(1.e15)*volo{cao}~ca[0]<<(-(ica-last_ipump)*PI*diam*frat[0]*1(um)/(2*FARADAY))FROMi=0TONANN-2{~ca[i]<->ca[i+1](DFree*frat[i+1]*1(um),DFree*frat[i+1]*1(um))}dsq=diam*diam*1(um)FROMi=0TONANN-1{dsqvol=dsq*vol[i]~ca[i]+Buffer[i]<->CaBuffer[i](k1buf*dsqvol,k2buf*dsqvol)}~ca[0]+pump<->pumpca((1.e-11)*k1*area,(1.e7)*k2*area)~pumpca<->pump+cao((1.e7)*k3*area,(1.e-11)*k4*area)ipump=2*FARADAY*(f_flux-b_flux)/areacai=ca[0]}