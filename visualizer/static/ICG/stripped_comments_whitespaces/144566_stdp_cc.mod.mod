NEURON{POINT_PROCESSSTDPSynCCRANGEtau,e,iRANGEA_m,A_p,tau_y,tetam,tetap,tau_r,tau_0RANGEt_last_preRANGEu_m1,u_m2,r,g_update,gbarRANGEdelay_steps,delay_array_u_m1,delay_array_u_m2,pointless_counterRANGEum2s,um1sNONSPECIFIC_CURRENTi}DEFINEMAX_ARRAY2000UNITS{(nA)=(nanoamp)(mV)=(millivolt)(uS)=(microsiemens)}PARAMETER{tau=0.1(ms)<1e-9,1e9>e=0(mV)gbar=0.05tau_0=10tau_r=15tau_y=114A_m=0.00001A_p=0.00012tetam=-64.9tetap=-35delay_steps=50um1sum2st_last_pre=-1g_updatepointless_counter=0}ASSIGNED{v(mV)i(nA)delay_array_u_m1[MAX_ARRAY]delay_array_u_m2[MAX_ARRAY]delay_array_v[MAX_ARRAY]}STATE{g(uS)u_m1u_m2r}INITIAL{g=0u_m1=vu_m2=vr=0FROMi=0TOMAX_ARRAY{delay_array_v[i]=vdelay_array_u_m1[i]=0delay_array_u_m2[i]=0}}BREAKPOINT{SOLVEstateMETHODcnexpi=g*(v-e)}DERIVATIVEstate{LOCALx,u_sig,u_m1_sig,u_m2_sig,set_loc,retrieve_locif((v-tetap)>0){u_sig=v-tetap}else{u_sig=0}if((delay_array_u_m1[retrieve_loc]-tetam)>0){u_m1_sig=delay_array_u_m1[retrieve_loc]-tetamum1s=u_m1_sig}else{u_m1_sig=0um1s=0}if((delay_array_u_m2[retrieve_loc]-tetam)>0){u_m2_sig=delay_array_u_m2[retrieve_loc]-tetamum2s=u_m2_sig}else{u_m2_sig=0um2s=0}if(t_last_pre==1){x=1t_last_pre=0.5}else{x=0}g'=-g/tauu_m1'=(v-u_m1)/tau_0u_m2'=(v-u_m2)/tau_yr'=(x-r)/tau_rg_update=-A_m*x*u_m1_sig+A_p*u_sig*r*u_m2_siggbar=gbar+g_updateset_loc=fmod(pointless_counter,delay_steps)retrieve_loc=fmod(pointless_counter+delay_steps+1,delay_steps)delay_array_u_m1[set_loc]=u_m1delay_array_u_m2[set_loc]=u_m2pointless_counter=pointless_counter+1}NET_RECEIVE(weight(uS)){g=gbart_last_pre=1printf("receivedweight=%f,att=%f\n",weight,t)}